<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="49,499" id="srcline499">499</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,500" id="srcline500">500</a></span><span class="line"><span class="comment">%% 马克点判定 4) 寻找惯性运动 dS 长度(大于 moveDistance)，且马克点跟踪成功的是时刻，判定 dP_Inertial 和 dP_Vision：</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,501" id="srcline501">501</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S176T69U2055">trackedMakerPosition_k_OK</span>,<span class="var type1" id="S177T2U2056">TrackFlag</span>,<span class="var type1" id="S178T2U2057">dPError_dS_Norm</span>,<span class="var type1" id="S179T2U2058">angleErr_dS</span> ] = Track_dS_Judge<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,502" id="srcline502">502</a></span><span class="line">    ( <span class="var type1" id="S180T19U2061">InertialPosition</span>,<span class="var type1" id="S181T4U2062">inertial_k</span>,<span class="var type1" id="S182T44U2063">trackedMakerPosition</span>,<span class="var type1" id="S183T6U2064">otherMakersPosition_k_min</span>,<span class="mxinfo" id="T2:U9"><span class="mxinfo" id="T2:U10"><span class="var type1" id="S177T2U2065">TrackFlag</span></span></span>,<span class="var type1" id="S184T34U2066">makerTrackThreshold</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="49,503" id="srcline503">503</a></span><span class="line"><span class="keyword">global</span> <span class="var type0" id="S185T0U2068">InertialData_visual_k</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,504" id="srcline504">504</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,505" id="srcline505">505</a></span><span class="line"><span class="mxinfo" id="T69:U13"><span class="var type1" id="S176T69U2071">trackedMakerPosition_k_OK</span>=  <span class="mxinfo" id="T2:U15">NaN</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,506" id="srcline506">506</a></span><span class="line"><span class="comment">%% dS 位移长度段的位移差：同时考虑位移差大小和方向</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,507" id="srcline507">507</a></span><span class="line"><span class="comment">% find the point which moved moveDistance</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,508" id="srcline508">508</a></span><span class="line"><span class="mxinfo" id="T2:U16"><span class="var type1" id="S187T2U2076">moveDistance</span> = <span class="mxinfo" id="T2:U18"><span class="var type1" id="S184T34U2078">makerTrackThreshold</span>.moveDistance</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,509" id="srcline509">509</a></span><span class="line"><span class="mxinfo" id="T2:U20"><span class="var type1" id="S188T2U2082">dS_Inertial_last_k</span> = <span class="mxinfo" id="T2:U22"><span class="fcn" id="F283N14:B2084">SearchDistanceK</span>( <span class="var type1" id="S180T19U2085">InertialPosition</span>,<span class="var type1" id="S181T4U2086">inertial_k</span>,<span class="mxinfo" id="T2:U25"><span class="var type1" id="S187T2U2087">moveDistance</span></span>,<span class="var type1" id="S182T44U2088">trackedMakerPosition</span> )</span></span> ;  </span></span>
<span class="srcline"><span class="lineno"><a href="49,510" id="srcline510">510</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T14:U28">isnan(<span class="var type1" id="S188T2U2093">dS_Inertial_last_k</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,511" id="srcline511">511</a></span><span class="line">    <span class="comment">% 找不到运动大于 dS 长度且trackedMakerPosition中跟踪到的点</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,512" id="srcline512">512</a></span><span class="line"><span class="comment">%     fprintf('找不到运动固定长度的点，不进行验证&lt;2&gt;，跟踪失败。\n');</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,513" id="srcline513">513</a></span><span class="line">    <span class="mxinfo" id="T2:U30"><span class="var type1" id="S178T2U2096">dPError_dS_Norm</span> = <span class="mxinfo" id="T2:U32">-<span class="mxinfo" id="T2:U33">0.2</span></span></span> ;    <span class="comment">% 给负值表示没有找到</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,514" id="srcline514">514</a></span><span class="line">    <span class="mxinfo" id="T2:U34"><span class="var type1" id="S179T2U2101">angleErr_dS</span> = <span class="mxinfo" id="T2:U36"><span class="mxinfo" id="T2:U37">-10*pi</span>/<span class="mxinfo" id="T2:U38">180</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,515" id="srcline515">515</a></span><span class="line">    <span class="mxinfo" id="T2:U39"><span class="var type1" id="S177T2U2111">TrackFlag</span> = <span class="mxinfo" id="T2:U41">-<span class="mxinfo" id="T2:U42">1.4</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,516" id="srcline516">516</a></span><span class="line">    <span class="keyword">return</span>; </span></span>
<span class="srcline"><span class="lineno"><a href="49,517" id="srcline517">517</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,518" id="srcline518">518</a></span><span class="line"><span class="mxinfo" id="T2:U43"><span class="var type1" id="S192T2U2117">dS_Vision_last_k</span> = <span class="mxinfo" id="T2:U45"><span class="var type1" id="S185T16U2119">InertialData_visual_k</span>(<span class="var type1" id="S188T2U2120">dS_Inertial_last_k</span>)</span></span>  ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,519" id="srcline519">519</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,520" id="srcline520">520</a></span><span class="line"><span class="mxinfo" id="T6:U48"><span class="var type1" id="S193T6U2123">dP_Inertial</span> = <span class="mxinfo" id="T6:U50"><span class="mxinfo" id="T6:U51"><span class="var type1" id="S180T19U2126">InertialPosition</span>(:,<span class="var type1" id="S181T4U2128">inertial_k</span>)</span> - <span class="mxinfo" id="T6:U54"><span class="var type1" id="S180T19U2130">InertialPosition</span>(:,<span class="var type1" id="S188T2U2132">dS_Inertial_last_k</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,521" id="srcline521">521</a></span><span class="line"><span class="mxinfo" id="T6:U57"><span class="var type1" id="S194T6U2135">dP_Vision</span> = <span class="mxinfo" id="T6:U59"><span class="var type1" id="S183T6U2137">otherMakersPosition_k_min</span> - <span class="mxinfo" id="T6:U61"><span class="var type1" id="S182T44U2139">trackedMakerPosition</span>(:,<span class="var type1" id="S192T2U2141">dS_Vision_last_k</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,522" id="srcline522">522</a></span><span class="line"><span class="mxinfo" id="T6:U64"><span class="var type1" id="S195T6U2144">dPError_dS</span> = <span class="mxinfo" id="T6:U66"><span class="var type1" id="S193T6U2146">dP_Inertial</span>-<span class="var type1" id="S194T6U2147">dP_Vision</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,523" id="srcline523">523</a></span><span class="line"><span class="mxinfo" id="T2:U69"><span class="var type1" id="S178T2U2150">dPError_dS_Norm</span> = <span class="mxinfo" id="T2:U71">normest(<span class="var type1" id="S195T6U2153">dPError_dS</span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,524" id="srcline524">524</a></span><span class="line"><span class="mxinfo" id="T2:U73"><span class="var type1" id="S197T2U2156">temp</span> = <span class="mxinfo" id="T2:U75"><span class="mxinfo" id="T2:U76"><span class="mxinfo" id="T2:U77"><span class="mxinfo" id="T20:U78"><span class="var type1" id="S193T6U2161">dP_Inertial</span>'</span>*<span class="var type1" id="S194T6U2162">dP_Vision</span></span> / <span class="mxinfo" id="T2:U81">normest(<span class="var type1" id="S193T6U2165">dP_Inertial</span>)</span></span> / <span class="mxinfo" id="T2:U83">normest(<span class="var type1" id="S194T6U2168">dP_Vision</span>)</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,525" id="srcline525">525</a></span><span class="line"><span class="mxinfo" id="T2:U85"><span class="var type1" id="S179T2U2171">angleErr_dS</span> = <span class="mxinfo" id="T2:U87">acos(<span class="var type1" id="S197T2U2174">temp</span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,526" id="srcline526">526</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,527" id="srcline527">527</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T14:U89"><span class="var type1" id="S178T2U2179">dPError_dS_Norm</span> &lt; <span class="mxinfo" id="T2:U91"><span class="var type1" id="S184T34U2181">makerTrackThreshold</span>.MaxPositionError_dS</span></span>  &amp;&amp; <span class="mxinfo" id="T14:U93"><span class="var type1" id="S179T2U2184">angleErr_dS</span> &lt; <span class="mxinfo" id="T2:U95"><span class="var type1" id="S184T34U2186">makerTrackThreshold</span>.Max_dPAngle_dS</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,528" id="srcline528">528</a></span><span class="line">    <span class="comment">% 距离和角度 满足</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,529" id="srcline529">529</a></span><span class="line">    <span class="mxinfo" id="T69:U97"><span class="var type1" id="S176T69U2190">trackedMakerPosition_k_OK</span> = <span class="var type1" id="S183T6U2191">otherMakersPosition_k_min</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,530" id="srcline530">530</a></span><span class="line">    <span class="mxinfo" id="T2:U100"><span class="var type1" id="S177T2U2194">TrackFlag</span> = <span class="mxinfo" id="T2:U102"><span class="mxinfo" id="T2:U103">4</span>+<span class="var type1" id="S177T2U2197">TrackFlag</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,531" id="srcline531">531</a></span><span class="line"><span class="comment">%     fprintf('3.1）3.2） 模=%0.3f，角度差=%0.3f，跟踪OK \n',normest(dPError_dS),angleErr_dS*180/pi);</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,532" id="srcline532">532</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,533" id="srcline533">533</a></span><span class="line">    <span class="mxinfo" id="T2:U105"><span class="var type1" id="S177T2U2201">TrackFlag</span> = <span class="mxinfo" id="T2:U107">-<span class="var type1" id="S177T2U2203">TrackFlag</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,534" id="srcline534">534</a></span><span class="line"><span class="comment">%     fprintf('3.1）3.2） 模=%0.3f，角度差=%0.3f，跟踪失败 \n',normest(dPError_dS),angleErr_dS*180/pi);</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,535" id="srcline535">535</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,536" id="srcline536">536</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,537" id="srcline537">537</a></span><span class="line"><span class="comment">%% 马克点判定 3) 短时间（dT=3）运动的过程，惯性和视觉位移差 dPError_dT 进行判定， dPError_dT(i) = normest(dP_Inertial-dP_Vision)</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,538" id="srcline538">538</a></span><span class="line"></span></span>
</pre>
