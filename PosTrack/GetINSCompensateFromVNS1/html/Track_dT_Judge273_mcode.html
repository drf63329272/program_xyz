<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="49,536" id="srcline536">536</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,537" id="srcline537">537</a></span><span class="line"><span class="comment">%% 马克点判定 3) 短时间（dT=3）运动的过程，惯性和视觉位移差 dPError_dT 进行判定， dPError_dT(i) = normest(dP_Inertial-dP_Vision)</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,538" id="srcline538">538</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,539" id="srcline539">539</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S200T69U2206">trackedMakerPosition_k_OK</span>,<span class="var type1" id="S201T2U2207">TrackFlag</span>,<span class="var type1" id="S202T2U2208">min_dT_k</span>,<span class="var type1" id="S203T2U2209">dPErrorNorm_dT_Min</span>,<span class="var type1" id="S204T2U2210">dPError_dT_z_Min</span>,<span class="var type1" id="S205T2U2211">dP_Inertial_xyNorm_Min</span>,<span class="var type1" id="S206T2U2212">angleErr_dT_Min</span> ]<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,540" id="srcline540">540</a></span><span class="line">    = Track_dT_Judge( <span class="var type1" id="S207T41U2215">otherMakers_k</span>,<span class="var type1" id="S208T19U2216">InertialPosition</span>,<span class="var type1" id="S209T4U2217">inertial_k</span>,<span class="var type1" id="S210T4U2218">inertial_dT_k_last</span>,<span class="var type1" id="S211T6U2219">trackedMakerPosition_last_k_dT</span>,<span class="var type1" id="S212T34U2220">makerTrackThreshold</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="49,541" id="srcline541">541</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,542" id="srcline542">542</a></span><span class="line"><span class="comment">% global InertialData</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,543" id="srcline543">543</a></span><span class="line"><span class="mxinfo" id="T69:U14"><span class="var type1" id="S200T69U2223">trackedMakerPosition_k_OK</span> = <span class="mxinfo" id="T2:U16">NaN</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,544" id="srcline544">544</a></span><span class="line"><span class="mxinfo" id="T3:U17"><span class="var type1" id="S214T3U2228">otherMakersPosition_k</span> = <span class="mxinfo" id="T3:U19"><span class="var type1" id="S207T41U2230">otherMakers_k</span>.Position</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,545" id="srcline545">545</a></span><span class="line"><span class="mxinfo" id="T2:U21"><span class="var type1" id="S201T2U2234">TrackFlag</span> = <span class="mxinfo" id="T2:U23">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,546" id="srcline546">546</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,547" id="srcline547">547</a></span><span class="line"><span class="mxinfo" id="T2:U24"><span class="var type1" id="S215T2U2238">M</span> = <span class="mxinfo" id="T2:U26">size(<span class="var type1" id="S214T3U2241">otherMakersPosition_k</span>,2)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,548" id="srcline548">548</a></span><span class="line"><span class="mxinfo" id="T6:U28"><span class="var type1" id="S217T6U2245">dP_Inertial</span> = <span class="mxinfo" id="T6:U30"><span class="mxinfo" id="T6:U31"><span class="var type1" id="S208T19U2248">InertialPosition</span>(:,<span class="var type1" id="S209T4U2250">inertial_k</span>)</span> - <span class="mxinfo" id="T6:U34"><span class="var type1" id="S208T19U2252">InertialPosition</span>(:,<span class="var type1" id="S210T4U2254">inertial_dT_k_last</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,549" id="srcline549">549</a></span><span class="line"><span class="mxinfo" id="T40:U37"><span class="var type1" id="S218T40U2257">dP_Inertial_xy</span> = <span class="mxinfo" id="T40:U39"><span class="var type1" id="S217T6U2259">dP_Inertial</span>(<span class="mxinfo" id="T35:U41"><span class="mxinfo" id="T2:U42">1</span>:<span class="mxinfo" id="T2:U43">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,550" id="srcline550">550</a></span><span class="line"><span class="mxinfo" id="T2:U44"><span class="var type1" id="S219T2U2265">dP_Inertial_z</span> = <span class="mxinfo" id="T2:U46"><span class="var type1" id="S217T6U2267">dP_Inertial</span>(<span class="mxinfo" id="T2:U48">3</span>)</span></span>;  <span class="comment">% 向下为正</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,551" id="srcline551">551</a></span><span class="line"><span class="mxinfo" id="T7:U49"><span class="var type1" id="S220T7U2271">dPErrorNorm_dT</span>  = <span class="mxinfo" id="T7:U51">zeros(<span class="mxinfo" id="T2:U52">1</span>,<span class="mxinfo" id="T2:U53"><span class="var type1" id="S215T2U2275">M</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,552" id="srcline552">552</a></span><span class="line"><span class="mxinfo" id="T7:U55"><span class="var type1" id="S222T7U2278">dPError_dT_xy</span>  = <span class="mxinfo" id="T7:U57">zeros(<span class="mxinfo" id="T2:U58">1</span>,<span class="mxinfo" id="T2:U59"><span class="var type1" id="S215T2U2282">M</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,553" id="srcline553">553</a></span><span class="line"><span class="mxinfo" id="T7:U61"><span class="var type1" id="S223T7U2285">dPError_dT_z</span>  = <span class="mxinfo" id="T7:U63">zeros(<span class="mxinfo" id="T2:U64">1</span>,<span class="mxinfo" id="T2:U65"><span class="var type1" id="S215T2U2289">M</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,554" id="srcline554">554</a></span><span class="line"><span class="mxinfo" id="T3:U67"><span class="var type1" id="S224T3U2292">dP_Vision</span> = <span class="mxinfo" id="T3:U69">zeros(<span class="mxinfo" id="T2:U70">3</span>,<span class="mxinfo" id="T2:U71"><span class="var type1" id="S215T2U2296">M</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,555" id="srcline555">555</a></span><span class="line"><span class="mxinfo" id="T7:U73"><span class="var type1" id="S225T7U2299">angleErr_dT</span>  = <span class="mxinfo" id="T7:U75">NaN(<span class="mxinfo" id="T2:U76">1</span>,<span class="mxinfo" id="T2:U77"><span class="var type1" id="S215T2U2303">M</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,556" id="srcline556">556</a></span><span class="line"><span class="mxinfo" id="T2:U79"><span class="var type1" id="S206T2U2306">angleErr_dT_Min</span> = <span class="mxinfo" id="T2:U81">NaN</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,557" id="srcline557">557</a></span><span class="line"><span class="comment">%% 位移差 模， 角度差</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,558" id="srcline558">558</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S226T2U2311">i</span>=<span class="mxinfo" id="T2:U83">1</span>:<span class="var type1" id="S215T2U2314">M</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,559" id="srcline559">559</a></span><span class="line">    <span class="mxinfo" id="T6:U85"><span class="var type1" id="S227T6U2317">otherMakersPosition_k_i</span> = <span class="mxinfo" id="T6:U87"><span class="var type1" id="S214T3U2319">otherMakersPosition_k</span>(:,<span class="var type1" id="S226T2U2321">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,560" id="srcline560">560</a></span><span class="line">    <span class="mxinfo" id="T6:U90"><span class="mxinfo" id="T6:U91"><span class="var type1" id="S224T3U2325">dP_Vision</span>(:,<span class="var type1" id="S226T2U2327">i</span>)</span> = <span class="mxinfo" id="T6:U94"><span class="var type1" id="S227T6U2329">otherMakersPosition_k_i</span> - <span class="var type1" id="S211T6U2330">trackedMakerPosition_last_k_dT</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,561" id="srcline561">561</a></span><span class="line">    <span class="comment">% 位移差</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,562" id="srcline562">562</a></span><span class="line">    <span class="mxinfo" id="T2:U97"><span class="mxinfo" id="T2:U98"><span class="var type1" id="S220T7U2334">dPErrorNorm_dT</span>(<span class="var type1" id="S226T2U2335">i</span>)</span> = <span class="mxinfo" id="T2:U101">normest(<span class="mxinfo" id="T6:U102"><span class="var type1" id="S217T6U2339">dP_Inertial</span>-<span class="mxinfo" id="T6:U104"><span class="var type1" id="S224T3U2341">dP_Vision</span>(:,<span class="var type1" id="S226T2U2343">i</span>)</span></span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,563" id="srcline563">563</a></span><span class="line">    <span class="mxinfo" id="T2:U107"><span class="mxinfo" id="T2:U108"><span class="var type1" id="S222T7U2347">dPError_dT_xy</span>(<span class="var type1" id="S226T2U2348">i</span>)</span> = <span class="mxinfo" id="T2:U111">normest(<span class="mxinfo" id="T40:U112"><span class="var type1" id="S218T40U2352">dP_Inertial_xy</span>-<span class="mxinfo" id="T40:U114"><span class="var type1" id="S224T3U2354">dP_Vision</span>(<span class="mxinfo" id="T35:U116"><span class="mxinfo" id="T2:U117">1</span>:<span class="mxinfo" id="T2:U118">2</span></span>,<span class="var type1" id="S226T2U2358">i</span>)</span></span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,564" id="srcline564">564</a></span><span class="line">    <span class="mxinfo" id="T2:U120"><span class="mxinfo" id="T2:U121"><span class="var type1" id="S223T7U2362">dPError_dT_z</span>(<span class="var type1" id="S226T2U2363">i</span>)</span> = <span class="mxinfo" id="T2:U124"><span class="var type1" id="S219T2U2365">dP_Inertial_z</span>-<span class="mxinfo" id="T2:U126"><span class="var type1" id="S224T3U2367">dP_Vision</span>(<span class="mxinfo" id="T2:U128">3</span>,<span class="var type1" id="S226T2U2369">i</span>)</span></span></span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="49,565" id="srcline565">565</a></span><span class="line">    <span class="comment">% 低头时，dP_Inertial_z和dP_Vision(3,i)都为正，dP_Vision(3,i)的模更大，dPError_dT_z(i)为负</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,566" id="srcline566">566</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="49,567" id="srcline567">567</a></span><span class="line">    <span class="comment">% 角度差</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,568" id="srcline568">568</a></span><span class="line">    <span class="mxinfo" id="T2:U130"><span class="var type1" id="S229T2U2372">temp</span> = <span class="mxinfo" id="T2:U132"><span class="mxinfo" id="T2:U133"><span class="mxinfo" id="T2:U134"><span class="mxinfo" id="T20:U135"><span class="var type1" id="S217T6U2377">dP_Inertial</span>'</span>*<span class="mxinfo" id="T6:U137"><span class="var type1" id="S224T3U2379">dP_Vision</span>(:,<span class="var type1" id="S226T2U2381">i</span>)</span></span> / <span class="mxinfo" id="T2:U140">normest(<span class="var type1" id="S217T6U2384">dP_Inertial</span>)</span></span> / <span class="mxinfo" id="T2:U142">normest(<span class="mxinfo" id="T6:U143"><span class="var type1" id="S224T3U2388">dP_Vision</span>(:,<span class="var type1" id="S226T2U2390">i</span>)</span>)</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,569" id="srcline569">569</a></span><span class="line">    <span class="mxinfo" id="T2:U146"><span class="mxinfo" id="T2:U147"><span class="var type1" id="S225T7U2394">angleErr_dT</span>(<span class="var type1" id="S226T2U2395">i</span>)</span> = <span class="mxinfo" id="T2:U150">acos(<span class="var type1" id="S229T2U2398">temp</span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,570" id="srcline570">570</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,571" id="srcline571">571</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,572" id="srcline572">572</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,573" id="srcline573">573</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,574" id="srcline574">574</a></span><span class="line"><span class="mxinfo" id="T2:U152">[<span class="var type1" id="S203T2U2402">dPErrorNorm_dT_Min</span>,<span class="var type1" id="S202T2U2403">min_dT_k</span>] = min(<span class="var type1" id="S220T7U2406">dPErrorNorm_dT</span>,[],2)</span>;  <span class="comment">% 取位移差最小的点判断</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,575" id="srcline575">575</a></span><span class="line"><span class="mxinfo" id="T2:U156"><span class="var type1" id="S204T2U2412">dPError_dT_z_Min</span> = <span class="mxinfo" id="T2:U158"><span class="var type1" id="S223T7U2414">dPError_dT_z</span>(<span class="var type1" id="S202T2U2415">min_dT_k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,576" id="srcline576">576</a></span><span class="line"><span class="comment">% 惯性位移大小 ： 评价静止还是运动</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,577" id="srcline577">577</a></span><span class="line"><span class="mxinfo" id="T6:U161"><span class="var type1" id="S232T6U2418">otherMakersPosition_k_min</span> = <span class="mxinfo" id="T6:U163"><span class="var type1" id="S214T3U2420">otherMakersPosition_k</span>(:,<span class="var type1" id="S202T2U2422">min_dT_k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,578" id="srcline578">578</a></span><span class="line"><span class="mxinfo" id="T2:U166"><span class="var type1" id="S233T2U2425">dP_Inertial_Norm</span> = <span class="mxinfo" id="T2:U168">normest(<span class="var type1" id="S217T6U2428">dP_Inertial</span>)</span></span> ;  </span></span>
<span class="srcline"><span class="lineno"><a href="49,579" id="srcline579">579</a></span><span class="line"><span class="mxinfo" id="T2:U170"><span class="var type1" id="S205T2U2431">dP_Inertial_xyNorm_Min</span> = <span class="mxinfo" id="T2:U172">normest(<span class="mxinfo" id="T40:U173"><span class="var type1" id="S217T6U2435">dP_Inertial</span>(<span class="mxinfo" id="T35:U175"><span class="mxinfo" id="T2:U176">1</span>:<span class="mxinfo" id="T2:U177">2</span></span>)</span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,580" id="srcline580">580</a></span><span class="line"><span class="mxinfo" id="T2:U178"><span class="var type1" id="S234T2U2441">dP_Inertial_z_Min</span> = <span class="mxinfo" id="T2:U180"><span class="var type1" id="S217T6U2443">dP_Inertial</span>(<span class="mxinfo" id="T2:U182">3</span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,581" id="srcline581">581</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T14:U183"><span class="var type1" id="S233T2U2448">dP_Inertial_Norm</span> &lt; <span class="mxinfo" id="T2:U185"><span class="var type1" id="S212T34U2450">makerTrackThreshold</span>.MaxStaticDisp_dT</span></span>  </span></span>
<span class="srcline"><span class="lineno"><a href="49,582" id="srcline582">582</a></span><span class="line">    <span class="comment">%% 准静止状态，用dS位移判断</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,583" id="srcline583">583</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T14:U187"><span class="var type1" id="S203T2U2455">dPErrorNorm_dT_Min</span> &gt; <span class="mxinfo" id="T2:U189"><span class="var type1" id="S212T34U2457">makerTrackThreshold</span>.PositionErrorBear_dT</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,584" id="srcline584">584</a></span><span class="line">        <span class="comment">% 马克点明显运动，剔除</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,585" id="srcline585">585</a></span><span class="line">        <span class="mxinfo" id="T2:U191"><span class="var type1" id="S201T2U2461">TrackFlag</span> = <span class="mxinfo" id="T2:U193">-<span class="mxinfo" id="T2:U194">3.1</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,586" id="srcline586">586</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,587" id="srcline587">587</a></span><span class="line">        <span class="comment">% 惯性视觉运动位移差小，且连续于跟踪OK的马克点，则跟踪OK。</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,588" id="srcline588">588</a></span><span class="line">        <span class="comment">%% 连续判断出错时会误判</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,589" id="srcline589">589</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo" id="T14:U195"><span class="mxinfo" id="T2:U196"><span class="mxinfo" id="T7:U197"><span class="var type1" id="S207T41U2470">otherMakers_k</span>.ContinuesFlag</span>(<span class="var type1" id="S202T2U2472">min_dT_k</span>)</span>==<span class="mxinfo" id="T2:U200">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,590" id="srcline590">590</a></span><span class="line">            <span class="mxinfo" id="T69:U201"><span class="var type1" id="S200T69U2476">trackedMakerPosition_k_OK</span> = <span class="mxinfo" id="T6:U203"><span class="var type1" id="S214T3U2478">otherMakersPosition_k</span>(:,<span class="var type1" id="S202T2U2480">min_dT_k</span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,591" id="srcline591">591</a></span><span class="line">            <span class="mxinfo" id="T2:U206"><span class="var type1" id="S201T2U2483">TrackFlag</span> = <span class="mxinfo" id="T2:U208">3.1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,592" id="srcline592">592</a></span><span class="line">            <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,593" id="srcline593">593</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,594" id="srcline594">594</a></span><span class="line">            <span class="comment">% 惯性视觉运动位移差小，但不连续，进入4）判断</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,595" id="srcline595">595</a></span><span class="line">            <span class="mxinfo" id="T2:U209"><span class="var type1" id="S201T2U2489">TrackFlag</span> = <span class="mxinfo" id="T2:U211">1.31</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,596" id="srcline596">596</a></span><span class="line">            <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,597" id="srcline597">597</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,598" id="srcline598">598</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,599" id="srcline599">599</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="49,600" id="srcline600">600</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,601" id="srcline601">601</a></span><span class="line">    <span class="comment">%% 运动状态：</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,602" id="srcline602">602</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T14:U212"><span class="mxinfo" id="T2:U213"><span class="mxinfo" id="T7:U214"><span class="var type1" id="S207T41U2498">otherMakers_k</span>.ContinuesFlag</span>(<span class="var type1" id="S202T2U2500">min_dT_k</span>)</span>==<span class="mxinfo" id="T2:U217">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,603" id="srcline603">603</a></span><span class="line">       <span class="comment">%% 与前一时刻跟踪成功的点连续则放宽要求</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,604" id="srcline604">604</a></span><span class="line">       <span class="mxinfo" id="T2:U218"><span class="var type1" id="S235T2U2504">PositionErrorBear_dT</span> = <span class="mxinfo" id="T2:U220"><span class="mxinfo" id="T2:U221"><span class="var type1" id="S212T34U2507">makerTrackThreshold</span>.PositionErrorBear_dT</span>*<span class="mxinfo" id="T2:U223"><span class="var type1" id="S212T34U2510">makerTrackThreshold</span>.ContinuesTrackedMagnifyRate</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,605" id="srcline605">605</a></span><span class="line">       <span class="mxinfo" id="T2:U225"><span class="var type1" id="S236T2U2514">Max_dPAngle_dS</span>=  <span class="mxinfo" id="T2:U227"><span class="mxinfo" id="T2:U228"><span class="var type1" id="S212T34U2517">makerTrackThreshold</span>.Max_dPAngle_dS</span>*<span class="mxinfo" id="T2:U230"><span class="var type1" id="S212T34U2520">makerTrackThreshold</span>.ContinuesTrackedMagnifyRate</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,606" id="srcline606">606</a></span><span class="line">       <span class="mxinfo" id="T35:U232"><span class="var type1" id="S237T35U2524">MaxHighMoveErrRate</span> = <span class="mxinfo" id="T35:U234"><span class="mxinfo" id="T35:U235"><span class="var type1" id="S212T34U2527">makerTrackThreshold</span>.MaxHighMoveErrRate</span>*<span class="mxinfo" id="T2:U237"><span class="var type1" id="S212T34U2530">makerTrackThreshold</span>.ContinuesTrackedMagnifyRate</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,607" id="srcline607">607</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,608" id="srcline608">608</a></span><span class="line">        <span class="mxinfo" id="T2:U239"><span class="var type1" id="S235T2U2535">PositionErrorBear_dT</span> = <span class="mxinfo" id="T2:U241"><span class="var type1" id="S212T34U2537">makerTrackThreshold</span>.PositionErrorBear_dT</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,609" id="srcline609">609</a></span><span class="line">       <span class="mxinfo" id="T2:U243"><span class="var type1" id="S236T2U2541">Max_dPAngle_dS</span>=  <span class="mxinfo" id="T2:U245"><span class="var type1" id="S212T34U2543">makerTrackThreshold</span>.Max_dPAngle_dS</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,610" id="srcline610">610</a></span><span class="line">       <span class="mxinfo" id="T35:U247"><span class="var type1" id="S237T35U2547">MaxHighMoveErrRate</span> = <span class="mxinfo" id="T35:U249"><span class="var type1" id="S212T34U2549">makerTrackThreshold</span>.MaxHighMoveErrRate</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,611" id="srcline611">611</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,612" id="srcline612">612</a></span><span class="line">    <span class="comment">% 静止点直接剔除</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,613" id="srcline613">613</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T14:U251"><span class="mxinfo" id="T2:U252">normest( <span class="mxinfo" id="T6:U253"><span class="var type1" id="S224T3U2557">dP_Vision</span>(:,<span class="var type1" id="S202T2U2559">min_dT_k</span>)</span> )</span>&lt;<span class="mxinfo" id="T2:U256"><span class="var type1" id="S212T34U2561">makerTrackThreshold</span>.MaxStaticDisp_dT</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,614" id="srcline614">614</a></span><span class="line">        <span class="mxinfo" id="T2:U258"><span class="var type1" id="S201T2U2565">TrackFlag</span>=<span class="mxinfo" id="T2:U260">1.35</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,615" id="srcline615">615</a></span><span class="line">        <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,616" id="srcline616">616</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,617" id="srcline617">617</a></span><span class="line">    <span class="comment">%% 高度变化大，水平方向不可信，直接通过高度判定</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,618" id="srcline618">618</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T14:U261"><span class="mxinfo" id="T2:U262">normest(<span class="var type1" id="S234T2U2573">dP_Inertial_z_Min</span>)</span> &gt; <span class="mxinfo" id="T2:U264"><span class="var type1" id="S212T34U2575">makerTrackThreshold</span>.BigHighMove</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,619" id="srcline619">619</a></span><span class="line">       <span class="mxinfo" id="T2:U266"><span class="var type1" id="S238T2U2579">HighMoveErr</span> = <span class="mxinfo" id="T2:U268"><span class="mxinfo" id="T2:U269"><span class="var type1" id="S223T7U2582">dPError_dT_z</span>(<span class="var type1" id="S202T2U2583">min_dT_k</span>)</span> / <span class="var type1" id="S234T2U2584">dP_Inertial_z_Min</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,620" id="srcline620">620</a></span><span class="line">       <span class="keyword">if</span> <span class="mxinfo" id="T14:U273"><span class="var type1" id="S238T2U2589">HighMoveErr</span>&gt;<span class="mxinfo" id="T2:U275"><span class="var type1" id="S237T35U2591">MaxHighMoveErrRate</span>(<span class="mxinfo" id="T2:U277">1</span>)</span></span> &amp;&amp; <span class="mxinfo" id="T14:U278"><span class="var type1" id="S238T2U2594">HighMoveErr</span> &lt; <span class="mxinfo" id="T2:U280"><span class="var type1" id="S237T35U2596">MaxHighMoveErrRate</span>(<span class="mxinfo" id="T2:U282">2</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,621" id="srcline621">621</a></span><span class="line">           <span class="comment">%% 高度方向位移误差比例小，跟踪OK</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,622" id="srcline622">622</a></span><span class="line">           <span class="mxinfo" id="T2:U283"><span class="var type1" id="S201T2U2600">TrackFlag</span> = <span class="mxinfo" id="T2:U285">3.9</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,623" id="srcline623">623</a></span><span class="line">           <span class="mxinfo" id="T69:U286"><span class="var type1" id="S200T69U2604">trackedMakerPosition_k_OK</span> = <span class="mxinfo" id="T6:U288"><span class="var type1" id="S214T3U2606">otherMakersPosition_k</span>(:,<span class="var type1" id="S202T2U2608">min_dT_k</span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,624" id="srcline624">624</a></span><span class="line">           <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,625" id="srcline625">625</a></span><span class="line">       <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,626" id="srcline626">626</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,627" id="srcline627">627</a></span><span class="line">    <span class="comment">%% （角度差判断为主）当运动距离超过 moveDistance 时，判断角度差，并放宽位移差条件</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,628" id="srcline628">628</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T14:U291"><span class="var type1" id="S233T2U2613">dP_Inertial_Norm</span> &gt; <span class="mxinfo" id="T2:U293"><span class="var type1" id="S212T34U2615">makerTrackThreshold</span>.moveDistance</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,629" id="srcline629">629</a></span><span class="line">       <span class="keyword">if</span> <span class="mxinfo" id="T14:U295"><span class="mxinfo" id="T2:U296"><span class="var type1" id="S225T7U2622">angleErr_dT</span>(<span class="var type1" id="S202T2U2623">min_dT_k</span>)</span> &lt;  <span class="mxinfo" id="T2:U299"><span class="var type1" id="S212T34U2625">makerTrackThreshold</span>.Max_dPAngle_dS</span></span> &amp;&amp; <span class="mxinfo" id="T14:U301"><span class="var type1" id="S203T2U2628">dPErrorNorm_dT_Min</span> &lt; <span class="mxinfo" id="T2:U303"><span class="var type1" id="S212T34U2630">makerTrackThreshold</span>.MaxPositionError_dS</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,630" id="srcline630">630</a></span><span class="line">            <span class="mxinfo" id="T69:U305"><span class="var type1" id="S200T69U2634">trackedMakerPosition_k_OK</span> = <span class="var type1" id="S232T6U2635">otherMakersPosition_k_min</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,631" id="srcline631">631</a></span><span class="line">            <span class="mxinfo" id="T2:U308"><span class="var type1" id="S201T2U2638">TrackFlag</span> = <span class="mxinfo" id="T2:U310">3.7</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,632" id="srcline632">632</a></span><span class="line">            <span class="mxinfo" id="T2:U311"><span class="var type1" id="S206T2U2642">angleErr_dT_Min</span> = <span class="mxinfo" id="T2:U313"><span class="var type1" id="S225T7U2644">angleErr_dT</span>(<span class="var type1" id="S202T2U2645">min_dT_k</span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,633" id="srcline633">633</a></span><span class="line">            <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,634" id="srcline634">634</a></span><span class="line">       <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,635" id="srcline635">635</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,636" id="srcline636">636</a></span><span class="line">    <span class="comment">%% 位移差判断为主</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,637" id="srcline637">637</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T14:U316"><span class="var type1" id="S203T2U2651">dPErrorNorm_dT_Min</span> &lt; <span class="var type1" id="S235T2U2652">PositionErrorBear_dT</span></span>  &amp;&amp; <span class="mxinfo" id="T14:U319"><span class="mxinfo" id="T2:U320"><span class="var type1" id="S225T7U2655">angleErr_dT</span>(<span class="var type1" id="S202T2U2656">min_dT_k</span>)</span> &lt;  <span class="mxinfo" id="T2:U323"><span class="var type1" id="S236T2U2658">Max_dPAngle_dS</span>*<span class="mxinfo" id="T2:U325">2</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,638" id="srcline638">638</a></span><span class="line">        <span class="mxinfo" id="T69:U326"><span class="var type1" id="S200T69U2662">trackedMakerPosition_k_OK</span> = <span class="var type1" id="S232T6U2663">otherMakersPosition_k_min</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,639" id="srcline639">639</a></span><span class="line">        <span class="mxinfo" id="T2:U329"><span class="var type1" id="S201T2U2666">TrackFlag</span> = <span class="mxinfo" id="T2:U331">3.5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,640" id="srcline640">640</a></span><span class="line">    <span class="comment">%     fprintf( '3.5）惯性视觉位移差长度=%0.4f ，跟踪OK\n',normest(dPError_dT) );</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,641" id="srcline641">641</a></span><span class="line">        <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,642" id="srcline642">642</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,643" id="srcline643">643</a></span><span class="line">    <span class="mxinfo" id="T2:U332"><span class="var type1" id="S201T2U2671">TrackFlag</span>=<span class="mxinfo" id="T2:U334">1.37</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,644" id="srcline644">644</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,645" id="srcline645">645</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,646" id="srcline646">646</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T14:U335"><span class="var type1" id="S201T2U2676">TrackFlag</span>==<span class="mxinfo" id="T2:U337">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,647" id="srcline647">647</a></span><span class="line">   <span class="mxinfo" id="T78:U338"><span class="autoExtrinsicFcn" id="F530N25:B2680">disp</span>(<span class="mxinfo" id="T11:U339"><span class="string">'error'</span></span>)</span>  </span></span>
<span class="srcline"><span class="lineno"><a href="49,648" id="srcline648">648</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,649" id="srcline649">649</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,650" id="srcline650">650</a></span><span class="line"><span class="comment">%% 马克点连续性判断</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,651" id="srcline651">651</a></span><span class="line"><span class="comment">% dPi_ConJudge ： 连续性判断指标的大小：前后两帧的位移模</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,652" id="srcline652">652</a></span><span class="line"><span class="comment">% ContinuesFlag = 0   不连续</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,653" id="srcline653">653</a></span><span class="line"><span class="comment">%               =1    连续，且是与跟踪成功马克点连续</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,654" id="srcline654">654</a></span><span class="line"><span class="comment">%               =2   连续，和跟踪失败的点连续</span></span></span>
</pre>
