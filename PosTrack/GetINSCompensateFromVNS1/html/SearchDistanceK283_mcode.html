<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="49,755" id="srcline755">755</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,756" id="srcline756">756</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,757" id="srcline757">757</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,758" id="srcline758">758</a></span><span class="line"><span class="comment">%% 查找惯性k时刻前运动了大于 dS 距离的最近的点</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,759" id="srcline759">759</a></span><span class="line"><span class="comment">% 且该点trackedMakerPosition跟踪成功</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,760" id="srcline760">760</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S269T2U3205">dS_Inertial_last_k</span> = SearchDistanceK( <span class="var type1" id="S270T19U3208">InertialPosition</span>,<span class="var type1" id="S271T4U3209">kCurrent</span>,<span class="var type1" id="S272T2U3210">dS</span>,<span class="var type1" id="S273T44U3211">trackedMakerPosition</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="49,761" id="srcline761">761</a></span><span class="line"><span class="keyword">global</span> <span class="var type0" id="S274T0U3213">inertialFre</span> <span class="var type0" id="S275T0U3214">InertialData_visual_k</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,762" id="srcline762">762</a></span><span class="line"><span class="mxinfo" id="T2:U6"><span class="var type1" id="S276T2U3217">stepT</span> = <span class="mxinfo" id="T2:U8">1</span></span> ;  <span class="comment">% 搜索步长时间</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,763" id="srcline763">763</a></span><span class="line"><span class="mxinfo" id="T2:U9"><span class="var type1" id="S277T2U3221">MaxSearchT</span> = <span class="mxinfo" id="T2:U11">60</span></span> ; <span class="comment">% 最长搜索时间长度</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,764" id="srcline764">764</a></span><span class="line"><span class="mxinfo" id="T2:U12"><span class="var type1" id="S278T2U3225">stepK</span> = <span class="mxinfo" id="T2:U14">fix(<span class="mxinfo" id="T2:U15"><span class="var type1" id="S274T2U3229">inertialFre</span>*<span class="mxinfo" id="T2:U17"><span class="var type1" id="S276T2U3230">stepT</span></span></span>)</span></span> ; <span class="comment">% 搜索步长</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,765" id="srcline765">765</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,766" id="srcline766">766</a></span><span class="line"><span class="mxinfo" id="T4:U19"><span class="var type1" id="S280T4U3233">maxSearchK</span> = <span class="mxinfo" id="T4:U21">min( <span class="mxinfo" id="T4:U22"><span class="var type1" id="S271T4U3237">kCurrent</span>-<span class="mxinfo" id="T4:U24">1</span></span>,<span class="mxinfo" id="T2:U25">fix(<span class="mxinfo" id="T2:U26"><span class="var type1" id="S274T2U3242">inertialFre</span>*<span class="mxinfo" id="T2:U28"><span class="var type1" id="S277T2U3243">MaxSearchT</span></span></span>)</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,767" id="srcline767">767</a></span><span class="line"><span class="mxinfo" id="T6:U30"><span class="var type1" id="S282T6U3246">InertialPosition_kSea</span> = <span class="mxinfo" id="T6:U32"><span class="var type1" id="S270T19U3248">InertialPosition</span>(:,<span class="var type1" id="S271T4U3250">kCurrent</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,768" id="srcline768">768</a></span><span class="line"><span class="mxinfo" id="T2:U35"><span class="var type1" id="S269T2U3253">dS_Inertial_last_k</span> = <span class="mxinfo" id="T2:U37">NaN</span></span> ;     <span class="comment">% 默认设置：寻找失败</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,769" id="srcline769">769</a></span><span class="line"><span class="comment">%wh = waitbar(0,'SearchDistanceK');</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,770" id="srcline770">770</a></span><span class="line"><span class="mxinfo" id="T4:U38"><span class="keyword">for</span> <span class="var type1" id="S284T4U3258">i</span>=<span class="mxinfo" id="T4:U40">1</span>:<span class="var type1" id="S278T2U3262">stepK</span>:<span class="var type1" id="S280T4U3263">maxSearchK</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,771" id="srcline771">771</a></span><span class="line"><span class="mxinfo" id="T4:U38">    <span class="mxinfo" id="T6:U43"><span class="var type1" id="S285T6U3266">dP</span> = <span class="mxinfo" id="T6:U45"><span class="mxinfo" id="T6:U46"><span class="var type1" id="S270T19U3269">InertialPosition</span>(:,<span class="mxinfo" id="T4:U48"><span class="var type1" id="S271T4U3272">kCurrent</span>-<span class="var type1" id="S284T4U3273">i</span></span>)</span> - <span class="var type1" id="S282T6U3274">InertialPosition_kSea</span></span></span> ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,772" id="srcline772">772</a></span><span class="line"><span class="mxinfo" id="T4:U38">    <span class="mxinfo" id="T2:U52"><span class="var type1" id="S286T2U3277">distance</span> = <span class="mxinfo" id="T2:U54">normest( <span class="var type1" id="S285T6U3280">dP</span> )</span></span>;</span> </span></span>
<span class="srcline"><span class="lineno"><a href="49,773" id="srcline773">773</a></span><span class="line"><span class="mxinfo" id="T4:U38">    <span class="keyword">if</span> <span class="mxinfo" id="T14:U56"><span class="var type1" id="S286T2U3284">distance</span> &gt; <span class="mxinfo" id="T2:U58"><span class="var type1" id="S272T2U3285">dS</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,774" id="srcline774">774</a></span><span class="line"><span class="comment"><span class="mxinfo" id="T4:U38">%         kCurrent_Vision = InertialK_to_VisionK(kCurrent-i);</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,775" id="srcline775">775</a></span><span class="line"><span class="mxinfo" id="T4:U38">        <span class="mxinfo" id="T2:U60"><span class="var type1" id="S288T2U3288">kCurrent_Vision</span> = <span class="mxinfo" id="T2:U62"><span class="var type1" id="S275T16U3290">InertialData_visual_k</span>(<span class="mxinfo" id="T4:U64"><span class="var type1" id="S271T4U3292">kCurrent</span>-<span class="var type1" id="S284T4U3293">i</span></span>)</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,776" id="srcline776">776</a></span><span class="line"><span class="mxinfo" id="T4:U38">        <span class="keyword">if</span> <span class="mxinfo" id="T14:U67">~<span class="mxinfo" id="T14:U68">isnan(<span class="mxinfo" id="T2:U69"><span class="var type1" id="S273T44U3300">trackedMakerPosition</span>(<span class="mxinfo" id="T2:U71">1</span>,<span class="var type1" id="S288T2U3302">kCurrent_Vision</span>)</span>)</span></span></span>            </span></span>
<span class="srcline"><span class="lineno"><a href="49,777" id="srcline777">777</a></span><span class="line"><span class="mxinfo" id="T4:U38">            </span><span class="comment"><span class="mxinfo" id="T4:U38">% 距离满足，且 trackedMakerPosition 跟踪成功</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,778" id="srcline778">778</a></span><span class="line"><span class="mxinfo" id="T4:U38">            <span class="mxinfo" id="T2:U73"><span class="var type1" id="S269T2U3305">dS_Inertial_last_k</span> = <span class="mxinfo" id="T2:U75">double(<span class="mxinfo" id="T4:U76"><span class="var type1" id="S271T4U3309">kCurrent</span>-<span class="var type1" id="S284T4U3310">i</span></span>)</span></span> ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,779" id="srcline779">779</a></span><span class="line"><span class="mxinfo" id="T4:U38">            <span class="keyword">break</span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,780" id="srcline780">780</a></span><span class="line"><span class="mxinfo" id="T4:U38">        <span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,781" id="srcline781">781</a></span><span class="line"><span class="mxinfo" id="T4:U38">    <span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,782" id="srcline782">782</a></span><span class="line"><span class="mxinfo" id="T4:U38"> </span><span class="comment"><span class="mxinfo" id="T4:U38">%   waitbar(i/kCurrent);</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,783" id="srcline783">783</a></span><span class="line"><span class="mxinfo" id="T4:U38"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,784" id="srcline784">784</a></span><span class="line"><span class="comment">%close(wh)</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,785" id="srcline785">785</a></span><span class="line"><span class="mxinfo" id="T78:U79"><span class="autoExtrinsicFcn" id="F533N25:B3314">disp</span>(<span class="mxinfo" id="T60:U80"><span class="string">''</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,786" id="srcline786">786</a></span><span class="line"></span></span>
</pre>
