<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,191" id="srcline191">191</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,192" id="srcline192">192</a></span><span class="line"><span class="comment">%% 视觉位置预处理</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,193" id="srcline193">193</a></span><span class="line"><span class="comment">% 1）将视觉数据  从视觉世界坐标系 转到 北东地坐标系</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,194" id="srcline194">194</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S61T1U627">otherMakers</span> = PreProcess( <span class="mxinfo" id="T1:U2"><span class="mxinfo" id="T1:U3"><span class="var type1" id="S61T1U630">otherMakers</span></span></span>,<span class="var type1" id="S62T6U631">BodyDirection</span>  )</span></span>
<span class="srcline"><span class="lineno"><a href="1,195" id="srcline195">195</a></span><span class="line">coder.inline(<span class="string">'never'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,196" id="srcline196">196</a></span><span class="line"><span class="keyword">global</span> <span class="var type0" id="S64T0U639">CalStartVN</span> <span class="var type0" id="S65T0U640">CalEndVN</span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,197" id="srcline197">197</a></span><span class="line"><span class="comment">%% 先转到北东地的同名坐标系</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,198" id="srcline198">198</a></span><span class="line"><span class="mxinfo" id="T28:U6"><span class="var type1" id="S66T28U643">Cv_r1</span> = <span class="mxinfo" id="T28:U8">[ 0 0 1; -1 0 0; 0 -1 0 ]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,199" id="srcline199">199</a></span><span class="line"><span class="comment">% dbstop in BodyDirection2Cr_r1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,200" id="srcline200">200</a></span><span class="line"><span class="mxinfo" id="T28:U9"><span class="var type1" id="S67T28U661">Cr_r1</span> = <span class="mxinfo" id="T28:U11"><span class="fcn" id="F57N5:B663">BodyDirection2Cr_r1</span>( <span class="var type1" id="S62T6U664">BodyDirection</span> )</span></span>;   <span class="comment">%   （法1）    要求人朝视觉标定标定的世界坐标系进行对准</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,201" id="srcline201">201</a></span><span class="line"><span class="mxinfo" id="T28:U13"><span class="var type1" id="S69T28U667">Cvr</span> = <span class="mxinfo" id="T28:U15"><span class="mxinfo" id="T28:U16"><span class="var type1" id="S67T28U670">Cr_r1</span>'</span> * <span class="mxinfo" id="T28:U18"><span class="var type1" id="S66T28U671">Cv_r1</span></span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,202" id="srcline202">202</a></span><span class="line"><span class="mxinfo" id="T28:U20"><span class="var type1" id="S69T28U674">Cvr</span> = <span class="mxinfo" id="T28:U22"><span class="var type1" id="S66T28U675">Cv_r1</span></span></span> ;         <span class="comment">%   （法2）    要求视觉世界坐标系的Z轴朝向正北</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,203" id="srcline203">203</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,204" id="srcline204">204</a></span><span class="line"><span class="comment">%% 先转到 惯性系 的北东地，并以视觉的初始点为原点（不处理高度）</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,205" id="srcline205">205</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,206" id="srcline206">206</a></span><span class="line"><span class="mxinfo" id="T6:U24"><span class="var type1" id="S70T6U678">Position_1</span> = <span class="mxinfo" id="T6:U26"><span class="mxinfo" id="T3:U27"><span class="mxinfo" id="T41:U28"><span class="var type1" id="S61T1U682">otherMakers</span>(<span class="mxinfo" id="T2:U30">1</span>)</span>.Position</span>(:,<span class="mxinfo" id="T2:U31">1</span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,207" id="srcline207">207</a></span><span class="line"><span class="mxinfo" id="T2:U32"><span class="mxinfo" id="T2:U33"><span class="var type1" id="S70T6U690">Position_1</span>(<span class="mxinfo" id="T2:U35">2</span>)</span> = <span class="mxinfo" id="T2:U36">0</span></span> ;      <span class="comment">% 不处理高度方向</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,208" id="srcline208">208</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,209" id="srcline209">209</a></span><span class="line"><span class="mxinfo" id="T4:U37"><span class="keyword">for</span> <span class="var type1" id="S71T4U695">k</span>=<span class="var type1" id="S64T4U697">CalStartVN</span>:<span class="var type1" id="S65T4U698">CalEndVN</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,210" id="srcline210">210</a></span><span class="line"><span class="mxinfo" id="T4:U37">    <span class="mxinfo" id="T3:U41"><span class="var type1" id="S72T3U701">Position_k</span> = <span class="mxinfo" id="T3:U43"><span class="mxinfo" id="T41:U44"><span class="var type1" id="S61T1U704">otherMakers</span>(<span class="var type1" id="S71T4U705">k</span>)</span>.Position</span></span> ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,211" id="srcline211">211</a></span><span class="line"><span class="mxinfo" id="T4:U37">    <span class="keyword">if</span> ~isempty(<span class="var type1" id="S72T3U712">Position_k</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,212" id="srcline212">212</a></span><span class="line"><span class="comment"><span class="mxinfo" id="T4:U37">%         m = size(Position_k,2);</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,213" id="srcline213">213</a></span><span class="line"><span class="comment"><span class="mxinfo" id="T4:U37">%         position_offest = repmat(Position_1,1,m);</span>     </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,214" id="srcline214">214</a></span><span class="line"><span class="comment"><span class="mxinfo" id="T4:U37">%         Position_k_new = Cvr*(Position_k-position_offest) ;  % 从视觉世界坐标系 转到 北东地坐标系</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,215" id="srcline215">215</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,216" id="srcline216">216</a></span><span class="line"><span class="mxinfo" id="T4:U37">        <span class="mxinfo" id="T3:U48"><span class="var type1" id="S74T3U715">Position_k_new</span> = <span class="mxinfo" id="T3:U50"><span class="mxinfo" id="T28:U51"><span class="var type1" id="S69T28U717">Cvr</span></span>*<span class="var type1" id="S72T3U718">Position_k</span></span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,217" id="srcline217">217</a></span><span class="line"><span class="mxinfo" id="T4:U37">        <span class="mxinfo" id="T3:U54"><span class="mxinfo" id="T3:U55"><span class="mxinfo" id="T41:U56"><span class="var type1" id="S61T1U723">otherMakers</span>(<span class="var type1" id="S71T4U724">k</span>)</span>.Position</span> = <span class="var type1" id="S74T3U726">Position_k_new</span></span>;</span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,218" id="srcline218">218</a></span><span class="line"><span class="mxinfo" id="T4:U37">    <span class="keyword">else</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,219" id="srcline219">219</a></span><span class="line"><span class="mxinfo" id="T4:U37">        <span class="var type0" id="S61T0U732">otherMakers</span>(<span class="var type0" id="S71T0U733">k</span>).Position = NaN(3,1);</span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,220" id="srcline220">220</a></span><span class="line"><span class="mxinfo" id="T4:U37">    <span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,221" id="srcline221">221</a></span><span class="line"><span class="mxinfo" id="T4:U37">    <span class="mxinfo" id="T8:U60"><span class="mxinfo" id="T8:U61"><span class="mxinfo" id="T41:U62"><span class="var type1" id="S61T1U743">otherMakers</span>(<span class="var type1" id="S71T4U744">k</span>)</span>.CalculatedTime</span> = <span class="mxinfo" id="T8:U65"><span class="mxinfo" id="T8:U66"><span class="mxinfo" id="T41:U67"><span class="var type1" id="S61T1U749">otherMakers</span>(<span class="var type1" id="S71T4U750">k</span>)</span>.CalculatedTime</span>+<span class="mxinfo" id="T8:U70">1</span></span></span> ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,222" id="srcline222">222</a></span><span class="line"><span class="mxinfo" id="T4:U37">    <span class="keyword">if</span> coder.target(<span class="string">'MATLAB'</span>) &amp;&amp; <span class="var type0" id="S61T0U764">otherMakers</span>(<span class="var type0" id="S71T0U765">k</span>).CalculatedTime~=1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,223" id="srcline223">223</a></span><span class="line"><span class="mxinfo" id="T4:U37">       fpritnf( <span class="string">'otherMakers(%0.0f).CalculatedTime = %0.0f\n'</span>,<span class="var type0" id="S71T0U772">k</span>,<span class="var type0" id="S61T0U775">otherMakers</span>(<span class="var type0" id="S71T0U776">k</span>).CalculatedTime );</span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,224" id="srcline224">224</a></span><span class="line"><span class="mxinfo" id="T4:U37">    <span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,225" id="srcline225">225</a></span><span class="line"><span class="mxinfo" id="T4:U37"><span class="keyword"><span class="keyword">end</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,226" id="srcline226">226</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,227" id="srcline227">227</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,228" id="srcline228">228</a></span><span class="line"><span class="comment">%% 根据 BodyDirection 求姿态</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,229" id="srcline229">229</a></span><span class="line"><span class="comment">% 符号有待验证！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,230" id="srcline230">230</a></span><span class="line"><span class="comment">%   BodyDirection  人朝北为 [1 0 0]</span></span></span>
</pre>
