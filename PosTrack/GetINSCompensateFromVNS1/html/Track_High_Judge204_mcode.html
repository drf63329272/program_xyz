<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="49,447" id="srcline447">447</a></span><span class="line"><span class="comment">%% 高度判定</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,448" id="srcline448">448</a></span><span class="line"><span class="comment">% （1.1）惯性目标关节与视觉目标马克点高度差（INSVNSMarkHC） =  INSVNSMarkL *</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,449" id="srcline449">449</a></span><span class="line"><span class="comment">% cos(thita)。INSVNSMarkL 为常数，在初始时刻刻计算得到。</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,450" id="srcline450">450</a></span><span class="line"><span class="comment">%  INSVNSMarkHC 计算方法：当前高度-直立时的高度</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,451" id="srcline451">451</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S147T41U1842">otherMakers_k</span>,<span class="var type1" id="S148T2U1843">trackedMakerPosition_k_OK</span>,<span class="var type1" id="S149T2U1844">TrackFlag</span>,<span class="var type1" id="S150T2U1845">INSVNSMarkHC_Min</span> ] = Track_High_Judge<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,452" id="srcline452">452</a></span><span class="line">    ( <span class="mxinfo" id="T41:U5"><span class="mxinfo" id="T41:U6"><span class="var type1" id="S147T41U1848">otherMakers_k</span></span></span>,<span class="var type1" id="S151T4U1849">inertial_k</span>,<span class="var type1" id="S152T19U1850">InertialPosition</span>,<span class="var type1" id="S153T34U1851">makerTrackThreshold</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="49,453" id="srcline453">453</a></span><span class="line"> <span class="mxinfo" id="T2:U11"><span class="var type1" id="S154T2U1854">INSMarkH0</span>  = <span class="mxinfo" id="T2:U13"><span class="var type1" id="S153T34U1856">makerTrackThreshold</span>.INSMarkH0</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,454" id="srcline454">454</a></span><span class="line"> <span class="mxinfo" id="T2:U15"><span class="var type1" id="S155T2U1860">VNSMarkH0</span> = <span class="mxinfo" id="T2:U17"><span class="var type1" id="S153T34U1862">makerTrackThreshold</span>.VNSMarkH0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,455" id="srcline455">455</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,456" id="srcline456">456</a></span><span class="line"><span class="mxinfo" id="T2:U19"><span class="var type1" id="S148T2U1866">trackedMakerPosition_k_OK</span> = <span class="mxinfo" id="T2:U21">NaN</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,457" id="srcline457">457</a></span><span class="line"><span class="mxinfo" id="T2:U22"><span class="var type1" id="S150T2U1871">INSVNSMarkHC_Min</span> = <span class="mxinfo" id="T2:U24">NaN</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,458" id="srcline458">458</a></span><span class="line"><span class="mxinfo" id="T2:U25"><span class="var type1" id="S149T2U1876">TrackFlag</span> = <span class="mxinfo" id="T2:U27">0</span></span> ;    </span></span>
<span class="srcline"><span class="lineno"><a href="49,459" id="srcline459">459</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T14:U28">isnan(<span class="var type1" id="S154T2U1882">INSMarkH0</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,460" id="srcline460">460</a></span><span class="line">       </span></span>
<span class="srcline"><span class="lineno"><a href="49,461" id="srcline461">461</a></span><span class="line">    <span class="keyword">return</span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,462" id="srcline462">462</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,463" id="srcline463">463</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,464" id="srcline464">464</a></span><span class="line"><span class="mxinfo" id="T4:U30"><span class="var type1" id="S158T4U1886">M</span> = <span class="mxinfo" id="T4:U32"><span class="var type1" id="S147T41U1888">otherMakers_k</span>.otherMakersN</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,465" id="srcline465">465</a></span><span class="line"><span class="mxinfo" id="T3:U34"><span class="var type1" id="S159T3U1892">otherMakersPosition_k</span> = <span class="mxinfo" id="T3:U36"><span class="var type1" id="S147T41U1894">otherMakers_k</span>.Position</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,466" id="srcline466">466</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,467" id="srcline467">467</a></span><span class="line"><span class="mxinfo" id="T45:U38"><span class="var type1" id="S160T45U1898">INSVNSMarkHC</span> = <span class="mxinfo" id="T45:U40">zeros(<span class="mxinfo" id="T2:U41">1</span>,<span class="var type1" id="S158T4U1902">M</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,468" id="srcline468">468</a></span><span class="line"><span class="mxinfo" id="T4:U43"><span class="keyword">for</span> <span class="var type1" id="S162T4U1905">i</span>=<span class="mxinfo" id="T4:U45">1</span>:<span class="var type1" id="S158T4U1908">M</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,469" id="srcline469">469</a></span><span class="line"><span class="mxinfo" id="T4:U43">    <span class="mxinfo" id="T2:U47"><span class="mxinfo" id="T2:U48"><span class="var type1" id="S160T45U1912">INSVNSMarkHC</span>(<span class="var type1" id="S162T4U1913">i</span>)</span> = <span class="mxinfo" id="T2:U51">( <span class="mxinfo" id="T2:U52"><span class="mxinfo" id="T2:U53">-<span class="mxinfo" id="T2:U54"><span class="var type1" id="S152T19U1919">InertialPosition</span>(<span class="mxinfo" id="T2:U56">3</span>,<span class="var type1" id="S151T4U1921">inertial_k</span>)</span></span> + <span class="mxinfo" id="T2:U58"><span class="var type1" id="S159T3U1923">otherMakersPosition_k</span>(<span class="mxinfo" id="T2:U60">3</span>,<span class="var type1" id="S162T4U1925">i</span>)</span></span> )-( <span class="mxinfo" id="T2:U62"><span class="var type1" id="S154T2U1928">INSMarkH0</span>-<span class="var type1" id="S155T2U1929">VNSMarkH0</span></span> )</span></span> ;</span>   </span></span>
<span class="srcline"><span class="lineno"><a href="49,470" id="srcline470">470</a></span><span class="line"><span class="mxinfo" id="T4:U43"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,471" id="srcline471">471</a></span><span class="line"><span class="comment">% 高度差最小的点</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,472" id="srcline472">472</a></span><span class="line"><span class="mxinfo" id="T2:U65">[ <span class="var type1" id="S150T2U1933">INSVNSMarkHC_Min</span>,<span class="var type1" id="S163T2U1934">min_i</span> ] = min( <span class="mxinfo" id="T45:U68">abs(<span class="var type1" id="S160T45U1939">INSVNSMarkHC</span>)</span> )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,473" id="srcline473">473</a></span><span class="line"><span class="comment">% 将高度差误差大的点剔除</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,474" id="srcline474">474</a></span><span class="line"><span class="mxinfo" id="T2:U70"><span class="var type1" id="S166T2U1942">invalid_i</span> = <span class="mxinfo" id="T2:U72">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,475" id="srcline475">475</a></span><span class="line"><span class="mxinfo" id="T4:U73"><span class="keyword">for</span> <span class="var type1" id="S162T4U1946">i</span>=<span class="mxinfo" id="T4:U75">1</span>:<span class="var type1" id="S158T4U1949">M</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,476" id="srcline476">476</a></span><span class="line"><span class="mxinfo" id="T4:U73">    <span class="keyword">if</span> <span class="mxinfo" id="T14:U77"><span class="mxinfo" id="T2:U78">abs(<span class="mxinfo" id="T2:U79"><span class="var type1" id="S160T45U1956">INSVNSMarkHC</span>(<span class="var type1" id="S162T4U1957">i</span>)</span>)</span> &gt; <span class="mxinfo" id="T2:U82"><span class="var type1" id="S153T34U1959">makerTrackThreshold</span>.MaxMarkHighChange</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,477" id="srcline477">477</a></span><span class="line"><span class="mxinfo" id="T4:U73">        </span><span class="comment"><span class="mxinfo" id="T4:U73">% 将高度差误差大的点剔除</span>       </span></span></span>
<span class="srcline"><span class="lineno"><a href="49,478" id="srcline478">478</a></span><span class="line"><span class="mxinfo" id="T4:U73">        <span class="mxinfo" id="T3:U84"><span class="var type1" id="S167T3U1963">Position_Old</span> = <span class="mxinfo" id="T3:U86"><span class="var type1" id="S147T41U1965">otherMakers_k</span>.Position</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,479" id="srcline479">479</a></span><span class="line"><span class="mxinfo" id="T4:U73">        <span class="mxinfo" id="T3:U88"><span class="mxinfo" id="T3:U89"><span class="var type1" id="S147T41U1970">otherMakers_k</span>.Position</span> = <span class="mxinfo" id="T3:U91"><span class="fcn" id="F203N13:B1973">RemoveOtherMarkers_Position</span>( <span class="var type1" id="S167T3U1974">Position_Old</span>,<span class="mxinfo" id="T2:U93"><span class="var type1" id="S162T4U1976">i</span>-<span class="var type1" id="S166T2U1977">invalid_i</span></span>,<span class="mxinfo" id="T4:U96"><span class="var type1" id="S147T41U1979">otherMakers_k</span>.otherMakersN</span> )</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,480" id="srcline480">480</a></span><span class="line"><span class="mxinfo" id="T4:U73">        <span class="mxinfo" id="T4:U98"><span class="mxinfo" id="T4:U99"><span class="var type1" id="S147T41U1984">otherMakers_k</span>.otherMakersN</span> = <span class="mxinfo" id="T4:U101"><span class="mxinfo" id="T4:U102"><span class="var type1" id="S147T41U1988">otherMakers_k</span>.otherMakersN</span>-<span class="mxinfo" id="T4:U104">1</span></span></span> ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,481" id="srcline481">481</a></span><span class="line"><span class="mxinfo" id="T4:U73">        <span class="mxinfo" id="T2:U105"><span class="var type1" id="S166T2U1993">invalid_i</span> = <span class="mxinfo" id="T2:U107"><span class="var type1" id="S166T2U1995">invalid_i</span>+<span class="mxinfo" id="T2:U109">1</span></span></span> ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,482" id="srcline482">482</a></span><span class="line"><span class="mxinfo" id="T4:U73">    <span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,483" id="srcline483">483</a></span><span class="line"><span class="mxinfo" id="T4:U73"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,484" id="srcline484">484</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,485" id="srcline485">485</a></span><span class="line"><span class="comment">%% 通过高度剔除给踢完了</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,486" id="srcline486">486</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T14:U110"><span class="mxinfo" id="T4:U111"><span class="var type1" id="S147T41U2001">otherMakers_k</span>.otherMakersN</span> == <span class="mxinfo" id="T2:U113">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,487" id="srcline487">487</a></span><span class="line">   <span class="mxinfo" id="T2:U114"><span class="var type1" id="S149T2U2006">TrackFlag</span> = <span class="mxinfo" id="T2:U116">-<span class="mxinfo" id="T2:U117">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,488" id="srcline488">488</a></span><span class="line">   <span class="mxinfo" id="T2:U118"><span class="var type1" id="S148T2U2011">trackedMakerPosition_k_OK</span> = <span class="mxinfo" id="T2:U120">NaN</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,489" id="srcline489">489</a></span><span class="line">   <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,490" id="srcline490">490</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,491" id="srcline491">491</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,492" id="srcline492">492</a></span><span class="line"><span class="comment">%% 剔除 otherMakers_k.Position 中的第 i 个点</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,493" id="srcline493">493</a></span><span class="line"></span></span>
</pre>
