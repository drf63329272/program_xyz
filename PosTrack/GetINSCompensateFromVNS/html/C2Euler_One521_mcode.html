<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="131,39" id="srcline39"> 39</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="131,40" id="srcline40"> 40</a></span><span class="line"><span class="comment">% C:[3*3]</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,41" id="srcline41"> 41</a></span><span class="line"><span class="comment">% 第二个欧拉角定义范围 CosBeitaSign = 1： [ -pi/2,pi/2 ]</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">%                    CosBeitaSign = -1： [ -pi,-pi/2 ] [ pi/2,pi ]</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,43" id="srcline43"> 43</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S18T6U79">eulerOut</span> = C2Euler_One( <span class="var type1" id="S19T28U82">C</span>,<span class="mxinfo" id="T31:U3"><span class="var type2" id="S20T31V2U83">rotateOrder</span></span>,<span class="var type1" id="S21T20U84">rotateDirection</span>,<span class="var type1" id="S22T2U85">CosBeitaSign</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="131,44" id="srcline44"> 44</a></span><span class="line">coder.extrinsic(<span class="string">'format'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="131,45" id="srcline45"> 45</a></span><span class="line"><span class="mxinfo" id="T90:U7"><span class="extrinsicFcn" id="F585N41:B93">format</span> <span class="mxinfo" id="T88:U8"><span class="string">long</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="131,46" id="srcline46"> 46</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="131,47" id="srcline47"> 47</a></span><span class="line"><span class="keyword">if</span> isempty(<span class="var type1" id="S20T31U99">rotateOrder</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="131,48" id="srcline48"> 48</a></span><span class="line">    <span class="var type0" id="S20T0U102">rotateOrder</span> = <span class="string">'ZYX'</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="131,49" id="srcline49"> 49</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,50" id="srcline50"> 50</a></span><span class="line"><span class="keyword">if</span>  isempty(<span class="var type1" id="S21T20U108">rotateDirection</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="131,51" id="srcline51"> 51</a></span><span class="line">    <span class="var type0" id="S21T0U111">rotateDirection</span> = [1,1,1];</span></span>
<span class="srcline"><span class="lineno"><a href="131,52" id="srcline52"> 52</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,53" id="srcline53"> 53</a></span><span class="line"><span class="keyword">if</span> numel(<span class="var type1" id="S21T20U122">rotateDirection</span>)==1</span></span>
<span class="srcline"><span class="lineno"><a href="131,54" id="srcline54"> 54</a></span><span class="line">   <span class="var type0" id="S21T0U126">rotateDirection</span> = repmat(<span class="var type0" id="S21T0U129">rotateDirection</span>,1,3); </span></span>
<span class="srcline"><span class="lineno"><a href="131,55" id="srcline55"> 55</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,56" id="srcline56"> 56</a></span><span class="line"><span class="keyword">if</span>  isempty(<span class="var type1" id="S22T2U136">CosBeitaSign</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="131,57" id="srcline57"> 57</a></span><span class="line">    <span class="var type0" id="S22T0U139">CosBeitaSign</span> = 1 ;</span></span>
<span class="srcline"><span class="lineno"><a href="131,58" id="srcline58"> 58</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,59" id="srcline59"> 59</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="131,60" id="srcline60"> 60</a></span><span class="line"><span class="comment">%% calculate euler angles of " CosBeitaSign=1 "</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,61" id="srcline61"> 61</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="131,62" id="srcline62"> 62</a></span><span class="line"><span class="keyword">switch</span> <span class="var type1" id="S20T31U142">rotateOrder</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,63" id="srcline63"> 63</a></span><span class="line">    <span class="keyword">case</span> <span class="string">'ZYX'</span> </span></span>
<span class="srcline"><span class="lineno"><a href="131,64" id="srcline64"> 64</a></span><span class="line">        <span class="mxinfo" id="T2:U14"><span class="var type1" id="S28T2U147">euler1</span> = <span class="mxinfo" id="T2:U16">atan2( <span class="mxinfo" id="T2:U17"><span class="var type1" id="S19T28U151">C</span>(<span class="mxinfo" id="T2:U19">1</span>,<span class="mxinfo" id="T2:U20">2</span>)</span>,<span class="mxinfo" id="T2:U21"><span class="var type1" id="S19T28U155">C</span>(<span class="mxinfo" id="T2:U23">1</span>,<span class="mxinfo" id="T2:U24">1</span>)</span> )</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="131,65" id="srcline65"> 65</a></span><span class="line">        <span class="mxinfo" id="T2:U25"><span class="var type1" id="S30T2U160">euler2</span> = <span class="mxinfo" id="T2:U27">asin( <span class="mxinfo" id="T2:U28">-<span class="mxinfo" id="T2:U29"><span class="var type1" id="S19T28U165">C</span>(<span class="mxinfo" id="T2:U31">1</span>,<span class="mxinfo" id="T2:U32">3</span>)</span></span> )</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="131,66" id="srcline66"> 66</a></span><span class="line">        <span class="comment">% euler2 = atan2( -C(1,3),sqrt( C(3,2)^2+C(3,3)^2 ) ) ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,67" id="srcline67"> 67</a></span><span class="line">        <span class="mxinfo" id="T2:U33"><span class="var type1" id="S32T2U170">euler3</span> = <span class="mxinfo" id="T2:U35">atan2( <span class="mxinfo" id="T2:U36"><span class="var type1" id="S19T28U174">C</span>(<span class="mxinfo" id="T2:U38">2</span>,<span class="mxinfo" id="T2:U39">3</span>)</span>,<span class="mxinfo" id="T2:U40"><span class="var type1" id="S19T28U178">C</span>(<span class="mxinfo" id="T2:U42">3</span>,<span class="mxinfo" id="T2:U43">3</span>)</span> )</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="131,68" id="srcline68"> 68</a></span><span class="line">    <span class="keyword">case</span> <span class="string">'ZXY'</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,69" id="srcline69"> 69</a></span><span class="line">        <span class="var type0" id="S28T0U185">euler1</span> = atan2( -<span class="var type0" id="S19T0U190">C</span>(2,1),<span class="var type0" id="S19T0U194">C</span>(2,2) ) ;</span></span>
<span class="srcline"><span class="lineno"><a href="131,70" id="srcline70"> 70</a></span><span class="line">        <span class="var type0" id="S30T0U199">euler2</span> = asin( <span class="var type0" id="S19T0U203">C</span>(2,3) ) ;</span></span>
<span class="srcline"><span class="lineno"><a href="131,71" id="srcline71"> 71</a></span><span class="line">        <span class="comment">% euler2 = atan2( C(2,3),sqrt( C(2,1)^2+C(2,2)^2 ) ) ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,72" id="srcline72"> 72</a></span><span class="line">        <span class="var type0" id="S32T0U208">euler3</span> = atan2( -<span class="var type0" id="S19T0U213">C</span>(1,3),<span class="var type0" id="S19T0U217">C</span>(3,3) ) ;</span></span>
<span class="srcline"><span class="lineno"><a href="131,73" id="srcline73"> 73</a></span><span class="line">    <span class="keyword">case</span> <span class="string">'XYZ'</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,74" id="srcline74"> 74</a></span><span class="line">        <span class="var type0" id="S28T0U224">euler1</span> = atan2( -<span class="var type0" id="S19T0U229">C</span>(3,2),<span class="var type0" id="S19T0U233">C</span>(3,3) ) ;</span></span>
<span class="srcline"><span class="lineno"><a href="131,75" id="srcline75"> 75</a></span><span class="line">        <span class="var type0" id="S30T0U238">euler2</span> = asin(<span class="var type0" id="S19T0U242">C</span>(3,1)) ;</span></span>
<span class="srcline"><span class="lineno"><a href="131,76" id="srcline76"> 76</a></span><span class="line">        <span class="var type0" id="S32T0U247">euler3</span> = atan2( -<span class="var type0" id="S19T0U252">C</span>(2,1),<span class="var type0" id="S19T0U256">C</span>(1,1) ) ;</span></span>
<span class="srcline"><span class="lineno"><a href="131,77" id="srcline77"> 77</a></span><span class="line">    <span class="keyword">case</span> <span class="string">'XZY'</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,78" id="srcline78"> 78</a></span><span class="line">        <span class="var type0" id="S28T0U263">euler1</span> =  atan2(<span class="var type0" id="S19T0U267">C</span>(2,3),<span class="var type0" id="S19T0U271">C</span>(2,2)) ;</span></span>
<span class="srcline"><span class="lineno"><a href="131,79" id="srcline79"> 79</a></span><span class="line">        <span class="var type0" id="S30T0U276">euler2</span> =  asin(-<span class="var type0" id="S19T0U281">C</span>(2,1)) ;</span></span>
<span class="srcline"><span class="lineno"><a href="131,80" id="srcline80"> 80</a></span><span class="line">        <span class="var type0" id="S32T0U286">euler3</span> =  atan2(<span class="var type0" id="S19T0U290">C</span>(3,1),<span class="var type0" id="S19T0U294">C</span>(1,1)) ;</span></span>
<span class="srcline"><span class="lineno"><a href="131,81" id="srcline81"> 81</a></span><span class="line">    <span class="keyword">case</span> <span class="string">'YXZ'</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,82" id="srcline82"> 82</a></span><span class="line">        <span class="var type0" id="S28T0U301">euler1</span> = atan2( <span class="var type0" id="S19T0U305">C</span>(3,1),<span class="var type0" id="S19T0U309">C</span>(3,3) ) ;</span></span>
<span class="srcline"><span class="lineno"><a href="131,83" id="srcline83"> 83</a></span><span class="line">        <span class="var type0" id="S30T0U314">euler2</span> = asin( -<span class="var type0" id="S19T0U319">C</span>(3,2) ) ;</span></span>
<span class="srcline"><span class="lineno"><a href="131,84" id="srcline84"> 84</a></span><span class="line">        <span class="comment">% euler2 = atan2( -C(3,2),sqrt( C(1,2)^2+C(2,2)^2 ) ) ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,85" id="srcline85"> 85</a></span><span class="line">        <span class="var type0" id="S32T0U324">euler3</span> = atan2( <span class="var type0" id="S19T0U328">C</span>(1,2),<span class="var type0" id="S19T0U332">C</span>(2,2) ) ;        </span></span>
<span class="srcline"><span class="lineno"><a href="131,86" id="srcline86"> 86</a></span><span class="line">    <span class="keyword">case</span> <span class="string">'YZX'</span>  </span></span>
<span class="srcline"><span class="lineno"><a href="131,87" id="srcline87"> 87</a></span><span class="line">        <span class="var type0" id="S28T0U339">euler1</span> = atan2(-<span class="var type0" id="S19T0U344">C</span>(1,3),<span class="var type0" id="S19T0U348">C</span>(1,1))  ;</span></span>
<span class="srcline"><span class="lineno"><a href="131,88" id="srcline88"> 88</a></span><span class="line">        <span class="var type0" id="S30T0U353">euler2</span> = asin(<span class="var type0" id="S19T0U357">C</span>(1,2)) ;</span></span>
<span class="srcline"><span class="lineno"><a href="131,89" id="srcline89"> 89</a></span><span class="line">        <span class="var type0" id="S32T0U362">euler3</span> = atan2(-<span class="var type0" id="S19T0U367">C</span>(3,2),<span class="var type0" id="S19T0U371">C</span>(2,2)) ;</span></span>
<span class="srcline"><span class="lineno"><a href="131,90" id="srcline90"> 90</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,91" id="srcline91"> 91</a></span><span class="line"><span class="mxinfo" id="T6:U44"><span class="var type1" id="S33T6U376">euler</span> = <span class="mxinfo" id="T6:U46">[ <span class="var type1" id="S28T2U379">euler1</span>; <span class="var type1" id="S30T2U381">euler2</span>; <span class="var type1" id="S32T2U383">euler3</span> ]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="131,92" id="srcline92"> 92</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="131,93" id="srcline93"> 93</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S34T2U386">i</span>=<span class="mxinfo" id="T2:U51">1</span>:3</span></span>
<span class="srcline"><span class="lineno"><a href="131,94" id="srcline94"> 94</a></span><span class="line">    <span class="mxinfo" id="T2:U52"><span class="mxinfo" id="T2:U53"><span class="var type1" id="S33T6U393">euler</span>(<span class="var type1" id="S34T2U394">i</span>)</span> = <span class="mxinfo" id="T2:U56"><span class="mxinfo" id="T2:U57"><span class="var type1" id="S33T6U397">euler</span>(<span class="var type1" id="S34T2U398">i</span>)</span>*<span class="mxinfo" id="T2:U60"><span class="var type1" id="S21T20U400">rotateDirection</span>(<span class="var type1" id="S34T2U401">i</span>)</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="131,95" id="srcline95"> 95</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,96" id="srcline96"> 96</a></span><span class="line"><span class="mxinfo" id="T6:U63"><span class="var type1" id="S18T6U404">eulerOut</span> = <span class="var type1" id="S33T6U405">euler</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="131,97" id="srcline97"> 97</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="131,98" id="srcline98"> 98</a></span><span class="line"><span class="comment">% 第二个欧拉角定义范围 CosBeitaSign = 1： [ -pi/2,pi/2 ]</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,99" id="srcline99"> 99</a></span><span class="line"><span class="comment">%                    CosBeitaSign = -1： [ -pi,-pi/2 ] [ pi/2,pi ]</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,100" id="srcline100">100</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T19:U66"><span class="var type1" id="S22T2U409">CosBeitaSign</span> == <span class="mxinfo" id="T2:U68">-<span class="mxinfo" id="T2:U69">1</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="131,101" id="srcline101">101</a></span><span class="line">    <span class="var type1" id="S18T6U415">eulerOut</span>(1) = pi+<span class="var type1" id="S33T6U421">euler</span>(1) ;</span></span>
<span class="srcline"><span class="lineno"><a href="131,102" id="srcline102">102</a></span><span class="line">    <span class="var type1" id="S18T6U426">eulerOut</span>(2) = pi-<span class="var type1" id="S33T6U432">euler</span>(2) ;</span></span>
<span class="srcline"><span class="lineno"><a href="131,103" id="srcline103">103</a></span><span class="line">    <span class="var type1" id="S18T6U437">eulerOut</span>(3) = pi+<span class="var type1" id="S33T6U443">euler</span>(3) ;</span></span>
<span class="srcline"><span class="lineno"><a href="131,104" id="srcline104">104</a></span><span class="line">    <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="131,105" id="srcline105">105</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="131,106" id="srcline106">106</a></span><span class="line"></span></span>
</pre>
