<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,323" id="srcline323">323</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,324" id="srcline324">324</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,325" id="srcline325">325</a></span><span class="line"><span class="comment">%% REblow</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,326" id="srcline326">326</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S366T8U1775">RElbow_Nao</span>,<span class="var type1" id="S367T8U1776">RightForeArm_new</span> ] = TransformRElbow( <span class="var type1" id="S368T17U1779">C_Spine_RForeArm</span>,<span class="var type1" id="S369T17U1780">C_Spine_RArmNew</span>,<span class="mxinfo" id="T7:U5"><span class="var type2" id="S370T7V1U1781">rotateOrder_BVH</span></span> )</span></span>
<span class="srcline"><span class="lineno"><a href="1,327" id="srcline327">327</a></span><span class="line"><span class="mxinfo" id="T17:U7"><span class="var type1" id="S371T17U1784">C_RArmNew_Spine</span> = <span class="mxinfo" id="T17:U9"><span class="fcn" id="F76N9:B1786">InverseC_Multi</span>( <span class="var type1" id="S369T17U1787">C_Spine_RArmNew</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,328" id="srcline328">328</a></span><span class="line"><span class="mxinfo" id="T17:U11"><span class="var type1" id="S373T17U1790">C_RArmNew_RForeArm</span> = <span class="mxinfo" id="T17:U13"><span class="fcn" id="F73N4:B1792">CalculateC_Multi</span>( <span class="var type1" id="S371T17U1793">C_RArmNew_Spine</span>,<span class="var type1" id="S368T17U1794">C_Spine_RForeArm</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,329" id="srcline329">329</a></span><span class="line"><span class="mxinfo" id="T2:U16"><span class="var type1" id="S375T2U1797">Nframes</span> = <span class="mxinfo" id="T2:U18">size(<span class="var type1" id="S373T17U1800">C_RArmNew_RForeArm</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,330" id="srcline330">330</a></span><span class="line"><span class="mxinfo" id="T8:U20"><span class="var type1" id="S366T8U1804">RElbow_Nao</span> = <span class="mxinfo" id="T8:U22">zeros(<span class="mxinfo" id="T2:U23"><span class="var type1" id="S375T2U1807">Nframes</span></span>,<span class="mxinfo" id="T2:U25">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,331" id="srcline331">331</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S378T2U1811">k</span>=<span class="mxinfo" id="T2:U27">1:<span class="var type1" id="S375T2U1814">Nframes</span></span>         </span></span>
<span class="srcline"><span class="lineno"><a href="1,332" id="srcline332">332</a></span><span class="line">    <span class="mxinfo" id="T2:U29">[<span class="var type1" id="S379T2U1818">x</span>,<span class="var type1" id="S380T2U1819">y</span>,<span class="var type1" id="S381T2U1820">z</span>] = deal( <span class="mxinfo" id="T2:U33"><span class="var type1" id="S373T17U1824">C_RArmNew_RForeArm</span>(<span class="mxinfo" id="T2:U35"><span class="var type1" id="S378T2U1825">k</span></span>,<span class="mxinfo" id="T2:U37">1</span>,<span class="mxinfo" id="T2:U38">1</span>)</span>,<span class="mxinfo" id="T2:U39"><span class="var type1" id="S373T17U1829">C_RArmNew_RForeArm</span>(<span class="mxinfo" id="T2:U41"><span class="var type1" id="S378T2U1830">k</span></span>,<span class="mxinfo" id="T2:U43">1</span>,<span class="mxinfo" id="T2:U44">2</span>)</span>,<span class="mxinfo" id="T2:U45"><span class="var type1" id="S373T17U1834">C_RArmNew_RForeArm</span>(<span class="mxinfo" id="T2:U47"><span class="var type1" id="S378T2U1835">k</span></span>,<span class="mxinfo" id="T2:U49">1</span>,<span class="mxinfo" id="T2:U50">3</span>)</span> )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,333" id="srcline333">333</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,334" id="srcline334">334</a></span><span class="line">    <span class="comment">%%% RElbowRoll &gt; 0  % 人正常动作</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,335" id="srcline335">335</a></span><span class="line">    <span class="mxinfo" id="T2:U51"><span class="var type1" id="S383T2U1840">RElbowRoll1</span> = <span class="mxinfo" id="T2:U53">acos(<span class="var type1" id="S379T2U1843">x</span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,336" id="srcline336">336</a></span><span class="line">    <span class="mxinfo" id="T2:U55"><span class="var type1" id="S385T2U1846">RElbowYaw1</span> = <span class="mxinfo" id="T2:U57">atan2( <span class="mxinfo" id="T2:U58">-<span class="var type1" id="S380T2U1850">y</span></span>,<span class="mxinfo" id="T2:U60">-<span class="var type1" id="S381T2U1852">z</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,337" id="srcline337">337</a></span><span class="line">    <span class="mxinfo" id="T8:U62"><span class="var type1" id="S387T8U1855">RElbow_Nao1</span> = <span class="mxinfo" id="T8:U64">[ <span class="var type1" id="S385T2U1858">RElbowYaw1</span> <span class="var type1" id="S383T2U1859">RElbowRoll1</span> <span class="mxinfo" id="T2:U67">0</span> ]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,338" id="srcline338">338</a></span><span class="line"><span class="comment">%     %%% RElbowRoll &lt; 0  % 人很少做的动作：人右手不会这么转</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,339" id="srcline339">339</a></span><span class="line"><span class="comment">%     RElbowRoll2 = -acos(x) ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,340" id="srcline340">340</a></span><span class="line"><span class="comment">%     RElbowYaw2 = atan2( y,z );</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,341" id="srcline341">341</a></span><span class="line"><span class="comment">%     RElbow_Nao2 = [ RElbowYaw2 RElbowRoll2 0 ];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,342" id="srcline342">342</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,343" id="srcline343">343</a></span><span class="line">    <span class="mxinfo" id="T8:U68"><span class="mxinfo" id="T8:U69"><span class="var type1" id="S366T8U1864">RElbow_Nao</span>(<span class="mxinfo" id="T2:U71"><span class="var type1" id="S378T2U1865">k</span></span>,:)</span> = <span class="var type1" id="S387T8U1867">RElbow_Nao1</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,344" id="srcline344">344</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,345" id="srcline345">345</a></span><span class="line"><span class="mxinfo" id="T8:U74"><span class="var type1" id="S388T8U1870">RElbow_Nao_degree</span> = <span class="mxinfo" id="T8:U76"><span class="mxinfo" id="T8:U77"><span class="var type1" id="S366T8U1873">RElbow_Nao</span>*<span class="mxinfo" id="T2:U79">180</span></span>/<span class="mxinfo" id="T2:U80">pi</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,346" id="srcline346">346</a></span><span class="line"><span class="comment">%%% get new BVH</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,347" id="srcline347">347</a></span><span class="line"><span class="mxinfo" id="T7:U81"><span class="var type1" id="S390T7U1879">RElbow_rotateOrder</span> = <span class="mxinfo" id="T7:U83"><span class="string">'XYZ'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,348" id="srcline348">348</a></span><span class="line"><span class="mxinfo" id="T8:U84"><span class="var type1" id="S391T8U1883">RElbow_rotateDirection</span> = <span class="mxinfo" id="T8:U86">[-1,1,1]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,349" id="srcline349">349</a></span><span class="line"><span class="mxinfo" id="T8:U87"><span class="var type1" id="S392T8U1892">BVH_rotateDirection</span> = <span class="mxinfo" id="T8:U89">[1,1,1]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,350" id="srcline350">350</a></span><span class="line"><span class="mxinfo" id="T8:U90"><span class="var type1" id="S367T8U1900">RightForeArm_new</span> = <span class="mxinfo" id="T8:U92">zeros(<span class="mxinfo" id="T2:U93"><span class="var type1" id="S375T2U1903">Nframes</span></span>,<span class="mxinfo" id="T2:U95">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,351" id="srcline351">351</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S378T2U1907">k</span>=<span class="mxinfo" id="T2:U97">1:<span class="var type1" id="S375T2U1910">Nframes</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,352" id="srcline352">352</a></span><span class="line">    <span class="mxinfo" id="T8:U99"><span class="mxinfo" id="T8:U100"><span class="var type1" id="S367T8U1914">RightForeArm_new</span>(<span class="mxinfo" id="T2:U102"><span class="var type1" id="S378T2U1915">k</span></span>,:)</span> = <span class="mxinfo" id="T8:U104"><span class="fcn" id="F174N25:B1918">ChangeEulerRotate_c</span>(  <span class="mxinfo" id="T8:U105"><span class="var type1" id="S366T8U1920">RElbow_Nao</span>( <span class="mxinfo" id="T2:U107"><span class="var type1" id="S378T2U1921">k</span></span>,: )</span>,<span class="var type1" id="S390T7U1923">RElbow_rotateOrder</span>,<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,353" id="srcline353">353</a></span><span class="line"><span class="mxinfo" id="T8:U99"><span class="mxinfo" id="T8:U104">        <span class="var type1" id="S370T7U1924">rotateOrder_BVH</span>,<span class="mxinfo" id="T8:U111"><span class="var type1" id="S391T8U1925">RElbow_rotateDirection</span></span>,<span class="mxinfo" id="T8:U113"><span class="var type1" id="S392T8U1926">BVH_rotateDirection</span></span> )</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,354" id="srcline354">354</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,355" id="srcline355">355</a></span><span class="line"></span></span>
</pre>
