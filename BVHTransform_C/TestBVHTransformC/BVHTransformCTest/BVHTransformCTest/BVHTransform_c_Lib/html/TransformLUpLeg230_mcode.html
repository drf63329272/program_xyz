<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,450" id="srcline450">450</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,451" id="srcline451">451</a></span><span class="line"><span class="comment">%% LUpLeg</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,452" id="srcline452">452</a></span><span class="line"><span class="comment">% HipYawPitch：左右大腿的 HipYawPitch Angle  [ Nframes*1 ]</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,453" id="srcline453">453</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S496T2U2488">LHipRoll</span>,<span class="var type1" id="S497T2U2489">LHipPitch</span>,<span class="var type1" id="S498T8U2490">LeftUpLeg_new</span> ] = TransformLUpLeg( <span class="var type1" id="S499T17U2493">C_Hip_LUpLeg</span>,<span class="var type1" id="S500T2U2494">HipYawPitch</span>,<span class="mxinfo" id="T7:U6"><span class="var type2" id="S501T7V1U2495">rotateOrder_BVH</span></span> )</span></span>
<span class="srcline"><span class="lineno"><a href="1,454" id="srcline454">454</a></span><span class="line"><span class="mxinfo" id="T17:U8"><span class="var type1" id="S502T17U2498">C_LUpLeg_Hip</span> = <span class="mxinfo" id="T17:U10"><span class="fcn" id="F76N9:B2500">InverseC_Multi</span>( <span class="var type1" id="S499T17U2501">C_Hip_LUpLeg</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,455" id="srcline455">455</a></span><span class="line"><span class="mxinfo" id="T8:U12"><span class="var type1" id="S504T8U2504">AxisL</span> = <span class="mxinfo" id="T8:U14">[1,-1,0]</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,456" id="srcline456">456</a></span><span class="line"><span class="mxinfo" id="T8:U15"><span class="var type1" id="S504T8U2513">AxisL</span> = <span class="mxinfo" id="T8:U17"><span class="var type1" id="S504T8U2515">AxisL</span>/normest(<span class="var type1" id="S504T8U2518">AxisL</span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,457" id="srcline457">457</a></span><span class="line"><span class="mxinfo" id="T2:U20"><span class="var type1" id="S506T2U2521">Nframes</span> = <span class="mxinfo" id="T2:U22">size(<span class="var type1" id="S499T17U2524">C_Hip_LUpLeg</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,458" id="srcline458">458</a></span><span class="line"><span class="mxinfo" id="T17:U24"><span class="var type1" id="S508T17U2528">C_HipYawPitch</span> = <span class="mxinfo" id="T17:U26">zeros(<span class="mxinfo" id="T2:U27"><span class="var type1" id="S506T2U2531">Nframes</span></span>,<span class="mxinfo" id="T2:U29">3</span>,<span class="mxinfo" id="T2:U30">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,459" id="srcline459">459</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S510T2U2536">k</span>=<span class="mxinfo" id="T2:U32">1:<span class="var type1" id="S506T2U2539">Nframes</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,460" id="srcline460">460</a></span><span class="line">    <span class="mxinfo" id="T2:U34"><span class="var type1" id="S511T2U2542">HipYawPitch_k</span> = <span class="var type1" id="S500T2U2544">HipYawPitch</span>(<span class="var type1" id="S510T2U2545">k</span>)</span>;   </span></span>
<span class="srcline"><span class="lineno"><a href="1,461" id="srcline461">461</a></span><span class="line">    <span class="mxinfo" id="T8:U38"><span class="var type1" id="S512T8U2548">Q_AxisL</span> = <span class="mxinfo" id="T8:U40"><span class="mxinfo" id="T8:U41"><span class="var type1" id="S504T8U2550">AxisL</span></span>*<span class="mxinfo" id="T2:U43">sin( <span class="mxinfo" id="T2:U44"><span class="var type1" id="S511T2U2554">HipYawPitch_k</span>/<span class="mxinfo" id="T2:U46">2</span></span> )</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,462" id="srcline462">462</a></span><span class="line">    <span class="mxinfo" id="T36:U47"><span class="var type1" id="S514T36U2558">Q_HipYawPitch_k</span> = <span class="mxinfo" id="T36:U49">[ <span class="mxinfo" id="T2:U50">cos( <span class="mxinfo" id="T2:U51"><span class="var type1" id="S511T2U2564">HipYawPitch_k</span>/<span class="mxinfo" id="T2:U53">2</span></span> )</span> <span class="var type1" id="S512T8U2566">Q_AxisL</span> ]</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,463" id="srcline463">463</a></span><span class="line">    <span class="mxinfo" id="T17:U55"><span class="mxinfo" id="T17:U56"><span class="var type1" id="S508T17U2570">C_HipYawPitch</span>(<span class="mxinfo" id="T2:U58"><span class="var type1" id="S510T2U2571">k</span></span>,:,:)</span> = <span class="mxinfo" id="T11:U60"><span class="fcn" id="F219N28:B2575">FQtoCnb</span>( <span class="var type1" id="S514T36U2576">Q_HipYawPitch_k</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,464" id="srcline464">464</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,465" id="srcline465">465</a></span><span class="line"><span class="mxinfo" id="T17:U62"><span class="var type1" id="S517T17U2579">C_LUpLeg_Hip_New</span> = <span class="mxinfo" id="T17:U64"><span class="fcn" id="F73N4:B2581">CalculateC_Multi</span>( <span class="var type1" id="S502T17U2582">C_LUpLeg_Hip</span>,<span class="var type1" id="S508T17U2583">C_HipYawPitch</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,466" id="srcline466">466</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,467" id="srcline467">467</a></span><span class="line"><span class="mxinfo" id="T2:U67"><span class="var type1" id="S497T2U2586">LHipPitch</span> = <span class="mxinfo" id="T2:U69">zeros(1,<span class="var type1" id="S506T2U2590">Nframes</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,468" id="srcline468">468</a></span><span class="line"><span class="mxinfo" id="T2:U71"><span class="var type1" id="S496T2U2593">LHipRoll</span> = <span class="mxinfo" id="T2:U73">zeros(1,<span class="var type1" id="S506T2U2597">Nframes</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,469" id="srcline469">469</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S510T2U2600">k</span>=<span class="mxinfo" id="T2:U76">1:<span class="var type1" id="S506T2U2603">Nframes</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,470" id="srcline470">470</a></span><span class="line">    <span class="mxinfo" id="T11:U78"><span class="var type1" id="S519T11U2606">C_LUpLeg_Hip_New_k</span> = <span class="mxinfo" id="T11:U80">permute( <span class="mxinfo" id="T17:U81"><span class="var type1" id="S517T17U2610">C_LUpLeg_Hip_New</span>(<span class="mxinfo" id="T2:U83"><span class="var type1" id="S510T2U2611">k</span></span>,:,:)</span>,[2,3,1] )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,471" id="srcline471">471</a></span><span class="line">    <span class="mxinfo" id="T2:U85">[<span class="var type1" id="S521T2U2622">x</span>,<span class="var type1" id="S522T2U2623">y</span>,<span class="var type1" id="S523T2U2624">z</span>] = deal( <span class="mxinfo" id="T2:U89"><span class="var type1" id="S519T11U2628">C_LUpLeg_Hip_New_k</span>(<span class="mxinfo" id="T2:U91">1</span>,<span class="mxinfo" id="T2:U92">2</span>)</span>,<span class="mxinfo" id="T2:U93"><span class="var type1" id="S519T11U2632">C_LUpLeg_Hip_New_k</span>(<span class="mxinfo" id="T2:U95">2</span>,<span class="mxinfo" id="T2:U96">2</span>)</span>,<span class="mxinfo" id="T2:U97"><span class="var type1" id="S519T11U2636">C_LUpLeg_Hip_New_k</span>(<span class="mxinfo" id="T2:U99">3</span>,<span class="mxinfo" id="T2:U100">2</span>)</span> )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,472" id="srcline472">472</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,473" id="srcline473">473</a></span><span class="line">    <span class="mxinfo" id="T2:U101"><span class="var type1" id="S497T2U2642">LHipPitch</span>(<span class="var type1" id="S510T2U2643">k</span>) = <span class="mxinfo" id="T2:U104">asin( <span class="var type1" id="S523T2U2646">z</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,474" id="srcline474">474</a></span><span class="line">    <span class="mxinfo" id="T2:U106"><span class="var type1" id="S496T2U2650">LHipRoll</span>(<span class="var type1" id="S510T2U2651">k</span>) = <span class="mxinfo" id="T2:U109">atan( <span class="mxinfo" id="T2:U110"><span class="mxinfo" id="T2:U111">-<span class="var type1" id="S521T2U2656">x</span></span>/<span class="var type1" id="S522T2U2657">y</span></span> )</span></span>;    </span></span>
<span class="srcline"><span class="lineno"><a href="1,475" id="srcline475">475</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,476" id="srcline476">476</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,477" id="srcline477">477</a></span><span class="line"><span class="comment">%%% get new BVH</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,478" id="srcline478">478</a></span><span class="line"><span class="mxinfo" id="T8:U114"><span class="var type1" id="S527T8U2660">rotateDirection_BVH</span> = <span class="mxinfo" id="T8:U116">[1,1,1]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,479" id="srcline479">479</a></span><span class="line"><span class="mxinfo" id="T17:U117"><span class="var type1" id="S528T17U2668">C_Hip_LUpLeg_New</span> = <span class="mxinfo" id="T17:U119"><span class="fcn" id="F76N9:B2670">InverseC_Multi</span>( <span class="var type1" id="S517T17U2671">C_LUpLeg_Hip_New</span> )</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,480" id="srcline480">480</a></span><span class="line"><span class="mxinfo" id="T8:U121"><span class="var type1" id="S498T8U2674">LeftUpLeg_new</span> = <span class="mxinfo" id="T8:U123"><span class="fcn" id="F118N23:B2676">CToEuler_c</span>( <span class="var type1" id="S528T17U2677">C_Hip_LUpLeg_New</span>,<span class="var type1" id="S501T7U2678">rotateOrder_BVH</span>,<span class="mxinfo" id="T8:U126"><span class="var type1" id="S527T8U2679">rotateDirection_BVH</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,481" id="srcline481">481</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,482" id="srcline482">482</a></span><span class="line"><span class="comment">%% RLeg</span></span></span>
</pre>
