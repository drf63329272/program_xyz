<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,419" id="srcline419">419</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,420" id="srcline420">420</a></span><span class="line"><span class="comment">%% RUpLeg</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,421" id="srcline421">421</a></span><span class="line"><span class="comment">% HipYawPitch：左右大腿的 HipYawPitch Angle  [ 1*Nframes ]</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,422" id="srcline422">422</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S461T2U2295">RHipRoll</span>,<span class="var type1" id="S462T2U2296">RHipPitch</span>,<span class="var type1" id="S463T8U2297">RightUpLeg_new</span> ] = TransformRUpLeg( <span class="var type1" id="S464T17U2300">C_Hip_RUpLeg</span>,<span class="var type1" id="S465T2U2301">HipYawPitch</span>,<span class="mxinfo" id="T7:U6"><span class="var type2" id="S466T7V1U2302">rotateOrder_BVH</span></span> )</span></span>
<span class="srcline"><span class="lineno"><a href="1,423" id="srcline423">423</a></span><span class="line"><span class="mxinfo" id="T17:U8"><span class="var type1" id="S467T17U2305">C_RUpLeg_Hip</span> = <span class="mxinfo" id="T17:U10"><span class="fcn" id="F76N9:B2307">InverseC_Multi</span>( <span class="var type1" id="S464T17U2308">C_Hip_RUpLeg</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,424" id="srcline424">424</a></span><span class="line"><span class="mxinfo" id="T8:U12"><span class="var type1" id="S469T8U2311">AxisR</span> = <span class="mxinfo" id="T8:U14">[1,1,0]</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,425" id="srcline425">425</a></span><span class="line"><span class="mxinfo" id="T8:U15"><span class="var type1" id="S469T8U2319">AxisR</span> = <span class="mxinfo" id="T8:U17"><span class="var type1" id="S469T8U2321">AxisR</span>/normest(<span class="var type1" id="S469T8U2324">AxisR</span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,426" id="srcline426">426</a></span><span class="line"><span class="mxinfo" id="T2:U20"><span class="var type1" id="S471T2U2327">Nframes</span> = <span class="mxinfo" id="T2:U22">size(<span class="var type1" id="S464T17U2330">C_Hip_RUpLeg</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,427" id="srcline427">427</a></span><span class="line"><span class="mxinfo" id="T17:U24"><span class="var type1" id="S473T17U2334">C_HipYawPitch</span> = <span class="mxinfo" id="T17:U26">zeros(<span class="mxinfo" id="T2:U27"><span class="var type1" id="S471T2U2337">Nframes</span></span>,<span class="mxinfo" id="T2:U29">3</span>,<span class="mxinfo" id="T2:U30">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,428" id="srcline428">428</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S475T2U2342">k</span>=<span class="mxinfo" id="T2:U32">1:<span class="var type1" id="S471T2U2345">Nframes</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,429" id="srcline429">429</a></span><span class="line">    <span class="mxinfo" id="T2:U34"><span class="var type1" id="S476T2U2348">HipYawPitch_k</span> = <span class="var type1" id="S465T2U2350">HipYawPitch</span>(<span class="var type1" id="S475T2U2351">k</span>)</span>;   </span></span>
<span class="srcline"><span class="lineno"><a href="1,430" id="srcline430">430</a></span><span class="line">    <span class="mxinfo" id="T8:U38"><span class="var type1" id="S477T8U2354">Q_AxisR</span> = <span class="mxinfo" id="T8:U40"><span class="mxinfo" id="T8:U41"><span class="var type1" id="S469T8U2356">AxisR</span></span>*<span class="mxinfo" id="T2:U43">sin( <span class="mxinfo" id="T2:U44"><span class="var type1" id="S476T2U2360">HipYawPitch_k</span>/<span class="mxinfo" id="T2:U46">2</span></span> )</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,431" id="srcline431">431</a></span><span class="line">    <span class="mxinfo" id="T36:U47"><span class="var type1" id="S479T36U2364">Q_HipYawPitch_k</span> = <span class="mxinfo" id="T36:U49">[ <span class="mxinfo" id="T2:U50">cos( <span class="mxinfo" id="T2:U51"><span class="var type1" id="S476T2U2370">HipYawPitch_k</span>/<span class="mxinfo" id="T2:U53">2</span></span> )</span> <span class="var type1" id="S477T8U2372">Q_AxisR</span> ]</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,432" id="srcline432">432</a></span><span class="line">    <span class="mxinfo" id="T17:U55"><span class="mxinfo" id="T17:U56"><span class="var type1" id="S473T17U2376">C_HipYawPitch</span>(<span class="mxinfo" id="T2:U58"><span class="var type1" id="S475T2U2377">k</span></span>,:,:)</span> = <span class="mxinfo" id="T11:U60"><span class="fcn" id="F219N28:B2381">FQtoCnb</span>( <span class="var type1" id="S479T36U2382">Q_HipYawPitch_k</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,433" id="srcline433">433</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,434" id="srcline434">434</a></span><span class="line"><span class="mxinfo" id="T17:U62"><span class="var type1" id="S482T17U2385">C_RUpLeg_Hip_New</span> = <span class="mxinfo" id="T17:U64"><span class="fcn" id="F73N4:B2387">CalculateC_Multi</span>( <span class="var type1" id="S467T17U2388">C_RUpLeg_Hip</span>,<span class="var type1" id="S473T17U2389">C_HipYawPitch</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,435" id="srcline435">435</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,436" id="srcline436">436</a></span><span class="line"><span class="mxinfo" id="T2:U67"><span class="var type1" id="S462T2U2392">RHipPitch</span> = <span class="mxinfo" id="T2:U69">zeros(1,<span class="var type1" id="S471T2U2396">Nframes</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,437" id="srcline437">437</a></span><span class="line"><span class="mxinfo" id="T2:U71"><span class="var type1" id="S461T2U2399">RHipRoll</span> = <span class="mxinfo" id="T2:U73">zeros(1,<span class="var type1" id="S471T2U2403">Nframes</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,438" id="srcline438">438</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S475T2U2406">k</span>=<span class="mxinfo" id="T2:U76">1:<span class="var type1" id="S471T2U2409">Nframes</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,439" id="srcline439">439</a></span><span class="line">    <span class="mxinfo" id="T11:U78"><span class="var type1" id="S484T11U2412">C_RUpLeg_Hip_New_k</span> = <span class="mxinfo" id="T11:U80">permute( <span class="mxinfo" id="T17:U81"><span class="var type1" id="S482T17U2416">C_RUpLeg_Hip_New</span>(<span class="mxinfo" id="T2:U83"><span class="var type1" id="S475T2U2417">k</span></span>,:,:)</span>,[2,3,1] )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,440" id="srcline440">440</a></span><span class="line">    <span class="mxinfo" id="T2:U85">[<span class="var type1" id="S486T2U2428">x</span>,<span class="var type1" id="S487T2U2429">y</span>,<span class="var type1" id="S488T2U2430">z</span>] = deal( <span class="mxinfo" id="T2:U89"><span class="var type1" id="S484T11U2434">C_RUpLeg_Hip_New_k</span>(<span class="mxinfo" id="T2:U91">1</span>,<span class="mxinfo" id="T2:U92">2</span>)</span>,<span class="mxinfo" id="T2:U93"><span class="var type1" id="S484T11U2438">C_RUpLeg_Hip_New_k</span>(<span class="mxinfo" id="T2:U95">2</span>,<span class="mxinfo" id="T2:U96">2</span>)</span>,<span class="mxinfo" id="T2:U97"><span class="var type1" id="S484T11U2442">C_RUpLeg_Hip_New_k</span>(<span class="mxinfo" id="T2:U99">3</span>,<span class="mxinfo" id="T2:U100">2</span>)</span> )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,441" id="srcline441">441</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,442" id="srcline442">442</a></span><span class="line">    <span class="mxinfo" id="T2:U101"><span class="var type1" id="S462T2U2448">RHipPitch</span>(<span class="var type1" id="S475T2U2449">k</span>) = <span class="mxinfo" id="T2:U104">asin( <span class="var type1" id="S488T2U2452">z</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,443" id="srcline443">443</a></span><span class="line">    <span class="mxinfo" id="T2:U106"><span class="var type1" id="S461T2U2456">RHipRoll</span>(<span class="var type1" id="S475T2U2457">k</span>) = <span class="mxinfo" id="T2:U109">atan( <span class="mxinfo" id="T2:U110"><span class="mxinfo" id="T2:U111">-<span class="var type1" id="S486T2U2462">x</span></span>/<span class="var type1" id="S487T2U2463">y</span></span> )</span></span>;    </span></span>
<span class="srcline"><span class="lineno"><a href="1,444" id="srcline444">444</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,445" id="srcline445">445</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,446" id="srcline446">446</a></span><span class="line"><span class="comment">%%% get new BVH</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,447" id="srcline447">447</a></span><span class="line"><span class="mxinfo" id="T8:U114"><span class="var type1" id="S492T8U2466">rotateDirection_BVH</span> = <span class="mxinfo" id="T8:U116">[1,1,1]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,448" id="srcline448">448</a></span><span class="line"><span class="mxinfo" id="T17:U117"><span class="var type1" id="S493T17U2474">C_Hip_RUpLeg_New</span> = <span class="mxinfo" id="T17:U119"><span class="fcn" id="F76N9:B2476">InverseC_Multi</span>( <span class="var type1" id="S482T17U2477">C_RUpLeg_Hip_New</span> )</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,449" id="srcline449">449</a></span><span class="line"><span class="mxinfo" id="T8:U121"><span class="var type1" id="S463T8U2480">RightUpLeg_new</span> = <span class="mxinfo" id="T8:U123"><span class="fcn" id="F118N23:B2482">CToEuler_c</span>( <span class="var type1" id="S493T17U2483">C_Hip_RUpLeg_New</span>,<span class="var type1" id="S466T7U2484">rotateOrder_BVH</span>,<span class="mxinfo" id="T8:U126"><span class="var type1" id="S492T8U2485">rotateDirection_BVH</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,450" id="srcline450">450</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,451" id="srcline451">451</a></span><span class="line"><span class="comment">%% LUpLeg</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,452" id="srcline452">452</a></span><span class="line"><span class="comment">% HipYawPitch：左右大腿的 HipYawPitch Angle  [ Nframes*1 ]</span></span></span>
</pre>
