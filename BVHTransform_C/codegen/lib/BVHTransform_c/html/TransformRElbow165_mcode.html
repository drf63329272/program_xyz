<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,381" id="srcline381">381</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,382" id="srcline382">382</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,383" id="srcline383">383</a></span><span class="line"><span class="comment">%% REblow</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,384" id="srcline384">384</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S383T7U1930">RElbow_Nao</span>,<span class="var type1" id="S384T7U1931">RightForeArm_new</span> ] = TransformRElbow( <span class="var type1" id="S385T18U1934">C_Spine_RForeArm</span>,<span class="var type1" id="S386T18U1935">C_Spine_RArmNew</span>,<span class="var type1" id="S387T3U1936">rotateOrder_BVH</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="1,385" id="srcline385">385</a></span><span class="line">coder.inline(<span class="string">'never'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,386" id="srcline386">386</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,387" id="srcline387">387</a></span><span class="line"><span class="mxinfo" id="T18:U6"><span class="var type1" id="S389T18U1945">C_RArmNew_Spine</span> = <span class="mxinfo" id="T18:U8"><span class="fcn" id="F78N13:B1947">InverseC_Multi</span>( <span class="var type1" id="S386T18U1948">C_Spine_RArmNew</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,388" id="srcline388">388</a></span><span class="line"><span class="mxinfo" id="T18:U10"><span class="var type1" id="S391T18U1951">C_RArmNew_RForeArm</span> = <span class="mxinfo" id="T18:U12"><span class="fcn" id="F75N5:B1953">CalculateC_Multi</span>( <span class="var type1" id="S389T18U1954">C_RArmNew_Spine</span>,<span class="var type1" id="S385T18U1955">C_Spine_RForeArm</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,389" id="srcline389">389</a></span><span class="line"><span class="mxinfo" id="T3:U15"><span class="var type1" id="S393T3U1958">Nframes</span> = <span class="mxinfo" id="T3:U17">size(<span class="var type1" id="S391T18U1961">C_RArmNew_RForeArm</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,390" id="srcline390">390</a></span><span class="line"><span class="mxinfo" id="T7:U19"><span class="var type1" id="S383T7U1965">RElbow_Nao</span> = <span class="mxinfo" id="T7:U21">zeros(<span class="mxinfo" id="T3:U22"><span class="var type1" id="S393T3U1968">Nframes</span></span>,<span class="mxinfo" id="T3:U24">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,391" id="srcline391">391</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S396T3U1972">k</span>=<span class="mxinfo" id="T3:U26">1:<span class="var type1" id="S393T3U1975">Nframes</span></span>         </span></span>
<span class="srcline"><span class="lineno"><a href="1,392" id="srcline392">392</a></span><span class="line">    <span class="mxinfo" id="T3:U28">[<span class="var type1" id="S397T3U1979">x</span>,<span class="var type1" id="S398T3U1980">y</span>,<span class="var type1" id="S399T3U1981">z</span>] = deal( <span class="mxinfo" id="T3:U32"><span class="var type1" id="S391T18U1985">C_RArmNew_RForeArm</span>(<span class="mxinfo" id="T3:U34"><span class="var type1" id="S396T3U1986">k</span></span>,<span class="mxinfo" id="T3:U36">1</span>,<span class="mxinfo" id="T3:U37">1</span>)</span>,<span class="mxinfo" id="T3:U38"><span class="var type1" id="S391T18U1990">C_RArmNew_RForeArm</span>(<span class="mxinfo" id="T3:U40"><span class="var type1" id="S396T3U1991">k</span></span>,<span class="mxinfo" id="T3:U42">1</span>,<span class="mxinfo" id="T3:U43">2</span>)</span>,<span class="mxinfo" id="T3:U44"><span class="var type1" id="S391T18U1995">C_RArmNew_RForeArm</span>(<span class="mxinfo" id="T3:U46"><span class="var type1" id="S396T3U1996">k</span></span>,<span class="mxinfo" id="T3:U48">1</span>,<span class="mxinfo" id="T3:U49">3</span>)</span> )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,393" id="srcline393">393</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,394" id="srcline394">394</a></span><span class="line">    <span class="comment">%%% RElbowRoll &gt; 0  % 人正常动作</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,395" id="srcline395">395</a></span><span class="line">    <span class="mxinfo" id="T3:U50"><span class="var type1" id="S401T3U2001">RElbowRoll1</span> = <span class="mxinfo" id="T3:U52">acos(<span class="var type1" id="S397T3U2004">x</span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,396" id="srcline396">396</a></span><span class="line">    <span class="mxinfo" id="T3:U54"><span class="var type1" id="S403T3U2007">RElbowYaw1</span> = <span class="mxinfo" id="T3:U56">atan2( <span class="mxinfo" id="T3:U57">-<span class="var type1" id="S398T3U2011">y</span></span>,<span class="mxinfo" id="T3:U59">-<span class="var type1" id="S399T3U2013">z</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,397" id="srcline397">397</a></span><span class="line">    <span class="mxinfo" id="T7:U61"><span class="var type1" id="S405T7U2016">RElbow_Nao1</span> = <span class="mxinfo" id="T7:U63">[ <span class="var type1" id="S403T3U2019">RElbowYaw1</span> <span class="var type1" id="S401T3U2020">RElbowRoll1</span> <span class="mxinfo" id="T3:U66">0</span> ]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,398" id="srcline398">398</a></span><span class="line"><span class="comment">%     %%% RElbowRoll &lt; 0  % 人很少做的动作：人右手不会这么转</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,399" id="srcline399">399</a></span><span class="line"><span class="comment">%     RElbowRoll2 = -acos(x) ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,400" id="srcline400">400</a></span><span class="line"><span class="comment">%     RElbowYaw2 = atan2( y,z );</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,401" id="srcline401">401</a></span><span class="line"><span class="comment">%     RElbow_Nao2 = [ RElbowYaw2 RElbowRoll2 0 ];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,402" id="srcline402">402</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,403" id="srcline403">403</a></span><span class="line">    <span class="mxinfo" id="T7:U67"><span class="mxinfo" id="T7:U68"><span class="var type1" id="S383T7U2025">RElbow_Nao</span>(<span class="mxinfo" id="T3:U70"><span class="var type1" id="S396T3U2026">k</span></span>,:)</span> = <span class="var type1" id="S405T7U2028">RElbow_Nao1</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,404" id="srcline404">404</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,405" id="srcline405">405</a></span><span class="line"><span class="mxinfo" id="T7:U73"><span class="var type1" id="S406T7U2031">RElbow_Nao_degree</span> = <span class="mxinfo" id="T7:U75"><span class="mxinfo" id="T7:U76"><span class="var type1" id="S383T7U2034">RElbow_Nao</span>*<span class="mxinfo" id="T3:U78">180</span></span>/<span class="mxinfo" id="T3:U79">pi</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,406" id="srcline406">406</a></span><span class="line"><span class="comment">%%% get new BVH</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,407" id="srcline407">407</a></span><span class="line"><span class="mxinfo" id="T3:U80"><span class="var type1" id="S408T3U2040">RElbow_rotateOrder</span> = <span class="mxinfo" id="T3:U82">123</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,408" id="srcline408">408</a></span><span class="line"><span class="mxinfo" id="T7:U83"><span class="var type1" id="S409T7U2044">RElbow_rotateDirection</span> = <span class="mxinfo" id="T7:U85">[-1,1,1]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,409" id="srcline409">409</a></span><span class="line"><span class="mxinfo" id="T7:U86"><span class="var type1" id="S410T7U2053">BVH_rotateDirection</span> = <span class="mxinfo" id="T7:U88">[1,1,1]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,410" id="srcline410">410</a></span><span class="line"><span class="mxinfo" id="T7:U89"><span class="var type1" id="S384T7U2061">RightForeArm_new</span> = <span class="mxinfo" id="T7:U91">zeros(<span class="mxinfo" id="T3:U92"><span class="var type1" id="S393T3U2064">Nframes</span></span>,<span class="mxinfo" id="T3:U94">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,411" id="srcline411">411</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S396T3U2068">k</span>=<span class="mxinfo" id="T3:U96">1:<span class="var type1" id="S393T3U2071">Nframes</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,412" id="srcline412">412</a></span><span class="line">    <span class="mxinfo" id="T7:U98"><span class="mxinfo" id="T7:U99"><span class="var type1" id="S384T7U2075">RightForeArm_new</span>(<span class="mxinfo" id="T3:U101"><span class="var type1" id="S396T3U2076">k</span></span>,:)</span> = <span class="mxinfo" id="T7:U103"><span class="fcn" id="F164N10:B2079">ChangeEulerRotate_c</span>(  <span class="mxinfo" id="T7:U104"><span class="var type1" id="S383T7U2081">RElbow_Nao</span>( <span class="mxinfo" id="T3:U106"><span class="var type1" id="S396T3U2082">k</span></span>,: )</span>,<span class="mxinfo" id="T3:U108"><span class="var type1" id="S408T3U2084">RElbow_rotateOrder</span></span>,<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,413" id="srcline413">413</a></span><span class="line"><span class="mxinfo" id="T7:U98"><span class="mxinfo" id="T7:U103">        <span class="var type1" id="S387T3U2085">rotateOrder_BVH</span>,<span class="mxinfo" id="T7:U111"><span class="var type1" id="S409T7U2086">RElbow_rotateDirection</span></span>,<span class="mxinfo" id="T7:U113"><span class="var type1" id="S410T7U2087">BVH_rotateDirection</span></span> )</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,414" id="srcline414">414</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,415" id="srcline415">415</a></span><span class="line"></span></span>
</pre>
