<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,351" id="srcline351">351</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,352" id="srcline352">352</a></span><span class="line"><span class="comment">%% LeftShoulder</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,353" id="srcline353">353</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S356T3U1752">LShoulderPitch</span>,<span class="var type1" id="S357T3U1753">LShoulderRoll</span>,<span class="var type1" id="S358T7U1754">LeftArm_new</span> ] = TransformLShoulder(  <span class="var type1" id="S359T18U1757">C_Spine3_LShoulderNew</span>,<span class="var type1" id="S360T18U1758">C_Spine3_LArm</span>,<span class="var type1" id="S361T3U1759">rotateOrder_BVH</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="1,354" id="srcline354">354</a></span><span class="line">coder.inline(<span class="string">'never'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,355" id="srcline355">355</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,356" id="srcline356">356</a></span><span class="line"><span class="mxinfo" id="T7:U7"><span class="var type1" id="S363T7U1768">rotateDirection_BVH</span> = <span class="mxinfo" id="T7:U9">[1,1,1]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,357" id="srcline357">357</a></span><span class="line"><span class="mxinfo" id="T18:U10"><span class="var type1" id="S364T18U1776">C_LShoulderNew_Spine3</span> = <span class="mxinfo" id="T18:U12"><span class="fcn" id="F78N13:B1778">InverseC_Multi</span>( <span class="var type1" id="S359T18U1779">C_Spine3_LShoulderNew</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,358" id="srcline358">358</a></span><span class="line"><span class="mxinfo" id="T18:U14"><span class="var type1" id="S366T18U1782">C_LShoulderNew_LArm</span> = <span class="mxinfo" id="T18:U16"><span class="fcn" id="F75N5:B1784">CalculateC_Multi</span>( <span class="var type1" id="S364T18U1785">C_LShoulderNew_Spine3</span>,<span class="var type1" id="S360T18U1786">C_Spine3_LArm</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,359" id="srcline359">359</a></span><span class="line"><span class="comment">%%% 对 C_LShoulderNew_LArm 进行零位补偿</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,360" id="srcline360">360</a></span><span class="line"><span class="mxinfo" id="T3:U19"><span class="var type1" id="S368T3U1789">Nframes</span> = <span class="mxinfo" id="T3:U21">size(<span class="var type1" id="S359T18U1792">C_Spine3_LShoulderNew</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,361" id="srcline361">361</a></span><span class="line"><span class="mxinfo" id="T7:U23"><span class="var type1" id="S370T7U1796">E_naoZero_NoitomZero_YXZ</span> = <span class="mxinfo" id="T7:U25">[pi/2,0,0]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,362" id="srcline362">362</a></span><span class="line"><span class="mxinfo" id="T7:U26"><span class="var type1" id="S370T7U1807">E_naoZero_NoitomZero_YXZ</span> = <span class="mxinfo" id="T7:U28">repmat( <span class="var type1" id="S370T7U1810">E_naoZero_NoitomZero_YXZ</span>,<span class="var type1" id="S368T3U1811">Nframes</span>,1 )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,363" id="srcline363">363</a></span><span class="line"><span class="mxinfo" id="T18:U31"><span class="var type1" id="S373T18U1815">C_naoZero_NoitomZero_YXZ</span> = <span class="mxinfo" id="T18:U33"><span class="fcn" id="F45N11:B1817">EulerToC_c</span>( <span class="var type1" id="S370T7U1818">E_naoZero_NoitomZero_YXZ</span>,213,[1,1,1] )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,364" id="srcline364">364</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,365" id="srcline365">365</a></span><span class="line"><span class="mxinfo" id="T18:U35"><span class="var type1" id="S375T18U1827">C_LShoulderNew_LArm_Nao</span> = <span class="mxinfo" id="T18:U37"><span class="fcn" id="F75N5:B1829">CalculateC_Multi</span>( <span class="mxinfo" id="T18:U38"><span class="var type1" id="S373T18U1830">C_naoZero_NoitomZero_YXZ</span></span>,<span class="var type1" id="S366T18U1831">C_LShoulderNew_LArm</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,366" id="srcline366">366</a></span><span class="line"><span class="mxinfo" id="T7:U41"><span class="var type1" id="S376T7U1834">E_LShoulderNew_LArm_Nao</span> = <span class="mxinfo" id="T7:U43"><span class="fcn" id="F96N4:B1836">CToEuler_c</span>( <span class="var type1" id="S375T18U1837">C_LShoulderNew_LArm_Nao</span>,<span class="mxinfo" id="T3:U45">321</span>,<span class="mxinfo" id="T7:U46">[-1,1,1]</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,367" id="srcline367">367</a></span><span class="line"><span class="mxinfo" id="T3:U47"><span class="mxinfo" id="T3:U48"><span class="var type1" id="S376T7U1848">E_LShoulderNew_LArm_Nao</span>(:,<span class="mxinfo" id="T3:U50">3</span>)</span> = <span class="mxinfo" id="T3:U51">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,368" id="srcline368">368</a></span><span class="line"><span class="mxinfo" id="T18:U52"><span class="var type1" id="S378T18U1854">C_LShoulderNew_LArm_NaoNew</span> = <span class="mxinfo" id="T18:U54"><span class="fcn" id="F45N11:B1856">EulerToC_c</span>( <span class="var type1" id="S376T7U1857">E_LShoulderNew_LArm_Nao</span>,<span class="mxinfo" id="T3:U56">321</span>,<span class="mxinfo" id="T7:U57">[-1,1,1]</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,369" id="srcline369">369</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,370" id="srcline370">370</a></span><span class="line"><span class="mxinfo" id="T3:U58"><span class="var type1" id="S356T3U1867">LShoulderPitch</span> = <span class="mxinfo" id="T3:U60"><span class="var type1" id="S376T7U1870">E_LShoulderNew_LArm_Nao</span>(:,<span class="mxinfo" id="T3:U62">1</span>)</span>'</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,371" id="srcline371">371</a></span><span class="line"><span class="mxinfo" id="T3:U63"><span class="var type1" id="S357T3U1875">LShoulderRoll</span> = <span class="mxinfo" id="T3:U65"><span class="var type1" id="S376T7U1878">E_LShoulderNew_LArm_Nao</span>(:,<span class="mxinfo" id="T3:U67">2</span>)</span>'</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,372" id="srcline372">372</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,373" id="srcline373">373</a></span><span class="line"><span class="comment">%%% get new BVH</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,374" id="srcline374">374</a></span><span class="line"><span class="comment">% 零位补偿回去</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,375" id="srcline375">375</a></span><span class="line"><span class="mxinfo" id="T7:U68"><span class="var type1" id="S379T7U1883">E_NoitomZero_naoZero_ZYX</span> = <span class="mxinfo" id="T7:U70">[0,-pi/2,0]</span></span>;  <span class="comment">% 'ZYX'</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,376" id="srcline376">376</a></span><span class="line"><span class="mxinfo" id="T7:U71"><span class="var type1" id="S379T7U1895">E_NoitomZero_naoZero_ZYX</span> = <span class="mxinfo" id="T7:U73">repmat( <span class="var type1" id="S379T7U1898">E_NoitomZero_naoZero_ZYX</span>,<span class="var type1" id="S368T3U1899">Nframes</span>,1 )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,377" id="srcline377">377</a></span><span class="line"><span class="mxinfo" id="T18:U76"><span class="var type1" id="S380T18U1903">C_NoitomZero_naoZero_ZYX</span> = <span class="mxinfo" id="T18:U78"><span class="fcn" id="F45N11:B1905">EulerToC_c</span>( <span class="var type1" id="S379T7U1906">E_NoitomZero_naoZero_ZYX</span>,321,[1,1,1] )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,378" id="srcline378">378</a></span><span class="line"><span class="mxinfo" id="T18:U80"><span class="var type1" id="S381T18U1915">C_LShoulderNew_LArm_NoitomNew</span> = <span class="mxinfo" id="T18:U82"><span class="fcn" id="F75N5:B1917">CalculateC_Multi</span>( <span class="mxinfo" id="T18:U83"><span class="var type1" id="S380T18U1918">C_NoitomZero_naoZero_ZYX</span></span>,<span class="var type1" id="S378T18U1919">C_LShoulderNew_LArm_NaoNew</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,379" id="srcline379">379</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,380" id="srcline380">380</a></span><span class="line"><span class="mxinfo" id="T7:U86"><span class="var type1" id="S358T7U1922">LeftArm_new</span> = <span class="mxinfo" id="T7:U88"><span class="fcn" id="F96N4:B1924">CToEuler_c</span>( <span class="var type1" id="S381T18U1925">C_LShoulderNew_LArm_NoitomNew</span>,<span class="var type1" id="S361T3U1926">rotateOrder_BVH</span>,<span class="mxinfo" id="T7:U91"><span class="var type1" id="S363T7U1927">rotateDirection_BVH</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,381" id="srcline381">381</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,382" id="srcline382">382</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,383" id="srcline383">383</a></span><span class="line"><span class="comment">%% REblow</span></span></span>
</pre>
