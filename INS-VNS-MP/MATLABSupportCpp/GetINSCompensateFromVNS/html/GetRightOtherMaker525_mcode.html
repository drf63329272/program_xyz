<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="56,6" id="srcline6">  6</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%% 跟踪测量见说明文档</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,8" id="srcline8">  8</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,9" id="srcline9">  9</a></span><span class="line"><span class="comment">%% 判断思路：比较2个相对位移矢量：1）dT(3 sec)运动时间时  2）dS（1m）运动位移长度时</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">% 1)dT(3 sec)时间内，惯性和视觉位移向量的大小差&lt;0.1m，方向差&lt;60°（当位移矢量长度小于0.2m时不比较方向）</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,11" id="srcline11"> 11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,12" id="srcline12"> 12</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S2T12U3">trackedMakerPosition_InertialTime_Out</span>,<span class="var type1" id="S3T1U4">otherMakers</span> ] = <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,13" id="srcline13"> 13</a></span><span class="line">    GetRightOtherMaker( <span class="mxinfo" id="T1:U3"><span class="mxinfo" id="T1:U4"><span class="var type1" id="S3T1U7">otherMakers</span></span></span>,<span class="var type1" id="S4T12U8">InertialPosition</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="56,14" id="srcline14"> 14</a></span><span class="line">coder.extrinsic(<span class="string">'fprintf'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="56,15" id="srcline15"> 15</a></span><span class="line">coder.extrinsic(<span class="string">'DrawTracedINSVNS'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="56,16" id="srcline16"> 16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,17" id="srcline17"> 17</a></span><span class="line"><span class="keyword">global</span>    <span class="var type0" id="S6T0U22">visionFre</span> <span class="var type0" id="S7T0U23">inertialFre</span> </span></span>
<span class="srcline"><span class="lineno"><a href="56,18" id="srcline18"> 18</a></span><span class="line"><span class="keyword">global</span>      <span class="var type1" id="S8T2U25">IsGetFirstMarker</span> </span></span>
<span class="srcline"><span class="lineno"><a href="56,19" id="srcline19"> 19</a></span><span class="line"><span class="keyword">global</span>      <span class="var type0" id="S9T0U27">CalStartVN</span> <span class="var type0" id="S10T0U28">CalEndVN</span>   <span class="var type0" id="S11T0U29">IsOnLine</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,20" id="srcline20"> 20</a></span><span class="line"><span class="keyword">global</span> <span class="var type0" id="S12T0U31">InertialData_visual_k</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,21" id="srcline21"> 21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">%% 阈值参数设置</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,23" id="srcline23"> 23</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type1" id="S13T38U33">makerTrackThreshold</span> <span class="var type1" id="S14T40U34">INSVNSCalibSet</span> </span></span>
<span class="srcline"><span class="lineno"><a href="56,24" id="srcline24"> 24</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T14:U10"><span class="mxinfo" id="T14:U11">isempty(<span class="var type0" id="S13T0U39">makerTrackThreshold</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,25" id="srcline25"> 25</a></span><span class="line">    <span class="mxinfo" id="T38:U12">[ <span class="var type1" id="S13T38U43">makerTrackThreshold</span>,<span class="var type1" id="S14T40U44">INSVNSCalibSet</span> ] = <span class="fcn" id="F151N22:B46">SetParameters</span>( )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,26" id="srcline26"> 26</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,27" id="srcline27"> 27</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,28" id="srcline28"> 28</a></span><span class="line"><span class="mxinfo" id="T2:U15"><span class="var type1" id="S8T2U49">IsGetFirstMarker</span> = <span class="mxinfo" id="T2:U17">0</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,29" id="srcline29"> 29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,30" id="srcline30"> 30</a></span><span class="line"><span class="mxinfo" id="T2:U18"><span class="var type1" id="S17T2U53">dT_Ninertial</span> = <span class="mxinfo" id="T2:U20">fix(<span class="mxinfo" id="T2:U21"><span class="mxinfo" id="T2:U22"><span class="var type1" id="S13T38U58">makerTrackThreshold</span>.moveTime</span>*<span class="var type1" id="S7T2U60">inertialFre</span></span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,31" id="srcline31"> 31</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">%% 在线/离线 第一次要求预定义变量大小</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,33" id="srcline33"> 33</a></span><span class="line"><span class="keyword">persistent</span>   <span class="var type1" id="S19T12U62">trackedMakerPosition_InertialTime</span>  <span class="var type1" id="S20T47U63">trackedMakerPosition</span> <span class="var type1" id="S21T36U64">TrackFlag</span> <span class="var type1" id="S22T54U65">trackedMarkerVelocity</span>  <span class="var type1" id="S23T66U66">InertialVelocity</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,34" id="srcline34"> 34</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type1" id="S24T53U68">INSVNSCalib_VS_k</span>  <span class="var type1" id="S25T2U69">Calib_N_New</span>  <span class="var type1" id="S26T2U70">IsCalibDataEnough</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,35" id="srcline35"> 35</a></span><span class="line"><span class="mxinfo" id="T2:U33"><span class="var type1" id="S27T2U73">MarkerTN</span> = <span class="mxinfo" id="T2:U35">length(<span class="var type1" id="S3T1U76">otherMakers</span>)</span></span>;   <span class="comment">%  视觉时间长度</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,36" id="srcline36"> 36</a></span><span class="line"><span class="mxinfo" id="T2:U37"><span class="var type1" id="S29T2U79">InertialN</span> = <span class="mxinfo" id="T2:U39">size(<span class="var type1" id="S4T12U82">InertialPosition</span>,2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,37" id="srcline37"> 37</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,38" id="srcline38"> 38</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T14:U41"><span class="mxinfo" id="T14:U42">isempty(<span class="var type0" id="S23T0U88">InertialVelocity</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,39" id="srcline39"> 39</a></span><span class="line">    <span class="mxinfo" id="T36:U43"><span class="var type1" id="S21T36U91">TrackFlag</span> = <span class="mxinfo" id="T36:U45">zeros(<span class="mxinfo" id="T2:U46">1</span>,<span class="mxinfo" id="T2:U47"><span class="var type1" id="S27T2U95">MarkerTN</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,40" id="srcline40"> 40</a></span><span class="line">    <span class="mxinfo" id="T47:U49"><span class="var type1" id="S20T47U98">trackedMakerPosition</span> = <span class="mxinfo" id="T47:U51">NaN(<span class="mxinfo" id="T2:U52">3</span>,<span class="mxinfo" id="T2:U53"><span class="var type1" id="S27T2U102">MarkerTN</span></span>)</span></span>; <span class="comment">% 判断成功的马克点位置</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,41" id="srcline41"> 41</a></span><span class="line">    <span class="mxinfo" id="T12:U55"><span class="var type1" id="S19T12U105">trackedMakerPosition_InertialTime</span> = <span class="mxinfo" id="T12:U57">NaN( <span class="mxinfo" id="T2:U58">3</span>,<span class="mxinfo" id="T2:U59"><span class="var type1" id="S29T2U109">InertialN</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,42" id="srcline42"> 42</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="56,43" id="srcline43"> 43</a></span><span class="line">    <span class="mxinfo" id="T66:U61"><span class="var type1" id="S23T66U112">InertialVelocity</span> = <span class="mxinfo" id="T66:U63">NaN(<span class="mxinfo" id="T2:U64">5</span>,<span class="mxinfo" id="T2:U65"><span class="var type1" id="S29T2U116">InertialN</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,44" id="srcline44"> 44</a></span><span class="line">    <span class="mxinfo" id="T54:U67"><span class="var type1" id="S22T54U119">trackedMarkerVelocity</span> = <span class="mxinfo" id="T54:U69">NaN(<span class="mxinfo" id="T2:U70">5</span>,<span class="mxinfo" id="T2:U71"><span class="var type1" id="S27T2U123">MarkerTN</span></span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="56,45" id="srcline45"> 45</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="56,46" id="srcline46"> 46</a></span><span class="line">    <span class="mxinfo" id="T53:U73"><span class="var type1" id="S24T53U126">INSVNSCalib_VS_k</span> = <span class="mxinfo" id="T53:U75">NaN(<span class="mxinfo" id="T2:U76">2</span>,<span class="mxinfo" id="T2:U77">50</span>)</span></span>; <span class="comment">% INSVNSCalib_VS_k（:,i）存储一段位移</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,47" id="srcline47"> 47</a></span><span class="line">    <span class="mxinfo" id="T2:U78"><span class="var type1" id="S25T2U133">Calib_N_New</span> = <span class="mxinfo" id="T2:U80">0</span></span>;   <span class="comment">% 搜索乘的位移段个数</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,48" id="srcline48"> 48</a></span><span class="line">    <span class="mxinfo" id="T2:U81"><span class="var type1" id="S26T2U137">IsCalibDataEnough</span> = <span class="mxinfo" id="T2:U83">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,49" id="srcline49"> 49</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,50" id="srcline50"> 50</a></span><span class="line"><span class="comment">%% 这些判断指标只在离线时记录</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,51" id="srcline51"> 51</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type1" id="S33T36U140">dPi_ConJudge</span> <span class="var type1" id="S34T36U141">dPError_dT_xy</span>  <span class="var type1" id="S35T36U142">dPError_dT_z</span>  <span class="var type1" id="S36T36U143">dPError_dS_xyNorm</span> <span class="var type1" id="S37T36U144">dP_Inertial_xyNorm</span>  <span class="var type1" id="S38T36U145">angleErr_dS</span>  <span class="var type1" id="S39T36U146">angleErr_dT_Min</span> <span class="var type1" id="S40T36U147">ConTrackedFailed</span> <span class="var type1" id="S41T36U148">INSVNSMarkHC_Min</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,52" id="srcline52"> 52</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T14:U93"><span class="mxinfo" id="T14:U94">isempty(<span class="var type0" id="S33T0U153">dPi_ConJudge</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,53" id="srcline53"> 53</a></span><span class="line">    <span class="mxinfo" id="T36:U95"><span class="var type1" id="S33T36U156">dPi_ConJudge</span> = <span class="mxinfo" id="T36:U97">NaN(<span class="mxinfo" id="T2:U98">1</span>,<span class="mxinfo" id="T2:U99"><span class="var type1" id="S27T2U160">MarkerTN</span></span>)</span></span>;   </span></span>
<span class="srcline"><span class="lineno"><a href="56,54" id="srcline54"> 54</a></span><span class="line">    <span class="mxinfo" id="T36:U101"><span class="var type1" id="S34T36U163">dPError_dT_xy</span> = <span class="mxinfo" id="T36:U103">NaN(<span class="mxinfo" id="T2:U104">1</span>,<span class="mxinfo" id="T2:U105"><span class="var type1" id="S27T2U167">MarkerTN</span></span>)</span></span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="56,55" id="srcline55"> 55</a></span><span class="line">    <span class="mxinfo" id="T36:U107"><span class="var type1" id="S35T36U170">dPError_dT_z</span> = <span class="mxinfo" id="T36:U109">NaN(<span class="mxinfo" id="T2:U110">1</span>,<span class="mxinfo" id="T2:U111"><span class="var type1" id="S27T2U174">MarkerTN</span></span>)</span></span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="56,56" id="srcline56"> 56</a></span><span class="line">    <span class="mxinfo" id="T36:U113"><span class="var type1" id="S36T36U177">dPError_dS_xyNorm</span> = <span class="mxinfo" id="T36:U115">NaN(<span class="mxinfo" id="T2:U116">1</span>,<span class="mxinfo" id="T2:U117"><span class="var type1" id="S27T2U181">MarkerTN</span></span>)</span></span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="56,57" id="srcline57"> 57</a></span><span class="line">    <span class="mxinfo" id="T36:U119"><span class="var type1" id="S37T36U184">dP_Inertial_xyNorm</span> = <span class="mxinfo" id="T36:U121">NaN(<span class="mxinfo" id="T2:U122">1</span>,<span class="mxinfo" id="T2:U123"><span class="var type1" id="S27T2U188">MarkerTN</span></span>)</span></span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="56,58" id="srcline58"> 58</a></span><span class="line">    <span class="mxinfo" id="T36:U125"><span class="var type1" id="S38T36U191">angleErr_dS</span> = <span class="mxinfo" id="T36:U127">NaN(<span class="mxinfo" id="T2:U128">1</span>,<span class="mxinfo" id="T2:U129"><span class="var type1" id="S27T2U195">MarkerTN</span></span>)</span></span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="56,59" id="srcline59"> 59</a></span><span class="line">    <span class="mxinfo" id="T36:U131"><span class="var type1" id="S39T36U198">angleErr_dT_Min</span> = <span class="mxinfo" id="T36:U133">NaN(<span class="mxinfo" id="T2:U134">1</span>,<span class="mxinfo" id="T2:U135"><span class="var type1" id="S27T2U202">MarkerTN</span></span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="56,60" id="srcline60"> 60</a></span><span class="line">    <span class="mxinfo" id="T36:U137"><span class="var type1" id="S40T36U205">ConTrackedFailed</span> = <span class="mxinfo" id="T36:U139">zeros(<span class="mxinfo" id="T2:U140">1</span>,<span class="mxinfo" id="T2:U141"><span class="var type1" id="S27T2U209">MarkerTN</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,61" id="srcline61"> 61</a></span><span class="line">    <span class="mxinfo" id="T36:U143"><span class="var type1" id="S41T36U212">INSVNSMarkHC_Min</span> = <span class="mxinfo" id="T36:U145">NaN(<span class="mxinfo" id="T2:U146">1</span>,<span class="mxinfo" id="T2:U147"><span class="var type1" id="S27T2U216">MarkerTN</span></span>)</span></span>;               </span></span>
<span class="srcline"><span class="lineno"><a href="56,62" id="srcline62"> 62</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,63" id="srcline63"> 63</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,64" id="srcline64"> 64</a></span><span class="line"><span class="comment">%% 求惯性速度</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,65" id="srcline65"> 65</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S42T2U219">k</span>=<span class="mxinfo" id="T2:U150">1</span>:<span class="var type1" id="S29T2U222">InertialN</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,66" id="srcline66"> 66</a></span><span class="line">    <span class="mxinfo" id="T41:U152">[ <span class="var type1" id="S43T70U226">InertialVelocity_i</span>,<span class="var type1" id="S44T2U227">k_calV</span> ] = <span class="fcn" id="F183N9:B229">CalVelocity</span>( <span class="var type1" id="S4T12U230">InertialPosition</span>,<span class="var type1" id="S42T2U231">k</span>,<span class="var type1" id="S7T2U232">inertialFre</span>,<span class="mxinfo" id="T2:U158"><span class="var type1" id="S14T40U234">INSVNSCalibSet</span>.dT_CalV_Calib</span>,<span class="mxinfo" id="T2:U160"><span class="var type1" id="S14T40U237">INSVNSCalibSet</span>.MinXYVNorm_CalAngle</span> )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,67" id="srcline67"> 67</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T14:U162"><span class="var type1" id="S44T2U242">k_calV</span>&gt;<span class="mxinfo" id="T2:U164">0</span></span> </span></span>
<span class="srcline"><span class="lineno"><a href="56,68" id="srcline68"> 68</a></span><span class="line">        <span class="mxinfo" id="T55:U165"><span class="mxinfo" id="T55:U166"><span class="var type1" id="S23T66U247">InertialVelocity</span>(:,<span class="var type1" id="S44T2U249">k_calV</span>)</span> = <span class="var type1" id="S43T70U250">InertialVelocity_i</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,69" id="srcline69"> 69</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,70" id="srcline70"> 70</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,71" id="srcline71"> 71</a></span><span class="line"><span class="comment">%% 单马克点跟踪 </span></span></span>
<span class="srcline"><span class="lineno"><a href="56,72" id="srcline72"> 72</a></span><span class="line">coder.extrinsic(<span class="string">'waitbar'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="56,73" id="srcline73"> 73</a></span><span class="line">coder.extrinsic(<span class="string">'close'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="56,74" id="srcline74"> 74</a></span><span class="line"> <span class="mxinfo" id="T43:U170"><span class="var type1" id="S46T43U265">wh</span> = <span class="mxinfo" id="T43:U172"><span class="extrinsicFcn" id="F531N47:B267">waitbar</span>(<span class="mxinfo" id="T2:U173">0</span>,<span class="mxinfo" id="T88:U174"><span class="string">'SearchDistanceK'</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,75" id="srcline75"> 75</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S42T2U272">k</span>=<span class="var type1" id="S9T2U274">CalStartVN</span>:<span class="var type1" id="S10T2U275">CalEndVN</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,76" id="srcline76"> 76</a></span><span class="line">    <span class="mxinfo" id="T44:U178"><span class="var type1" id="S48T44U278">otherMakers_k</span> = <span class="mxinfo" id="T44:U180"><span class="var type1" id="S3T1U280">otherMakers</span>(<span class="var type1" id="S42T2U281">k</span>)</span></span> ;  </span></span>
<span class="srcline"><span class="lineno"><a href="56,77" id="srcline77"> 77</a></span><span class="line">    <span class="mxinfo" id="T4:U183"><span class="var type1" id="S49T4U284">inertial_k</span> = <span class="mxinfo" id="T4:U185"><span class="var type1" id="S48T44U286">otherMakers_k</span>.inertial_k</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,78" id="srcline78"> 78</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="56,79" id="srcline79"> 79</a></span><span class="line">    <span class="comment">%  last_dT_k</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,80" id="srcline80"> 80</a></span><span class="line">    <span class="mxinfo" id="T4:U187"><span class="var type1" id="S50T4U290">inertial_dT_k_last</span> = <span class="mxinfo" id="T2:U189"><span class="var type1" id="S49T4U292">inertial_k</span> - <span class="var type1" id="S17T2U293">dT_Ninertial</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,81" id="srcline81"> 81</a></span><span class="line">    <span class="mxinfo" id="T4:U192"><span class="var type1" id="S50T4U296">inertial_dT_k_last</span> = <span class="mxinfo" id="T4:U194">max(<span class="var type1" id="S50T4U299">inertial_dT_k_last</span>,<span class="mxinfo" id="T2:U196">1</span>)</span></span>;        </span></span>
<span class="srcline"><span class="lineno"><a href="56,82" id="srcline82"> 82</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="56,83" id="srcline83"> 83</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T14:U197"><span class="var type1" id="S42T2U304">k</span>&gt;<span class="mxinfo" id="T2:U199">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,84" id="srcline84"> 84</a></span><span class="line">        <span class="mxinfo" id="T68:U200"><span class="var type1" id="S52T68U308">otherMakers_k_last</span> = <span class="mxinfo" id="T44:U202"><span class="var type1" id="S3T1U310">otherMakers</span>(<span class="mxinfo" id="T2:U204"><span class="var type1" id="S42T2U312">k</span>-<span class="mxinfo" id="T2:U206">1</span></span>)</span></span> ;         </span></span>
<span class="srcline"><span class="lineno"><a href="56,85" id="srcline85"> 85</a></span><span class="line"><span class="comment">%         if k&gt;2 &amp;&amp; isnan(trackedMakerPosition(1,k-2))</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,86" id="srcline86"> 86</a></span><span class="line"><span class="comment">%             if sum(otherMakers_k_last.ContinuesFlag==1)~=0</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,87" id="srcline87"> 87</a></span><span class="line"><span class="comment">%                disp('err') </span></span></span>
<span class="srcline"><span class="lineno"><a href="56,88" id="srcline88"> 88</a></span><span class="line"><span class="comment">%             end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,89" id="srcline89"> 89</a></span><span class="line"><span class="comment">%         end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,90" id="srcline90"> 90</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,91" id="srcline91"> 91</a></span><span class="line">        <span class="mxinfo" id="T68:U207"><span class="var type1" id="S52T68U317">otherMakers_k_last</span> = <span class="mxinfo" id="T68:U209"><span class="fcn" id="F199N18:B319">GetEmpty_otherMakers</span>(<span class="var type1" id="S48T44U320">otherMakers_k</span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,92" id="srcline92"> 92</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,93" id="srcline93"> 93</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="56,94" id="srcline94"> 94</a></span><span class="line">    <span class="mxinfo" id="T41:U211">[ <span class="var type1" id="S20T47U325">trackedMakerPosition</span>(:,<span class="var type1" id="S42T2U327">k</span>),<span class="var type1" id="S54T44U328">otherMakersNew_k</span>,<span class="var type1" id="S21T36U330">TrackFlag</span>(<span class="var type1" id="S42T2U331">k</span>),<span class="var type1" id="S55T52U332">JudgeIndex</span>  ] = <span class="fcn" id="F278N19:B334">JudgeMaker</span><span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,95" id="srcline95"> 95</a></span><span class="line"><span class="mxinfo" id="T41:U211">        ( <span class="var type1" id="S48T44U335">otherMakers_k</span>,<span class="var type1" id="S52T68U336">otherMakers_k_last</span>,<span class="var type1" id="S42T2U337">k</span>,<span class="var type1" id="S49T4U338">inertial_k</span>,<span class="var type1" id="S20T47U339">trackedMakerPosition</span>,<span class="var type1" id="S4T12U340">InertialPosition</span>,<span class="var type1" id="S50T4U341">inertial_dT_k_last</span>,<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,96" id="srcline96"> 96</a></span><span class="line"><span class="mxinfo" id="T41:U211">        <span class="var type1" id="S13T38U342">makerTrackThreshold</span> )</span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,97" id="srcline97"> 97</a></span><span class="line">    <span class="mxinfo" id="T44:U226"><span class="mxinfo" id="T44:U227"><span class="var type1" id="S3T1U346">otherMakers</span>(<span class="var type1" id="S42T2U347">k</span>)</span>=<span class="var type1" id="S54T44U348">otherMakersNew_k</span></span>;     <span class="comment">% 更新 otherMakers(k)</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,98" id="srcline98"> 98</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="56,99" id="srcline99"> 99</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T14:U231"><span class="var type1" id="S11T2U352">IsOnLine</span> == <span class="mxinfo" id="T2:U233">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,100" id="srcline100">100</a></span><span class="line">        <span class="mxinfo" id="T2:U234"><span class="mxinfo" id="T2:U235"><span class="var type1" id="S33T36U357">dPi_ConJudge</span>(<span class="var type1" id="S42T2U358">k</span>)</span> = <span class="mxinfo" id="T2:U238"><span class="var type1" id="S55T52U360">JudgeIndex</span>.dPi_ConJudge</span></span>  ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,101" id="srcline101">101</a></span><span class="line">        <span class="mxinfo" id="T2:U240"><span class="mxinfo" id="T2:U241"><span class="var type1" id="S34T36U365">dPError_dT_xy</span>(<span class="var type1" id="S42T2U366">k</span>)</span> = <span class="mxinfo" id="T2:U244"><span class="var type1" id="S55T52U368">JudgeIndex</span>.dPError_dT_xy</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,102" id="srcline102">102</a></span><span class="line">        <span class="mxinfo" id="T2:U246"><span class="mxinfo" id="T2:U247"><span class="var type1" id="S35T36U373">dPError_dT_z</span>(<span class="var type1" id="S42T2U374">k</span>)</span> = <span class="mxinfo" id="T2:U250"><span class="var type1" id="S55T52U376">JudgeIndex</span>.dPError_dT_z</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,103" id="srcline103">103</a></span><span class="line">        <span class="mxinfo" id="T2:U252"><span class="mxinfo" id="T2:U253"><span class="var type1" id="S36T36U381">dPError_dS_xyNorm</span>(<span class="var type1" id="S42T2U382">k</span>)</span> = <span class="mxinfo" id="T2:U256"><span class="var type1" id="S55T52U384">JudgeIndex</span>.dPError_dS_xyNorm</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,104" id="srcline104">104</a></span><span class="line">        <span class="mxinfo" id="T2:U258"><span class="mxinfo" id="T2:U259"><span class="var type1" id="S37T36U389">dP_Inertial_xyNorm</span>(<span class="var type1" id="S42T2U390">k</span>)</span> = <span class="mxinfo" id="T2:U262"><span class="var type1" id="S55T52U392">JudgeIndex</span>.dP_Inertial_xyNorm</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,105" id="srcline105">105</a></span><span class="line">        <span class="mxinfo" id="T2:U264"><span class="mxinfo" id="T2:U265"><span class="var type1" id="S39T36U397">angleErr_dT_Min</span>(<span class="var type1" id="S42T2U398">k</span>)</span> = <span class="mxinfo" id="T2:U268"><span class="var type1" id="S55T52U400">JudgeIndex</span>.angleErr_dT_Min</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,106" id="srcline106">106</a></span><span class="line">        <span class="mxinfo" id="T2:U270"><span class="mxinfo" id="T2:U271"><span class="var type1" id="S38T36U405">angleErr_dS</span>(<span class="var type1" id="S42T2U406">k</span>)</span> = <span class="mxinfo" id="T2:U274"><span class="var type1" id="S55T52U408">JudgeIndex</span>.angleErr_dS</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,107" id="srcline107">107</a></span><span class="line">        <span class="mxinfo" id="T2:U276"><span class="mxinfo" id="T2:U277"><span class="var type1" id="S41T36U413">INSVNSMarkHC_Min</span>(<span class="var type1" id="S42T2U414">k</span>)</span> = <span class="mxinfo" id="T2:U280"><span class="var type1" id="S55T52U416">JudgeIndex</span>.INSVNSMarkHC_Min</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,108" id="srcline108">108</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,109" id="srcline109">109</a></span><span class="line">       </span></span>
<span class="srcline"><span class="lineno"><a href="56,110" id="srcline110">110</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T14:U282"><span class="mxinfo" id="T2:U283">sum(<span class="mxinfo" id="T30:U284"><span class="mxinfo" id="T7:U285"><span class="var type1" id="S54T44U426">otherMakersNew_k</span>.ContinuesFlag</span>==<span class="mxinfo" id="T2:U287">1</span></span>)</span>~=<span class="mxinfo" id="T2:U288">0</span></span> &amp;&amp; <span class="mxinfo" id="T14:U289">isnan(<span class="mxinfo" id="T2:U290"><span class="var type1" id="S20T47U433">trackedMakerPosition</span>(<span class="mxinfo" id="T2:U292">1</span>,<span class="var type1" id="S42T2U435">k</span>)</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,111" id="srcline111">111</a></span><span class="line">        <span class="mxinfo" id="T2:U294"><span class="mxinfo" id="T2:U295"><span class="var type1" id="S40T36U439">ConTrackedFailed</span>(<span class="var type1" id="S42T2U440">k</span>)</span> = <span class="mxinfo" id="T2:U298">1</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,112" id="srcline112">112</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,113" id="srcline113">113</a></span><span class="line">        <span class="mxinfo" id="T2:U299"><span class="mxinfo" id="T2:U300"><span class="var type1" id="S40T36U446">ConTrackedFailed</span>(<span class="var type1" id="S42T2U447">k</span>)</span> = <span class="mxinfo" id="T2:U303">0</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,114" id="srcline114">114</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,115" id="srcline115">115</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="56,116" id="srcline116">116</a></span><span class="line">    <span class="comment">%% 求  INSMarkH0  VNSMarkH0</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,117" id="srcline117">117</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T14:U304">isnan(<span class="mxinfo" id="T2:U305"><span class="var type1" id="S13T38U455">makerTrackThreshold</span>.INSMarkH0</span>)</span> &amp;&amp; <span class="mxinfo" id="T14:U307">~<span class="mxinfo" id="T14:U308">isnan(<span class="mxinfo" id="T2:U309"><span class="var type1" id="S20T47U461">trackedMakerPosition</span>(<span class="mxinfo" id="T2:U311">1</span>,<span class="var type1" id="S42T2U463">k</span>)</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,118" id="srcline118">118</a></span><span class="line">        <span class="mxinfo" id="T43:U313"><span class="extrinsicFcn" id="F542N44:B466">fprintf</span>( <span class="mxinfo" id="T98:U314"><span class="string">'第一个点搜素成功 time = %0.1f sec, TrackFlag(%d) = %0.1f ,'</span></span>,<span class="mxinfo" id="T2:U315"><span class="var type1" id="S42T2U469">k</span>/<span class="var type1" id="S6T2U470">visionFre</span></span>,<span class="var type1" id="S42T2U471">k</span>,<span class="mxinfo" id="T2:U319"><span class="var type1" id="S21T36U473">TrackFlag</span>(<span class="var type1" id="S42T2U474">k</span>)</span> )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,119" id="srcline119">119</a></span><span class="line">        <span class="comment">% 检测Hip的俯仰和横滚小才取值！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,120" id="srcline120">120</a></span><span class="line">        <span class="mxinfo" id="T2:U322"><span class="mxinfo" id="T2:U323"><span class="var type1" id="S13T38U478">makerTrackThreshold</span>.INSMarkH0</span> = <span class="mxinfo" id="T2:U325">- <span class="mxinfo" id="T2:U326"><span class="var type1" id="S4T12U482">InertialPosition</span>(<span class="mxinfo" id="T2:U328">3</span>,<span class="var type1" id="S49T4U484">inertial_k</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,121" id="srcline121">121</a></span><span class="line">        <span class="mxinfo" id="T2:U330"><span class="mxinfo" id="T2:U331"><span class="var type1" id="S13T38U488">makerTrackThreshold</span>.VNSMarkH0</span> = <span class="mxinfo" id="T2:U333">- <span class="mxinfo" id="T2:U334"><span class="var type1" id="S20T47U492">trackedMakerPosition</span>(<span class="mxinfo" id="T2:U336">3</span>,<span class="var type1" id="S42T2U494">k</span>)</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,122" id="srcline122">122</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="56,123" id="srcline123">123</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="56,124" id="srcline124">124</a></span><span class="line"><span class="comment">%         HipQuaternion_k = HipQuaternion( :,inertial_k );</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,125" id="srcline125">125</a></span><span class="line"><span class="comment">%         HipAttitude = GetHipAttitude( HipQuaternion_k );</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,126" id="srcline126">126</a></span><span class="line"><span class="comment">%         </span></span></span>
<span class="srcline"><span class="lineno"><a href="56,127" id="srcline127">127</a></span><span class="line"><span class="comment">%         HipQuaternion_k = Qinv( HipQuaternion_k ) ; % 四元数定义由 顺时针 改为 逆时针。</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,128" id="srcline128">128</a></span><span class="line"><span class="comment">%         </span></span></span>
<span class="srcline"><span class="lineno"><a href="56,129" id="srcline129">129</a></span><span class="line"><span class="comment">%         CHip_k = Q2C(HipQuaternion_k);</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,130" id="srcline130">130</a></span><span class="line"><span class="comment">%         </span></span></span>
<span class="srcline"><span class="lineno"><a href="56,131" id="srcline131">131</a></span><span class="line"><span class="comment">%         C_HipLUF_NED0 = RotateX(pi/2) * RotateY(-pi/2);  % Hip 的左上前系 到 NED的0姿态系</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,132" id="srcline132">132</a></span><span class="line"><span class="comment">%         C_NED_HipNED0 = C_HipLUF_NED0 * CHip_k ;               </span></span></span>
<span class="srcline"><span class="lineno"><a href="56,133" id="srcline133">133</a></span><span class="line"><span class="comment">%         Attitude = C2Euler( C_NED_HipNED0,'ZYX' )*180/pi</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,134" id="srcline134">134</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="56,135" id="srcline135">135</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="56,136" id="srcline136">136</a></span><span class="line">        <span class="comment">%% 第一次跟踪马克点成功</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,137" id="srcline137">137</a></span><span class="line">        <span class="comment">% 标定视觉与光学的原点（不考虑方向差）</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,138" id="srcline138">138</a></span><span class="line">        <span class="mxinfo" id="T42:U338"><span class="var type1" id="S60T42U497">Xrw_r</span> = <span class="mxinfo" id="T42:U340"><span class="mxinfo" id="T42:U341"><span class="var type1" id="S20T47U500">trackedMakerPosition</span>(<span class="mxinfo" id="T39:U343"><span class="mxinfo" id="T2:U344">1</span>:<span class="mxinfo" id="T2:U345">2</span></span>,<span class="var type1" id="S42T2U504">k</span>)</span> - <span class="mxinfo" id="T42:U347"><span class="var type1" id="S4T12U506">InertialPosition</span>(<span class="mxinfo" id="T39:U349"><span class="mxinfo" id="T2:U350">1</span>:<span class="mxinfo" id="T2:U351">2</span></span>,<span class="var type1" id="S49T4U510">inertial_k</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,139" id="srcline139">139</a></span><span class="line">        <span class="mxinfo" id="T6:U353"><span class="var type1" id="S60T6U513">Xrw_r</span> = <span class="mxinfo" id="T6:U355">[<span class="var type1" id="S60T42U516">Xrw_r</span>;<span class="mxinfo" id="T2:U357">0</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,140" id="srcline140">140</a></span><span class="line">        <span class="mxinfo" id="T2:U358"><span class="var type1" id="S61T2U521">N_otherMakers</span> = <span class="mxinfo" id="T2:U360">length( <span class="var type1" id="S3T1U524">otherMakers</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,141" id="srcline141">141</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S62T2U527">i</span>=<span class="mxinfo" id="T2:U363">1</span>:<span class="var type1" id="S61T2U530">N_otherMakers</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,142" id="srcline142">142</a></span><span class="line">            <span class="keyword">if</span> ~isempty(<span class="var type1" id="S3T1U538">otherMakers</span>(<span class="var type1" id="S62T2U539">i</span>).Position)</span></span>
<span class="srcline"><span class="lineno"><a href="56,143" id="srcline143">143</a></span><span class="line">                <span class="mxinfo" id="T2:U367"><span class="var type1" id="S63T2U543">m</span> = <span class="mxinfo" id="T2:U369">size( <span class="var type1" id="S3T1U548">otherMakers</span>(<span class="var type1" id="S62T2U549">i</span>).Position,2 )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,144" id="srcline144">144</a></span><span class="line">                <span class="mxinfo" id="T3:U372"><span class="mxinfo" id="T3:U373"><span class="mxinfo" id="T44:U374"><span class="var type1" id="S3T1U556">otherMakers</span>(<span class="var type1" id="S62T2U557">i</span>)</span>.Position</span> = <span class="mxinfo" id="T3:U377"><span class="mxinfo" id="T3:U378"><span class="mxinfo" id="T44:U379"><span class="var type1" id="S3T1U562">otherMakers</span>(<span class="var type1" id="S62T2U563">i</span>)</span>.Position</span> - <span class="mxinfo" id="T3:U382">repmat(<span class="var type1" id="S60T6U567">Xrw_r</span>,1,<span class="var type1" id="S63T2U569">m</span>)</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,145" id="srcline145">145</a></span><span class="line">                <span class="mxinfo" id="T6:U385"><span class="mxinfo" id="T6:U386"><span class="var type1" id="S20T47U573">trackedMakerPosition</span>(:,<span class="var type1" id="S62T2U575">i</span>)</span> = <span class="mxinfo" id="T6:U389"><span class="mxinfo" id="T6:U390"><span class="var type1" id="S20T47U578">trackedMakerPosition</span>(:,<span class="var type1" id="S62T2U580">i</span>)</span> - <span class="var type1" id="S60T6U581">Xrw_r</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,146" id="srcline146">146</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,147" id="srcline147">147</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,148" id="srcline148">148</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,149" id="srcline149">149</a></span><span class="line">    <span class="comment">%% 求视觉速度</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,150" id="srcline150">150</a></span><span class="line">    <span class="mxinfo" id="T41:U394">[ <span class="var type1" id="S65T70U585">trackedMarkerVelocity_k</span>,<span class="var type1" id="S44T2U586">k_calV</span> ] = <span class="fcn" id="F293N9:B588">CalVelocity</span><span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,151" id="srcline151">151</a></span><span class="line"><span class="mxinfo" id="T41:U394">        ( <span class="var type1" id="S20T47U589">trackedMakerPosition</span>,<span class="var type1" id="S42T2U590">k</span>,<span class="var type1" id="S6T2U591">visionFre</span>,<span class="mxinfo" id="T2:U400"><span class="var type1" id="S14T40U593">INSVNSCalibSet</span>.dT_CalV_Calib</span>,<span class="mxinfo" id="T2:U402"><span class="var type1" id="S14T40U596">INSVNSCalibSet</span>.MinXYVNorm_CalAngle</span> )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,152" id="srcline152">152</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T14:U404"><span class="var type1" id="S44T2U601">k_calV</span>&gt;<span class="mxinfo" id="T2:U406">0</span></span> </span></span>
<span class="srcline"><span class="lineno"><a href="56,153" id="srcline153">153</a></span><span class="line">        <span class="mxinfo" id="T55:U407"><span class="mxinfo" id="T55:U408"><span class="var type1" id="S22T54U606">trackedMarkerVelocity</span>(:,<span class="var type1" id="S44T2U608">k_calV</span>)</span> = <span class="var type1" id="S65T70U609">trackedMarkerVelocity_k</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,154" id="srcline154">154</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo" id="T14:U412"><span class="var type1" id="S26T2U613">IsCalibDataEnough</span>==<span class="mxinfo" id="T2:U414">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,155" id="srcline155">155</a></span><span class="line">        <span class="comment">%% 搜索可用于标定的数据</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,156" id="srcline156">156</a></span><span class="line">    <span class="comment">%         dbstop in SearchCalibData</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,157" id="srcline157">157</a></span><span class="line">            <span class="mxinfo" id="T2:U415"><span class="var type1" id="S66T2U617">Calib_N_Last</span> = <span class="var type1" id="S25T2U618">Calib_N_New</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,158" id="srcline158">158</a></span><span class="line">            <span class="mxinfo" id="T53:U418">[ <span class="var type1" id="S24T53U622">INSVNSCalib_VS_k</span>,<span class="var type1" id="S25T2U623">Calib_N_New</span>,<span class="var type1" id="S26T2U624">IsCalibDataEnough</span>,<span class="var type1" id="S67T71U625">dX_Vision</span> ] = <span class="fcn" id="F314N35:B627">SearchCalibData</span><span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,159" id="srcline159">159</a></span><span class="line"><span class="mxinfo" id="T53:U418">                ( <span class="var type1" id="S24T53U628">INSVNSCalib_VS_k</span>,<span class="var type1" id="S66T2U629">Calib_N_Last</span>,<span class="var type1" id="S22T54U630">trackedMarkerVelocity</span>,<span class="var type1" id="S20T47U631">trackedMakerPosition</span>,<span class="var type1" id="S44T2U632">k_calV</span>,<span class="var type1" id="S14T40U633">INSVNSCalibSet</span> )</span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,160" id="srcline160">160</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo" id="T14:U429"><span class="var type1" id="S26T2U637">IsCalibDataEnough</span>==<span class="mxinfo" id="T2:U431">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,161" id="srcline161">161</a></span><span class="line">                <span class="mxinfo" id="T43:U432"><span class="extrinsicFcn" id="F555N44:B641">fprintf</span>( <span class="mxinfo" id="T99:U433"><span class="string">'第一个用于坐标系映射计算的点OK，time = %0.1f sec \n'</span></span>,<span class="mxinfo" id="T2:U434"><span class="var type1" id="S42T2U644">k</span>/<span class="var type1" id="S6T2U645">visionFre</span></span> )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,162" id="srcline162">162</a></span><span class="line">                <span class="mxinfo" id="T24:U437"><span class="var type1" id="S69T24U648">Crw</span> = <span class="mxinfo" id="T24:U439"><span class="fcn" id="F523N26:B650">INSVNSCalib</span>( <span class="var type1" id="S24T53U651">INSVNSCalib_VS_k</span>,<span class="var type1" id="S25T2U652">Calib_N_New</span>,<span class="var type1" id="S67T71U653">dX_Vision</span>,<span class="var type1" id="S4T12U654">InertialPosition</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,163" id="srcline163">163</a></span><span class="line">                 <span class="mxinfo" id="T1:U444"><span class="var type1" id="S3T1U657">otherMakers</span> = <span class="mxinfo" id="T1:U446"><span class="fcn" id="F524N16:B659">CompensateSecond</span>( <span class="var type1" id="S3T1U660">otherMakers</span>,<span class="var type1" id="S69T24U661">Crw</span>  )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,164" id="srcline164">164</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,165" id="srcline165">165</a></span><span class="line">        <span class="keyword">end</span>        </span></span>
<span class="srcline"><span class="lineno"><a href="56,166" id="srcline166">166</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,167" id="srcline167">167</a></span><span class="line">    <span class="comment">%% 转成惯性马克点的时序</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,168" id="srcline168">168</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="56,169" id="srcline169">169</a></span><span class="line">    <span class="mxinfo" id="T6:U449"><span class="mxinfo" id="T6:U450"><span class="var type1" id="S19T12U665">trackedMakerPosition_InertialTime</span>(:,<span class="var type1" id="S49T4U667">inertial_k</span>)</span> = <span class="mxinfo" id="T6:U453"><span class="var type1" id="S20T47U669">trackedMakerPosition</span>(:,<span class="var type1" id="S42T2U671">k</span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,170" id="srcline170">170</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="56,171" id="srcline171">171</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T14:U456"><span class="mxinfo" id="T2:U457">mod(<span class="var type1" id="S42T2U677">k</span>,<span class="mxinfo" id="T2:U459">fix(<span class="var type1" id="S27T2U681">MarkerTN</span>/10)</span>)</span>==<span class="mxinfo" id="T2:U461">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,172" id="srcline172">172</a></span><span class="line">        <span class="mxinfo" id="T43:U462"><span class="extrinsicFcn" id="F565N47:B686">waitbar</span>(<span class="mxinfo" id="T2:U463"><span class="var type1" id="S42T2U688">k</span>/<span class="mxinfo" id="T2:U465"><span class="var type1" id="S27T2U689">MarkerTN</span></span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,173" id="srcline173">173</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,174" id="srcline174">174</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,175" id="srcline175">175</a></span><span class="line"> <span class="mxinfo" id="T43:U467"><span class="extrinsicFcn" id="F566N39:B692">close</span>(<span class="var type1" id="S46T43U693">wh</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,176" id="srcline176">176</a></span><span class="line"> <span class="comment">%% Output</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,177" id="srcline177">177</a></span><span class="line"><span class="mxinfo" id="T12:U469"><span class="var type1" id="S2T12U696">trackedMakerPosition_InertialTime_Out</span> = <span class="var type1" id="S19T12U697">trackedMakerPosition_InertialTime</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,178" id="srcline178">178</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="56,179" id="srcline179">179</a></span><span class="line"> <span class="comment">%% result analyse</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,180" id="srcline180">180</a></span><span class="line"><span class="comment">% if IsOnLine==0</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,181" id="srcline181">181</a></span><span class="line"><span class="comment">%      trackedMaker.trackedMakerPosition = trackedMakerPosition ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,182" id="srcline182">182</a></span><span class="line"><span class="comment">% %      trackedMaker.time = otherMakersTime ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,183" id="srcline183">183</a></span><span class="line"><span class="comment">%      trackedMaker.MarkerSet = otherMakers(1).MarkerSet ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,184" id="srcline184">184</a></span><span class="line"><span class="comment">%      N = length(trackedMakerPosition) ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,185" id="srcline185">185</a></span><span class="line"><span class="comment">%     for k=1:N</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,186" id="srcline186">186</a></span><span class="line"><span class="comment">%         otherMakers(k).trackedMakerPosition = trackedMakerPosition(:,k) ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,187" id="srcline187">187</a></span><span class="line"><span class="comment">%     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,188" id="srcline188">188</a></span><span class="line"><span class="comment">%     for k=1:N</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,189" id="srcline189">189</a></span><span class="line"><span class="comment">%         i = N-k+1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,190" id="srcline190">190</a></span><span class="line"><span class="comment">%         if ~isnan(trackedMakerPosition(1,i))</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,191" id="srcline191">191</a></span><span class="line"><span class="comment">%             trackedMaker.LastMakerPosition = trackedMakerPosition(:,i);</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,192" id="srcline192">192</a></span><span class="line"><span class="comment">%             trackedMaker.LastMakerTime = otherMakers(i).time ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,193" id="srcline193">193</a></span><span class="line"><span class="comment">%             break;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,194" id="srcline194">194</a></span><span class="line"><span class="comment">%         end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,195" id="srcline195">195</a></span><span class="line"><span class="comment">%     end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,196" id="srcline196">196</a></span><span class="line"><span class="comment">%     </span></span></span>
<span class="srcline"><span class="lineno"><a href="56,197" id="srcline197">197</a></span><span class="line"><span class="comment">%     DrawTracedINSVNS( trackedMaker,InertialPosition,trackedMarkerVelocity,InertialVelocity,INSVNSCalib_VS_k,INSVNSCalibSet ) ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,198" id="srcline198">198</a></span><span class="line"><span class="comment">%       </span></span></span>
<span class="srcline"><span class="lineno"><a href="56,199" id="srcline199">199</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,200" id="srcline200">200</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,201" id="srcline201">201</a></span><span class="line"><span class="keyword">return</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,202" id="srcline202">202</a></span><span class="line"><span class="comment">%  </span></span></span>
<span class="srcline"><span class="lineno"><a href="56,203" id="srcline203">203</a></span><span class="line"><span class="comment">% figure('name','trackFlag')</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,204" id="srcline204">204</a></span><span class="line"><span class="comment">% plot(TrackFlag,'.')</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,205" id="srcline205">205</a></span><span class="line"><span class="comment">% % plot(otherMakersTime,TrackFlag,'.')</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,206" id="srcline206">206</a></span><span class="line"><span class="comment">% % xlabel('time sec')</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,207" id="srcline207">207</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="56,208" id="srcline208">208</a></span><span class="line"><span class="comment">% figure('name','dPi_ConJudge')</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,209" id="srcline209">209</a></span><span class="line"><span class="comment">% plot(otherMakersTime,dPi_ConJudge)</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,210" id="srcline210">210</a></span><span class="line"><span class="comment">% temp = makerTrackThreshold.MaxContinuesDisplacement ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,211" id="srcline211">211</a></span><span class="line"><span class="comment">% line( [otherMakersTime(1) otherMakersTime(MarkerTN)],[temp temp],'color','r' )</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,212" id="srcline212">212</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="56,213" id="srcline213">213</a></span><span class="line"><span class="comment">% xlabel('time sec')</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,214" id="srcline214">214</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="56,215" id="srcline215">215</a></span><span class="line"><span class="comment">% figure('name','INSVNSMarkHC_Min')</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,216" id="srcline216">216</a></span><span class="line"><span class="comment">% plot(otherMakersTime,INSVNSMarkHC_Min)</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,217" id="srcline217">217</a></span><span class="line"><span class="comment">% temp = makerTrackThreshold.MaxMarkHighChange ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,218" id="srcline218">218</a></span><span class="line"><span class="comment">% line( [otherMakersTime(1) otherMakersTime(MarkerTN)],[temp temp],'color','r' )</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,219" id="srcline219">219</a></span><span class="line"><span class="comment">% temp = -makerTrackThreshold.MaxMarkHighChange ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,220" id="srcline220">220</a></span><span class="line"><span class="comment">% line( [otherMakersTime(1) otherMakersTime(MarkerTN)],[temp temp],'color','r' )</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,221" id="srcline221">221</a></span><span class="line"><span class="comment">% xlabel('time sec')</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,222" id="srcline222">222</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="56,223" id="srcline223">223</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="56,224" id="srcline224">224</a></span><span class="line"><span class="comment">% figure('name','dPError_dT_xy')</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,225" id="srcline225">225</a></span><span class="line"><span class="comment">% plot(otherMakersTime,dPError_dT_xy)</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,226" id="srcline226">226</a></span><span class="line"><span class="comment">% temp = makerTrackThreshold.PositionErrorBear_dT ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,227" id="srcline227">227</a></span><span class="line"><span class="comment">% line( [otherMakersTime(1) otherMakersTime(MarkerTN)],[temp temp],'color','r' )</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,228" id="srcline228">228</a></span><span class="line"><span class="comment">% xlabel('time sec')</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,229" id="srcline229">229</a></span><span class="line"><span class="comment">% legend( 'dPError\_dT\_xy','PositionErrorBear\_dT' )</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,230" id="srcline230">230</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="56,231" id="srcline231">231</a></span><span class="line"><span class="comment">% figure('name','dPError_dT_z')</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,232" id="srcline232">232</a></span><span class="line"><span class="comment">% plot(otherMakersTime,dPError_dT_z)</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,233" id="srcline233">233</a></span><span class="line"><span class="comment">% temp = makerTrackThreshold.PositionErrorBear_dT ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,234" id="srcline234">234</a></span><span class="line"><span class="comment">% line( [otherMakersTime(1) otherMakersTime(MarkerTN)],[temp temp],'color','r' )</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,235" id="srcline235">235</a></span><span class="line"><span class="comment">% xlabel('time sec')</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,236" id="srcline236">236</a></span><span class="line"><span class="comment">% legend( 'dPError\_dT\_z','PositionErrorBear\_dT' )</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,237" id="srcline237">237</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="56,238" id="srcline238">238</a></span><span class="line"><span class="comment">% figure('name','dP_Inertial_xyNorm')</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,239" id="srcline239">239</a></span><span class="line"><span class="comment">% plot(otherMakersTime,dP_Inertial_xyNorm)</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,240" id="srcline240">240</a></span><span class="line"><span class="comment">% temp = makerTrackThreshold.MaxStaticDisp_dT ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,241" id="srcline241">241</a></span><span class="line"><span class="comment">% line( [otherMakersTime(1) otherMakersTime(MarkerTN)],[temp temp],'color','r' )</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,242" id="srcline242">242</a></span><span class="line"><span class="comment">% xlabel('time sec')</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,243" id="srcline243">243</a></span><span class="line"><span class="comment">% legend( 'dPError\_dT','MaxStaticDisp\_dT' )</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,244" id="srcline244">244</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="56,245" id="srcline245">245</a></span><span class="line"><span class="comment">% figure('name','angleErr_dT_Min')</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,246" id="srcline246">246</a></span><span class="line"><span class="comment">% plot(otherMakersTime,angleErr_dT_Min*180/pi)</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,247" id="srcline247">247</a></span><span class="line"><span class="comment">% temp = makerTrackThreshold.Max_dPAngle_dS*180/pi ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,248" id="srcline248">248</a></span><span class="line"><span class="comment">% line( [otherMakersTime(1) otherMakersTime(MarkerTN)],[temp temp],'color','r' )</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,249" id="srcline249">249</a></span><span class="line"><span class="comment">% xlabel('time sec')</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,250" id="srcline250">250</a></span><span class="line"><span class="comment">% legend( 'dPError\_dT','MaxStaticDisp\_dT' )</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,251" id="srcline251">251</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="56,252" id="srcline252">252</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="56,253" id="srcline253">253</a></span><span class="line"><span class="comment">% figure('name','dPError_dS_xyNorm')</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,254" id="srcline254">254</a></span><span class="line"><span class="comment">% plot(otherMakersTime,dPError_dS_xyNorm)</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,255" id="srcline255">255</a></span><span class="line"><span class="comment">% temp = makerTrackThreshold.MaxPositionError_dS ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,256" id="srcline256">256</a></span><span class="line"><span class="comment">% line( [otherMakersTime(1) otherMakersTime(MarkerTN)],[temp temp],'color','r' )</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,257" id="srcline257">257</a></span><span class="line"><span class="comment">% xlabel('time sec')</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,258" id="srcline258">258</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="56,259" id="srcline259">259</a></span><span class="line"><span class="comment">% figure('name','angleErr_dS')</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,260" id="srcline260">260</a></span><span class="line"><span class="comment">% plot(otherMakersTime,angleErr_dS*180/pi)</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,261" id="srcline261">261</a></span><span class="line"><span class="comment">% temp = makerTrackThreshold.Max_dPAngle_dS*180/pi ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,262" id="srcline262">262</a></span><span class="line"><span class="comment">% line( [otherMakersTime(1) otherMakersTime(MarkerTN)],[temp temp],'color','r' )</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,263" id="srcline263">263</a></span><span class="line"><span class="comment">% xlabel('time sec')</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,264" id="srcline264">264</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="56,265" id="srcline265">265</a></span><span class="line"><span class="comment">% figure('name','ConTrackedFailed')</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,266" id="srcline266">266</a></span><span class="line"><span class="comment">% plot(ConTrackedFailed)</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,267" id="srcline267">267</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="56,268" id="srcline268">268</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="56,269" id="srcline269">269</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="56,270" id="srcline270">270</a></span><span class="line"><span class="comment">% FailTrackFlagNum = sum( TrackFlag&lt;=0 );</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,271" id="srcline271">271</a></span><span class="line"><span class="comment">% fprintf( 'FailTrackFlagNum=%d ( %0.3f ) \n',FailTrackFlagNum,FailTrackFlagNum/length(TrackFlag) );</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,272" id="srcline272">272</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,273" id="srcline273">273</a></span><span class="line"><span class="comment">%% 阈值参数设置</span></span></span>
</pre>
