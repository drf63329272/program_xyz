<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="56,328" id="srcline328">328</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,329" id="srcline329">329</a></span><span class="line"><span class="comment">%% Judge which is the right maker</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,330" id="srcline330">330</a></span><span class="line"><span class="comment">% 1) 固定运动时间位移判断：只判断位移差长度</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,331" id="srcline331">331</a></span><span class="line"><span class="comment">% 2）固定运动距离位移判断：同时判断位移差长度和方向</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,332" id="srcline332">332</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,333" id="srcline333">333</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S99T73U972">trackedMakerPosition_k_OK</span>,<span class="var type1" id="S100T44U973">otherMakers_k</span>,<span class="var type1" id="S101T2U974">TrackFlag</span>,<span class="var type1" id="S102T52U975">JudgeIndex</span> ] = JudgeMaker<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,334" id="srcline334">334</a></span><span class="line">( <span class="mxinfo" id="T44:U5"><span class="mxinfo" id="T44:U6"><span class="var type1" id="S100T44U978">otherMakers_k</span></span></span>,<span class="var type1" id="S103T68U979">otherMakers_k_last</span>,<span class="var type1" id="S104T2U980">k_vision</span>,<span class="var type1" id="S105T4U981">inertial_k</span>,<span class="var type1" id="S106T47U982">trackedMakerPosition</span>,<span class="var type1" id="S107T12U983">InertialPosition</span>,<span class="var type1" id="S108T4U984">inertial_dT_k_last</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,335" id="srcline335">335</a></span><span class="line">            <span class="var type1" id="S109T38U985">makerTrackThreshold</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="56,336" id="srcline336">336</a></span><span class="line">coder.extrinsic(<span class="string">'fprintf'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="56,337" id="srcline337">337</a></span><span class="line"><span class="keyword">global</span>  <span class="var type0" id="S111T0U993">visionFre</span>   <span class="var type0" id="S112T0U994">IsGetFirstMarker</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,338" id="srcline338">338</a></span><span class="line"><span class="keyword">global</span> <span class="var type0" id="S113T0U996">InertialData_visual_k</span>  <span class="var type0" id="S114T0U997">VisionData_inertial_k</span> <span class="var type0" id="S115T0U998">CalStartIN</span>  <span class="var type0" id="S116T0U999">CalEndIN</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,339" id="srcline339">339</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,340" id="srcline340">340</a></span><span class="line"><span class="mxinfo" id="T2:U15"><span class="var type1" id="S117T2U1002">vision_dT_k_last</span> = <span class="mxinfo" id="T2:U17"><span class="var type1" id="S113T9U1004">InertialData_visual_k</span>(<span class="var type1" id="S108T4U1005">inertial_dT_k_last</span>)</span></span>; <span class="comment">% 初始值</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,341" id="srcline341">341</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,342" id="srcline342">342</a></span><span class="line"><span class="mxinfo" id="T2:U20"><span class="var type1" id="S118T2U1008">moveDistance</span> = <span class="mxinfo" id="T2:U22"><span class="var type1" id="S109T38U1010">makerTrackThreshold</span>.moveDistance</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,343" id="srcline343">343</a></span><span class="line"><span class="mxinfo" id="T2:U24"><span class="mxinfo" id="T2:U25"><span class="var type1" id="S102T52U1015">JudgeIndex</span>.dPi_ConJudge</span> = <span class="mxinfo" id="T2:U27">NaN</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,344" id="srcline344">344</a></span><span class="line"><span class="mxinfo" id="T2:U28"><span class="mxinfo" id="T2:U29"><span class="var type1" id="S102T52U1022">JudgeIndex</span>.dPError_dT_xy</span> = <span class="mxinfo" id="T2:U31">NaN</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,345" id="srcline345">345</a></span><span class="line"><span class="mxinfo" id="T2:U32"><span class="mxinfo" id="T2:U33"><span class="var type1" id="S102T52U1029">JudgeIndex</span>.dPError_dT_z</span> = <span class="mxinfo" id="T2:U35">NaN</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,346" id="srcline346">346</a></span><span class="line"><span class="mxinfo" id="T2:U36"><span class="mxinfo" id="T2:U37"><span class="var type1" id="S102T52U1036">JudgeIndex</span>.dPError_dS_xyNorm</span> = <span class="mxinfo" id="T2:U39">NaN</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,347" id="srcline347">347</a></span><span class="line"><span class="mxinfo" id="T2:U40"><span class="mxinfo" id="T2:U41"><span class="var type1" id="S102T52U1043">JudgeIndex</span>.dP_Inertial_xyNorm</span> = <span class="mxinfo" id="T2:U43">NaN</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,348" id="srcline348">348</a></span><span class="line"><span class="mxinfo" id="T2:U44"><span class="mxinfo" id="T2:U45"><span class="var type1" id="S102T52U1050">JudgeIndex</span>.angleErr_dS</span> = <span class="mxinfo" id="T2:U47">NaN</span></span>  ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,349" id="srcline349">349</a></span><span class="line"><span class="mxinfo" id="T2:U48"><span class="mxinfo" id="T2:U49"><span class="var type1" id="S102T52U1057">JudgeIndex</span>.angleErr_dT_Min</span> = <span class="mxinfo" id="T2:U51">NaN</span></span>  ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,350" id="srcline350">350</a></span><span class="line"><span class="mxinfo" id="T2:U52"><span class="mxinfo" id="T2:U53"><span class="var type1" id="S102T52U1064">JudgeIndex</span>.INSVNSMarkHC_Min</span> = <span class="mxinfo" id="T2:U55">NaN</span></span>  ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,351" id="srcline351">351</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,352" id="srcline352">352</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,353" id="srcline353">353</a></span><span class="line"><span class="mxinfo" id="T73:U56"><span class="var type1" id="S99T73U1070">trackedMakerPosition_k_OK</span> = <span class="mxinfo" id="T2:U58">NaN</span></span>;  <span class="comment">% 跟踪马克点失败置 NaN</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,354" id="srcline354">354</a></span><span class="line"><span class="mxinfo" id="T2:U59"><span class="var type1" id="S101T2U1075">TrackFlag</span> = <span class="mxinfo" id="T2:U61">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,355" id="srcline355">355</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="56,356" id="srcline356">356</a></span><span class="line"><span class="comment">% M = otherMakers_k.otherMakersN ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,357" id="srcline357">357</a></span><span class="line"><span class="mxinfo" id="T3:U62"><span class="var type1" id="S120T3U1079">otherMakersPosition_k</span> = <span class="mxinfo" id="T3:U64"><span class="var type1" id="S100T44U1081">otherMakers_k</span>.Position</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,358" id="srcline358">358</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,359" id="srcline359">359</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,360" id="srcline360">360</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T14:U66">isnan(<span class="mxinfo" id="T2:U67"><span class="var type1" id="S120T3U1088">otherMakersPosition_k</span>(<span class="mxinfo" id="T2:U69">1</span>)</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,361" id="srcline361">361</a></span><span class="line">    <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,362" id="srcline362">362</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,363" id="srcline363">363</a></span><span class="line"><span class="comment">%% 高度判断</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,364" id="srcline364">364</a></span><span class="line"><span class="mxinfo" id="T44:U70">[ <span class="var type1" id="S100T44U1094">otherMakers_k</span>,<span class="mxinfo" id="T2:U72"><span class="var type1" id="S99T2U1095">trackedMakerPosition_k_OK</span></span>,<span class="var type1" id="S101T2U1096">TrackFlag</span>,<span class="var type1" id="S122T2U1097">INSVNSMarkHC_Min</span> ] = <span class="fcn" id="F225N23:B1099">Track_High_Judge</span><span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,365" id="srcline365">365</a></span><span class="line"><span class="mxinfo" id="T44:U70">    ( <span class="var type1" id="S100T44U1100">otherMakers_k</span>,<span class="var type1" id="S105T4U1101">inertial_k</span>,<span class="var type1" id="S107T12U1102">InertialPosition</span>,<span class="var type1" id="S109T38U1103">makerTrackThreshold</span> )</span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,366" id="srcline366">366</a></span><span class="line"><span class="mxinfo" id="T2:U80"><span class="mxinfo" id="T2:U81"><span class="var type1" id="S102T52U1107">JudgeIndex</span>.INSVNSMarkHC_Min</span> = <span class="var type1" id="S122T2U1109">INSVNSMarkHC_Min</span></span>  ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,367" id="srcline367">367</a></span><span class="line"><span class="mxinfo" id="T4:U84"><span class="var type1" id="S124T4U1112">M</span> = <span class="mxinfo" id="T4:U86"><span class="var type1" id="S100T44U1114">otherMakers_k</span>.otherMakersN</span></span> ;  <span class="comment">% 点的个数可能被减少了</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,368" id="srcline368">368</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T14:U88"><span class="var type1" id="S101T2U1119">TrackFlag</span> == <span class="mxinfo" id="T2:U90">-<span class="mxinfo" id="T2:U91">1</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,369" id="srcline369">369</a></span><span class="line">    <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,370" id="srcline370">370</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,371" id="srcline371">371</a></span><span class="line"><span class="comment">%% 马克点连续性判断</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,372" id="srcline372">372</a></span><span class="line"><span class="mxinfo" id="T44:U92">[ <span class="var type1" id="S100T44U1126">otherMakers_k</span>,<span class="var type1" id="S125T2U1127">dPi_ConJudge</span> ] = <span class="fcn" id="F248N17:B1129">ContinuesJudge</span>( <span class="var type1" id="S100T44U1130">otherMakers_k</span>,<span class="var type1" id="S103T68U1131">otherMakers_k_last</span>,<span class="var type1" id="S106T47U1132">trackedMakerPosition</span>,<span class="var type1" id="S104T2U1133">k_vision</span>,<span class="var type1" id="S109T38U1134">makerTrackThreshold</span> )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,373" id="srcline373">373</a></span><span class="line"><span class="mxinfo" id="T2:U100"><span class="mxinfo" id="T2:U101"><span class="var type1" id="S102T52U1138">JudgeIndex</span>.dPi_ConJudge</span> = <span class="var type1" id="S125T2U1140">dPi_ConJudge</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,374" id="srcline374">374</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,375" id="srcline375">375</a></span><span class="line"><span class="comment">%% dT 时间段的位移差：只考虑位移矢量大小</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,376" id="srcline376">376</a></span><span class="line"><span class="comment">% 如果 vision_dT_k_last 没跟踪成功，把时间往前推直到找到跟踪成功的点。但是不能往前推超过 Max_dT 时间。搜索了</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,377" id="srcline377">377</a></span><span class="line"><span class="comment">% Max_dT时间还没有找到的话，</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,378" id="srcline378">378</a></span><span class="line"><span class="keyword">while</span> <span class="mxinfo" id="T14:U104"><span class="var type1" id="S117T2U1144">vision_dT_k_last</span>&gt;<span class="mxinfo" id="T2:U106">1</span></span> &amp;&amp; <span class="mxinfo" id="T14:U107">isnan( <span class="mxinfo" id="T2:U108"><span class="var type1" id="S106T47U1149">trackedMakerPosition</span>(<span class="mxinfo" id="T2:U110">1</span>,<span class="var type1" id="S117T2U1151">vision_dT_k_last</span>)</span> )</span> <span class="comment">% trackedMakerPosition(1) 必须已知（不为nan）</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,379" id="srcline379">379</a></span><span class="line">    <span class="mxinfo" id="T2:U112"><span class="var type1" id="S117T2U1154">vision_dT_k_last</span> = <span class="mxinfo" id="T2:U114"><span class="var type1" id="S117T2U1156">vision_dT_k_last</span>-<span class="mxinfo" id="T2:U116">1</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,380" id="srcline380">380</a></span><span class="line">    <span class="mxinfo" id="T4:U117"><span class="var type1" id="S108T4U1160">inertial_dT_k_last</span> = <span class="mxinfo" id="T4:U119">int32(<span class="mxinfo" id="T2:U120"><span class="var type1" id="S114T36U1164">VisionData_inertial_k</span>(<span class="var type1" id="S117T2U1165">vision_dT_k_last</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,381" id="srcline381">381</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T14:U123"><span class="mxinfo" id="T2:U124">(<span class="mxinfo" id="T2:U125"><span class="var type1" id="S104T2U1172">k_vision</span>-<span class="var type1" id="S117T2U1173">vision_dT_k_last</span></span>)/<span class="var type1" id="S111T2U1174">visionFre</span></span> &gt; <span class="mxinfo" id="T2:U129"><span class="var type1" id="S109T38U1176">makerTrackThreshold</span>.MaxMoveTime</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,382" id="srcline382">382</a></span><span class="line"><span class="comment">%         fprintf( '放弃搜索，作为新点重新搜索  k_vision = %d , vision_dT_k_last = %d \n',k_vision,vision_dT_k_last );</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,383" id="srcline383">383</a></span><span class="line">        <span class="keyword">break</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,384" id="srcline384">384</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,385" id="srcline385">385</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,386" id="srcline386">386</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T14:U131">isnan( <span class="mxinfo" id="T2:U132"><span class="var type1" id="S106T47U1184">trackedMakerPosition</span>(<span class="mxinfo" id="T2:U134">1</span>,<span class="var type1" id="S117T2U1186">vision_dT_k_last</span>)</span> )</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,387" id="srcline387">387</a></span><span class="line">    <span class="comment">%% 寻找第一个点（第一个点：怎么都找不到之前跟踪成功的点）</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,388" id="srcline388">388</a></span><span class="line">    <span class="comment">% 用其他连续点计算，分析当前马克点中每一个连续点，如果某个连续点的 dT 判断通过，则认为这是第一个点</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,389" id="srcline389">389</a></span><span class="line">    <span class="mxinfo" id="T2:U136"><span class="var type1" id="S128T2U1189">IsSearchingFirst</span> = <span class="mxinfo" id="T2:U138">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,390" id="srcline390">390</a></span><span class="line">    <span class="mxinfo" id="T4:U139"><span class="keyword">for</span> <span class="var type1" id="S129T4U1193">i</span>=<span class="mxinfo" id="T4:U141">1</span>:<span class="var type1" id="S124T4U1196">M</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,391" id="srcline391">391</a></span><span class="line"><span class="mxinfo" id="T4:U139">        <span class="keyword">if</span>  <span class="mxinfo" id="T14:U143"><span class="mxinfo" id="T2:U144"><span class="mxinfo" id="T7:U145"><span class="var type1" id="S100T44U1203">otherMakers_k</span>.ContinuesFlag</span>(<span class="var type1" id="S129T4U1205">i</span>)</span> == <span class="mxinfo" id="T2:U148">2</span></span> || <span class="mxinfo" id="T14:U149"><span class="mxinfo" id="T2:U150"><span class="mxinfo" id="T7:U151"><span class="var type1" id="S100T44U1210">otherMakers_k</span>.ContinuesFlag</span>(<span class="var type1" id="S129T4U1212">i</span>)</span> == <span class="mxinfo" id="T2:U154">1</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,392" id="srcline392">392</a></span><span class="line"><span class="mxinfo" id="T4:U139">            <span class="mxinfo" id="T2:U155"><span class="var type1" id="S128T2U1216">IsSearchingFirst</span> = <span class="mxinfo" id="T2:U157">1</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,393" id="srcline393">393</a></span><span class="line"><span class="mxinfo" id="T4:U139">            </span><span class="comment"><span class="mxinfo" id="T4:U139">% 第一个马克点搜索的关键：以当前马克点对应的连续点假设为跟踪成功点</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,394" id="srcline394">394</a></span><span class="line"><span class="mxinfo" id="T4:U139">            <span class="mxinfo" id="T6:U158"><span class="var type1" id="S130T6U1220">trackedMakerPosition_last_k_dT</span> = <span class="mxinfo" id="T6:U160"><span class="mxinfo" id="T3:U161"><span class="var type1" id="S100T44U1223">otherMakers_k</span>.ContinuesLastPosition</span>(:,<span class="var type1" id="S129T4U1226">i</span>)</span></span> ;</span> </span></span>
<span class="srcline"><span class="lineno"><a href="56,395" id="srcline395">395</a></span><span class="line">     </span></span>
<span class="srcline"><span class="lineno"><a href="56,396" id="srcline396">396</a></span><span class="line"><span class="mxinfo" id="T4:U139">            <span class="mxinfo" id="T41:U164">[ <span class="var type1" id="S99T73U1230">trackedMakerPosition_k_OK</span>,<span class="var type1" id="S101T2U1231">TrackFlag</span>,<span class="var type1" id="S131T2U1232">min_dT_k</span>,<span class="var type1" id="S132T2U1233">dPError_dT_xy</span>,<span class="var type1" id="S133T2U1234">dPError_dT_z</span>,<span class="var type1" id="S134T2U1235">dP_Inertial_xyNorm</span>,<span class="var type1" id="S135T2U1236">angleErr_dT_Min</span> ] = <span class="fcn" id="F266N25:B1238">Track_dT_Judge</span><span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,397" id="srcline397">397</a></span><span class="line"><span class="mxinfo" id="T4:U139"><span class="mxinfo" id="T41:U164">                ( <span class="var type1" id="S100T44U1239">otherMakers_k</span>,<span class="var type1" id="S107T12U1240">InertialPosition</span>,<span class="var type1" id="S105T4U1241">inertial_k</span>,<span class="var type1" id="S108T4U1242">inertial_dT_k_last</span>,<span class="var type1" id="S130T6U1243">trackedMakerPosition_last_k_dT</span>,<span class="var type1" id="S109T38U1244">makerTrackThreshold</span> )</span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,398" id="srcline398">398</a></span><span class="line"><span class="mxinfo" id="T4:U139">            <span class="mxinfo" id="T2:U178"><span class="mxinfo" id="T2:U179"><span class="var type1" id="S102T52U1248">JudgeIndex</span>.dPError_dT_xy</span> = <span class="var type1" id="S132T2U1250">dPError_dT_xy</span></span> ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,399" id="srcline399">399</a></span><span class="line"><span class="mxinfo" id="T4:U139">            <span class="mxinfo" id="T2:U182"><span class="mxinfo" id="T2:U183"><span class="var type1" id="S102T52U1254">JudgeIndex</span>.dPError_dT_z</span> = <span class="var type1" id="S133T2U1256">dPError_dT_z</span></span> ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,400" id="srcline400">400</a></span><span class="line"><span class="mxinfo" id="T4:U139">            <span class="mxinfo" id="T2:U186"><span class="mxinfo" id="T2:U187"><span class="var type1" id="S102T52U1260">JudgeIndex</span>.dP_Inertial_xyNorm</span> = <span class="var type1" id="S134T2U1262">dP_Inertial_xyNorm</span></span> ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,401" id="srcline401">401</a></span><span class="line"><span class="mxinfo" id="T4:U139">            <span class="mxinfo" id="T2:U190"><span class="mxinfo" id="T2:U191"><span class="var type1" id="S102T52U1266">JudgeIndex</span>.angleErr_dT_Min</span> = <span class="var type1" id="S135T2U1268">angleErr_dT_Min</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,402" id="srcline402">402</a></span><span class="line">     </span></span>
<span class="srcline"><span class="lineno"><a href="56,403" id="srcline403">403</a></span><span class="line"><span class="mxinfo" id="T4:U139">            <span class="keyword">if</span> <span class="mxinfo" id="T14:U194">~<span class="mxinfo" id="T14:U195">isnan(<span class="mxinfo" id="T2:U196"><span class="var type1" id="S99T73U1276">trackedMakerPosition_k_OK</span>(<span class="mxinfo" id="T2:U198">1</span>)</span>)</span></span> &amp;&amp; <span class="mxinfo" id="T14:U199"><span class="var type1" id="S112T2U1279">IsGetFirstMarker</span> == <span class="mxinfo" id="T2:U201">0</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,404" id="srcline404">404</a></span><span class="line"><span class="mxinfo" id="T4:U139">                <span class="mxinfo" id="T2:U202"><span class="var type1" id="S112T2U1283">IsGetFirstMarker</span> = <span class="mxinfo" id="T2:U204">1</span></span> ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,405" id="srcline405">405</a></span><span class="line"><span class="mxinfo" id="T4:U139">                <span class="mxinfo" id="T43:U205"><span class="extrinsicFcn" id="F539N44:B1287">fprintf</span>( <span class="mxinfo" id="T89:U206"><span class="string">'第一个点搜素成功 time = %0.1f sec, TrackFlag(%d) = %0.1f \n'</span></span>,<span class="mxinfo" id="T2:U207"><span class="var type1" id="S104T2U1290">k_vision</span>/<span class="var type1" id="S111T2U1291">visionFre</span></span>,<span class="var type1" id="S104T2U1292">k_vision</span>,<span class="var type1" id="S101T2U1293">TrackFlag</span> )</span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,406" id="srcline406">406</a></span><span class="line"><span class="mxinfo" id="T4:U139">                <span class="mxinfo" id="T43:U212"><span class="extrinsicFcn" id="F540N44:B1296">fprintf</span>(<span class="mxinfo" id="T90:U213"><span class="string">' dPError_dT_xy = %0.3f,  dPError_dT_z = %0.3f \n '</span></span>,<span class="var type1" id="S132T2U1298">dPError_dT_xy</span>,<span class="var type1" id="S133T2U1299">dPError_dT_z</span>)</span>;</span> </span></span>
<span class="srcline"><span class="lineno"><a href="56,407" id="srcline407">407</a></span><span class="line"><span class="mxinfo" id="T4:U139">               <span class="keyword">return</span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,408" id="srcline408">408</a></span><span class="line"><span class="mxinfo" id="T4:U139">            <span class="keyword">end</span></span>       </span></span>
<span class="srcline"><span class="lineno"><a href="56,409" id="srcline409">409</a></span><span class="line"><span class="mxinfo" id="T4:U139">        <span class="keyword">end</span></span>        </span></span>
<span class="srcline"><span class="lineno"><a href="56,410" id="srcline410">410</a></span><span class="line"><span class="mxinfo" id="T4:U139">    <span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,411" id="srcline411">411</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T14:U216"><span class="var type1" id="S128T2U1304">IsSearchingFirst</span>==<span class="mxinfo" id="T2:U218">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,412" id="srcline412">412</a></span><span class="line">        <span class="comment">% 既找不到之前跟踪成功的点，又找不到连续的点，继续找</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,413" id="srcline413">413</a></span><span class="line"><span class="comment">%         fprintf('搜索第一个点：等待足够多连续性的点 k_vision = %d \n ',k_vision)</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,414" id="srcline414">414</a></span><span class="line">        <span class="keyword">return</span>; </span></span>
<span class="srcline"><span class="lineno"><a href="56,415" id="srcline415">415</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,416" id="srcline416">416</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,417" id="srcline417">417</a></span><span class="line">    <span class="comment">% 之前有跟踪成功的数据</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,418" id="srcline418">418</a></span><span class="line">    <span class="mxinfo" id="T6:U219"><span class="var type1" id="S130T6U1310">trackedMakerPosition_last_k_dT</span> = <span class="mxinfo" id="T6:U221"><span class="var type1" id="S106T47U1312">trackedMakerPosition</span>(:,<span class="var type1" id="S117T2U1314">vision_dT_k_last</span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,419" id="srcline419">419</a></span><span class="line">    <span class="mxinfo" id="T41:U224">[ <span class="var type1" id="S99T73U1318">trackedMakerPosition_k_OK</span>,<span class="var type1" id="S101T2U1319">TrackFlag</span>,<span class="var type1" id="S131T2U1320">min_dT_k</span>,<span class="var type1" id="S132T2U1321">dPError_dT_xy</span>,<span class="var type1" id="S133T2U1322">dPError_dT_z</span>,<span class="var type1" id="S134T2U1323">dP_Inertial_xyNorm</span>,<span class="var type1" id="S135T2U1324">angleErr_dT_Min</span> ] = <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,420" id="srcline420">420</a></span><span class="line"><span class="mxinfo" id="T41:U224">        <span class="fcn" id="F266N25:B1326">Track_dT_Judge</span>( <span class="var type1" id="S100T44U1327">otherMakers_k</span>,<span class="var type1" id="S107T12U1328">InertialPosition</span>,<span class="var type1" id="S105T4U1329">inertial_k</span>,<span class="var type1" id="S108T4U1330">inertial_dT_k_last</span>,<span class="var type1" id="S130T6U1331">trackedMakerPosition_last_k_dT</span>,<span class="var type1" id="S109T38U1332">makerTrackThreshold</span> )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,421" id="srcline421">421</a></span><span class="line">    <span class="mxinfo" id="T2:U238"><span class="mxinfo" id="T2:U239"><span class="var type1" id="S102T52U1336">JudgeIndex</span>.dPError_dT_xy</span> = <span class="var type1" id="S132T2U1338">dPError_dT_xy</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,422" id="srcline422">422</a></span><span class="line">    <span class="mxinfo" id="T2:U242"><span class="mxinfo" id="T2:U243"><span class="var type1" id="S102T52U1342">JudgeIndex</span>.dPError_dT_z</span> = <span class="var type1" id="S133T2U1344">dPError_dT_z</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,423" id="srcline423">423</a></span><span class="line">    <span class="mxinfo" id="T2:U246"><span class="mxinfo" id="T2:U247"><span class="var type1" id="S102T52U1348">JudgeIndex</span>.dP_Inertial_xyNorm</span> = <span class="var type1" id="S134T2U1350">dP_Inertial_xyNorm</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,424" id="srcline424">424</a></span><span class="line">    <span class="mxinfo" id="T2:U250"><span class="mxinfo" id="T2:U251"><span class="var type1" id="S102T52U1354">JudgeIndex</span>.angleErr_dT_Min</span> = <span class="var type1" id="S135T2U1356">angleErr_dT_Min</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,425" id="srcline425">425</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,426" id="srcline426">426</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T14:U254">~<span class="mxinfo" id="T14:U255">isnan(<span class="mxinfo" id="T2:U256"><span class="var type1" id="S99T73U1363">trackedMakerPosition_k_OK</span>(<span class="mxinfo" id="T2:U258">1</span>)</span>)</span></span>    </span></span>
<span class="srcline"><span class="lineno"><a href="56,427" id="srcline427">427</a></span><span class="line">   <span class="keyword">return</span>;  <span class="comment">% 跟踪OK </span></span></span>
<span class="srcline"><span class="lineno"><a href="56,428" id="srcline428">428</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,429" id="srcline429">429</a></span><span class="line"><span class="mxinfo" id="T6:U259"><span class="var type1" id="S138T6U1368">otherMakersPosition_k_min</span> = <span class="mxinfo" id="T6:U261"><span class="var type1" id="S120T3U1370">otherMakersPosition_k</span>(:,<span class="var type1" id="S131T2U1372">min_dT_k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,430" id="srcline430">430</a></span><span class="line">      </span></span>
<span class="srcline"><span class="lineno"><a href="56,431" id="srcline431">431</a></span><span class="line"><span class="comment">%% dS 位移长度段的位移差：同时考虑位移差大小和方向</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,432" id="srcline432">432</a></span><span class="line"><span class="mxinfo" id="T41:U264">[ <span class="var type1" id="S99T73U1376">trackedMakerPosition_k_OK</span>,<span class="var type1" id="S101T2U1377">TrackFlag</span>,<span class="var type1" id="S139T2U1378">dPError_dS_xyNorm</span>,<span class="var type1" id="S140T2U1379">angleErr_dS</span> ] = <span class="fcn" id="F277N24:B1381">Track_dS_Judge</span><span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,433" id="srcline433">433</a></span><span class="line"><span class="mxinfo" id="T41:U264">    ( <span class="var type1" id="S107T12U1382">InertialPosition</span>,<span class="var type1" id="S105T4U1383">inertial_k</span>,<span class="var type1" id="S106T47U1384">trackedMakerPosition</span>,<span class="var type1" id="S138T6U1385">otherMakersPosition_k_min</span>,<span class="var type1" id="S101T2U1386">TrackFlag</span>,<span class="var type1" id="S109T38U1387">makerTrackThreshold</span> )</span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,434" id="srcline434">434</a></span><span class="line"><span class="mxinfo" id="T2:U275"><span class="mxinfo" id="T2:U276"><span class="var type1" id="S102T52U1391">JudgeIndex</span>.dPError_dS_xyNorm</span> = <span class="var type1" id="S139T2U1393">dPError_dS_xyNorm</span></span>  ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,435" id="srcline435">435</a></span><span class="line"><span class="mxinfo" id="T2:U279"><span class="mxinfo" id="T2:U280"><span class="var type1" id="S102T52U1397">JudgeIndex</span>.angleErr_dS</span> = <span class="var type1" id="S140T2U1399">angleErr_dS</span></span>  ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,436" id="srcline436">436</a></span><span class="line"><span class="comment">%% 高度判定</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,437" id="srcline437">437</a></span><span class="line"><span class="comment">% （1.1）惯性目标关节与视觉目标马克点高度差（INSVNSMarkHC） =  INSVNSMarkL *</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,438" id="srcline438">438</a></span><span class="line"><span class="comment">% cos(thita)。INSVNSMarkL 为常数，在初始时刻刻计算得到。</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,439" id="srcline439">439</a></span><span class="line"><span class="comment">%  INSVNSMarkHC 计算方法：当前高度-直立时的高度</span></span></span>
</pre>
