<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="140,1" id="srcline1"> 1</a></span><span class="line"><span class="comment">%% xyz 2015 儿童节 特供</span></span></span>
<span class="srcline"><span class="lineno"><a href="140,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%% 惯性 视觉 坐标系标定</span></span></span>
<span class="srcline"><span class="lineno"><a href="140,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% 位移差数据： dX_Vision</span></span></span>
<span class="srcline"><span class="lineno"><a href="140,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% r系： 视觉系</span></span></span>
<span class="srcline"><span class="lineno"><a href="140,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">% w系： 惯性系（NED）</span></span></span>
<span class="srcline"><span class="lineno"><a href="140,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">% Crw： 视觉系到关系关系的方向余弦矩阵</span></span></span>
<span class="srcline"><span class="lineno"><a href="140,7" id="srcline7"> 7</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="140,8" id="srcline8"> 8</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T24U3">Crw</span> = INSVNSCalib( <span class="var type1" id="S3T53U6">INSVNSCalib_VS_k</span>,<span class="var type1" id="S4T2U7">Calib_N_New</span>,<span class="var type1" id="S5T71U8">dX_Vision</span>,<span class="var type1" id="S6T12U9">InertialPosition</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="140,9" id="srcline9"> 9</a></span><span class="line">coder.extrinsic(<span class="string">'fprintf'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="140,10" id="srcline10">10</a></span><span class="line">coder.inline(<span class="string">'never'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="140,11" id="srcline11">11</a></span><span class="line"><span class="keyword">global</span> <span class="var type0" id="S8T0U23">VisionData_inertial_k</span></span></span>
<span class="srcline"><span class="lineno"><a href="140,12" id="srcline12">12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="140,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo" id="T2:U6"><span class="var type1" id="S9T2U26">N</span> = <span class="var type1" id="S4T2U27">Calib_N_New</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="140,14" id="srcline14">14</a></span><span class="line"><span class="mxinfo" id="T46:U9"><span class="var type1" id="S10T46U30">dX_Inertial</span> = <span class="mxinfo" id="T46:U11">zeros(<span class="mxinfo" id="T2:U12">3</span>,<span class="var type1" id="S9T2U34">N</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="140,15" id="srcline15">15</a></span><span class="line"><span class="mxinfo" id="T53:U14"><span class="var type1" id="S12T53U37">INSVNSCalib_IS_k</span> = <span class="mxinfo" id="T53:U16">zeros(size(<span class="var type1" id="S3T53U42">INSVNSCalib_VS_k</span>))</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="140,16" id="srcline16">16</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S14T2U45">k</span>=<span class="mxinfo" id="T2:U19">1</span>:<span class="var type1" id="S9T2U48">N</span></span></span>
<span class="srcline"><span class="lineno"><a href="140,17" id="srcline17">17</a></span><span class="line">    <span class="mxinfo" id="T2:U21"><span class="mxinfo" id="T2:U22"><span class="var type1" id="S12T53U52">INSVNSCalib_IS_k</span>(<span class="mxinfo" id="T2:U24">1</span>,<span class="var type1" id="S14T2U54">k</span>)</span> = <span class="mxinfo" id="T2:U26"><span class="var type1" id="S8T36U56">VisionData_inertial_k</span>( <span class="mxinfo" id="T2:U28"><span class="var type1" id="S3T53U58">INSVNSCalib_VS_k</span>(<span class="mxinfo" id="T2:U30">1</span>,<span class="var type1" id="S14T2U60">k</span>)</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="140,18" id="srcline18">18</a></span><span class="line">    <span class="mxinfo" id="T2:U32"><span class="mxinfo" id="T2:U33"><span class="var type1" id="S12T53U64">INSVNSCalib_IS_k</span>(<span class="mxinfo" id="T2:U35">2</span>,<span class="var type1" id="S14T2U66">k</span>)</span> = <span class="mxinfo" id="T2:U37"><span class="var type1" id="S8T36U68">VisionData_inertial_k</span>( <span class="mxinfo" id="T2:U39"><span class="var type1" id="S3T53U70">INSVNSCalib_VS_k</span>(<span class="mxinfo" id="T2:U41">1</span>,<span class="var type1" id="S14T2U72">k</span>)</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="140,19" id="srcline19">19</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="140,20" id="srcline20">20</a></span><span class="line">    <span class="mxinfo" id="T6:U43"><span class="mxinfo" id="T6:U44"><span class="var type1" id="S10T46U76">dX_Inertial</span>(:,<span class="var type1" id="S14T2U78">k</span>)</span> = <span class="mxinfo" id="T6:U47"><span class="mxinfo" id="T6:U48"><span class="var type1" id="S6T12U81">InertialPosition</span>( :, <span class="mxinfo" id="T2:U50"><span class="var type1" id="S12T53U84">INSVNSCalib_IS_k</span>(<span class="mxinfo" id="T2:U52">2</span>,<span class="var type1" id="S14T2U86">k</span>)</span>)</span> - <span class="mxinfo" id="T6:U54"><span class="var type1" id="S6T12U88">InertialPosition</span>( :, <span class="mxinfo" id="T2:U56"><span class="var type1" id="S12T53U91">INSVNSCalib_IS_k</span>(<span class="mxinfo" id="T2:U58">1</span>,<span class="var type1" id="S14T2U93">k</span>)</span>)</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="140,21" id="srcline21">21</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="140,22" id="srcline22">22</a></span><span class="line">    <span class="mxinfo" id="T2:U60"><span class="mxinfo" id="T2:U61"><span class="var type1" id="S10T46U97">dX_Inertial</span>(<span class="mxinfo" id="T2:U63">3</span>,<span class="var type1" id="S14T2U99">k</span>)</span> = <span class="mxinfo" id="T2:U65">0</span></span>; <span class="comment">% 地向给0</span></span></span>
<span class="srcline"><span class="lineno"><a href="140,23" id="srcline23">23</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="140,24" id="srcline24">24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="140,25" id="srcline25">25</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="140,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo" id="T77:U66"><span class="var type1" id="S2T77U103">Crw</span> = <span class="mxinfo" id="T77:U68"><span class="mxinfo" id="T57:U69"><span class="var type1" id="S10T46U106">dX_Inertial</span>(<span class="mxinfo" id="T39:U71"><span class="mxinfo" id="T2:U72">1</span>:<span class="mxinfo" id="T2:U73">2</span></span>,:)</span> / <span class="mxinfo" id="T77:U74"><span class="var type1" id="S5T71U112">dX_Vision</span>(<span class="mxinfo" id="T39:U76"><span class="mxinfo" id="T2:U77">1</span>:<span class="mxinfo" id="T2:U78">2</span></span>,:)</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="140,27" id="srcline27">27</a></span><span class="line"><span class="mxinfo" id="T24:U79"><span class="var type1" id="S2T24U119">Crw</span> = <span class="mxinfo" id="T24:U81">[<span class="mxinfo" id="T95:U82"><span class="var type1" id="S2T77U122">Crw</span> <span class="mxinfo" id="T42:U84">[<span class="mxinfo" id="T2:U85">0</span>;<span class="mxinfo" id="T2:U86">0</span>]</span></span>; <span class="mxinfo" id="T13:U87">[<span class="mxinfo" id="T2:U88">0</span> <span class="mxinfo" id="T2:U89">0</span> <span class="mxinfo" id="T2:U90">1</span>]</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="140,28" id="srcline28">28</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="140,29" id="srcline29">29</a></span><span class="line"><span class="mxinfo" id="T65:U91"><span class="var type1" id="S15T65U136">Attitude</span> = <span class="mxinfo" id="T65:U93"><span class="fcn" id="F522N2:B138">C2Attitude</span>( <span class="var type1" id="S2T24U139">Crw</span>,<span class="string">'NED'</span> )</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="140,30" id="srcline30">30</a></span><span class="line"><span class="mxinfo" id="T43:U95"><span class="extrinsicFcn" id="F563N44:B143">fprintf</span>( <span class="mxinfo" id="T96:U96"><span class="string">'视觉到惯性系的姿态： [ %0.2f  %0.2f  %0.2f ] \n'</span></span>,<span class="mxinfo" id="T2:U97"><span class="mxinfo" id="T2:U98"><span class="mxinfo" id="T2:U99"><span class="var type1" id="S15T65U148">Attitude</span>.yaw</span>*<span class="mxinfo" id="T2:U101">180</span></span>/<span class="mxinfo" id="T2:U102">pi</span></span>,<span class="mxinfo" id="T2:U103"><span class="mxinfo" id="T2:U104"><span class="mxinfo" id="T2:U105"><span class="var type1" id="S15T65U156">Attitude</span>.pitch</span>*<span class="mxinfo" id="T2:U107">180</span></span>/<span class="mxinfo" id="T2:U108">pi</span></span>,<span class="mxinfo" id="T2:U109"><span class="mxinfo" id="T2:U110"><span class="mxinfo" id="T2:U111"><span class="var type1" id="S15T65U164">Attitude</span>.roll</span>*<span class="mxinfo" id="T2:U113">180</span></span>/<span class="mxinfo" id="T2:U114">pi</span></span> )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="140,31" id="srcline31">31</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="140,32" id="srcline32">32</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T14:U115"><span class="mxinfo" id="T2:U116">abs(<span class="mxinfo" id="T2:U117"><span class="var type1" id="S15T65U175">Attitude</span>.yaw</span>)</span> &gt; <span class="mxinfo" id="T2:U119"><span class="mxinfo" id="T2:U120">10*pi</span>/<span class="mxinfo" id="T2:U121">180</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="140,33" id="srcline33">33</a></span><span class="line">   <span class="mxinfo" id="T43:U122"><span class="extrinsicFcn" id="F564N44:B185">fprintf</span>(<span class="mxinfo" id="T97:U123"><span class="string">'视觉到惯性的航向角比较大'</span></span>)</span>; </span></span>
<span class="srcline"><span class="lineno"><a href="140,34" id="srcline34">34</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
</pre>
