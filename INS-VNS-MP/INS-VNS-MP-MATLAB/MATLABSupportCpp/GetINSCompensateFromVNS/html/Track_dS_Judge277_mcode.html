<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="56,488" id="srcline488">488</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,489" id="srcline489">489</a></span><span class="line"><span class="comment">%% 马克点判定 4) 寻找惯性运动 dS 长度(大于 moveDistance)，且马克点跟踪成功的是时刻，判定 dP_Inertial 和 dP_Vision：</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,490" id="srcline490">490</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S172T73U1615">trackedMakerPosition_k_OK</span>,<span class="var type1" id="S173T2U1616">TrackFlag</span>,<span class="var type1" id="S174T2U1617">dPError_dS_Norm</span>,<span class="var type1" id="S175T2U1618">angleErr_dS</span> ] = Track_dS_Judge<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,491" id="srcline491">491</a></span><span class="line">    ( <span class="var type1" id="S176T12U1621">InertialPosition</span>,<span class="var type1" id="S177T4U1622">inertial_k</span>,<span class="var type1" id="S178T47U1623">trackedMakerPosition</span>,<span class="var type1" id="S179T6U1624">otherMakersPosition_k_min</span>,<span class="mxinfo" id="T2:U9"><span class="mxinfo" id="T2:U10"><span class="var type1" id="S173T2U1625">TrackFlag</span></span></span>,<span class="var type1" id="S180T38U1626">makerTrackThreshold</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="56,492" id="srcline492">492</a></span><span class="line"><span class="keyword">global</span> <span class="var type0" id="S181T0U1628">InertialData_visual_k</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,493" id="srcline493">493</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,494" id="srcline494">494</a></span><span class="line"><span class="mxinfo" id="T73:U13"><span class="var type1" id="S172T73U1631">trackedMakerPosition_k_OK</span>=  <span class="mxinfo" id="T2:U15">NaN</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,495" id="srcline495">495</a></span><span class="line"><span class="comment">%% dS 位移长度段的位移差：同时考虑位移差大小和方向</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,496" id="srcline496">496</a></span><span class="line"><span class="comment">% find the point which moved moveDistance</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,497" id="srcline497">497</a></span><span class="line"><span class="mxinfo" id="T2:U16"><span class="var type1" id="S183T2U1636">moveDistance</span> = <span class="mxinfo" id="T2:U18"><span class="var type1" id="S180T38U1638">makerTrackThreshold</span>.moveDistance</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,498" id="srcline498">498</a></span><span class="line"><span class="mxinfo" id="T2:U20"><span class="var type1" id="S184T2U1642">dS_Inertial_last_k</span> = <span class="mxinfo" id="T2:U22"><span class="fcn" id="F276N21:B1644">SearchDistanceK</span>( <span class="var type1" id="S176T12U1645">InertialPosition</span>,<span class="var type1" id="S177T4U1646">inertial_k</span>,<span class="mxinfo" id="T2:U25"><span class="var type1" id="S183T2U1647">moveDistance</span></span>,<span class="var type1" id="S178T47U1648">trackedMakerPosition</span> )</span></span> ;  </span></span>
<span class="srcline"><span class="lineno"><a href="56,499" id="srcline499">499</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T14:U28">isnan(<span class="var type1" id="S184T2U1653">dS_Inertial_last_k</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,500" id="srcline500">500</a></span><span class="line">    <span class="comment">% 找不到运动大于 dS 长度且trackedMakerPosition中跟踪到的点</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,501" id="srcline501">501</a></span><span class="line"><span class="comment">%     fprintf('找不到运动固定长度的点，不进行验证&lt;2&gt;，跟踪失败。\n');</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,502" id="srcline502">502</a></span><span class="line">    <span class="mxinfo" id="T2:U30"><span class="var type1" id="S174T2U1656">dPError_dS_Norm</span> = <span class="mxinfo" id="T2:U32">-<span class="mxinfo" id="T2:U33">0.2</span></span></span> ;    <span class="comment">% 给负值表示没有找到</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,503" id="srcline503">503</a></span><span class="line">    <span class="mxinfo" id="T2:U34"><span class="var type1" id="S175T2U1661">angleErr_dS</span> = <span class="mxinfo" id="T2:U36"><span class="mxinfo" id="T2:U37">-10*pi</span>/<span class="mxinfo" id="T2:U38">180</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,504" id="srcline504">504</a></span><span class="line">    <span class="mxinfo" id="T2:U39"><span class="var type1" id="S173T2U1671">TrackFlag</span> = <span class="mxinfo" id="T2:U41">-<span class="mxinfo" id="T2:U42">1.4</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,505" id="srcline505">505</a></span><span class="line">    <span class="keyword">return</span>; </span></span>
<span class="srcline"><span class="lineno"><a href="56,506" id="srcline506">506</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,507" id="srcline507">507</a></span><span class="line"><span class="mxinfo" id="T2:U43"><span class="var type1" id="S188T2U1677">dS_Vision_last_k</span> = <span class="mxinfo" id="T2:U45"><span class="var type1" id="S181T9U1679">InertialData_visual_k</span>(<span class="var type1" id="S184T2U1680">dS_Inertial_last_k</span>)</span></span>  ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,508" id="srcline508">508</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,509" id="srcline509">509</a></span><span class="line"><span class="mxinfo" id="T6:U48"><span class="var type1" id="S189T6U1683">dP_Inertial</span> = <span class="mxinfo" id="T6:U50"><span class="mxinfo" id="T6:U51"><span class="var type1" id="S176T12U1686">InertialPosition</span>(:,<span class="var type1" id="S177T4U1688">inertial_k</span>)</span> - <span class="mxinfo" id="T6:U54"><span class="var type1" id="S176T12U1690">InertialPosition</span>(:,<span class="var type1" id="S184T2U1692">dS_Inertial_last_k</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,510" id="srcline510">510</a></span><span class="line"><span class="mxinfo" id="T6:U57"><span class="var type1" id="S190T6U1695">dP_Vision</span> = <span class="mxinfo" id="T6:U59"><span class="var type1" id="S179T6U1697">otherMakersPosition_k_min</span> - <span class="mxinfo" id="T6:U61"><span class="var type1" id="S178T47U1699">trackedMakerPosition</span>(:,<span class="var type1" id="S188T2U1701">dS_Vision_last_k</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,511" id="srcline511">511</a></span><span class="line"><span class="mxinfo" id="T6:U64"><span class="var type1" id="S191T6U1704">dPError_dS</span> = <span class="mxinfo" id="T6:U66"><span class="var type1" id="S189T6U1706">dP_Inertial</span>-<span class="var type1" id="S190T6U1707">dP_Vision</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,512" id="srcline512">512</a></span><span class="line"><span class="mxinfo" id="T2:U69"><span class="var type1" id="S174T2U1710">dPError_dS_Norm</span> = <span class="mxinfo" id="T2:U71">normest(<span class="var type1" id="S191T6U1713">dPError_dS</span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,513" id="srcline513">513</a></span><span class="line"><span class="mxinfo" id="T2:U73"><span class="var type1" id="S193T2U1716">temp</span> = <span class="mxinfo" id="T2:U75"><span class="mxinfo" id="T2:U76"><span class="mxinfo" id="T2:U77"><span class="mxinfo" id="T13:U78"><span class="var type1" id="S189T6U1721">dP_Inertial</span>'</span>*<span class="var type1" id="S190T6U1722">dP_Vision</span></span> / <span class="mxinfo" id="T2:U81">normest(<span class="var type1" id="S189T6U1725">dP_Inertial</span>)</span></span> / <span class="mxinfo" id="T2:U83">normest(<span class="var type1" id="S190T6U1728">dP_Vision</span>)</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,514" id="srcline514">514</a></span><span class="line"><span class="mxinfo" id="T2:U85"><span class="var type1" id="S175T2U1731">angleErr_dS</span> = <span class="mxinfo" id="T2:U87">acos(<span class="var type1" id="S193T2U1734">temp</span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,515" id="srcline515">515</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,516" id="srcline516">516</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T14:U89"><span class="var type1" id="S174T2U1739">dPError_dS_Norm</span> &lt; <span class="mxinfo" id="T2:U91"><span class="var type1" id="S180T38U1741">makerTrackThreshold</span>.MaxPositionError_dS</span></span>  &amp;&amp; <span class="mxinfo" id="T14:U93"><span class="var type1" id="S175T2U1744">angleErr_dS</span> &lt; <span class="mxinfo" id="T2:U95"><span class="var type1" id="S180T38U1746">makerTrackThreshold</span>.Max_dPAngle_dS</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,517" id="srcline517">517</a></span><span class="line">    <span class="comment">% 距离和角度 满足</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,518" id="srcline518">518</a></span><span class="line">    <span class="mxinfo" id="T73:U97"><span class="var type1" id="S172T73U1750">trackedMakerPosition_k_OK</span> = <span class="var type1" id="S179T6U1751">otherMakersPosition_k_min</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,519" id="srcline519">519</a></span><span class="line">    <span class="mxinfo" id="T2:U100"><span class="var type1" id="S173T2U1754">TrackFlag</span> = <span class="mxinfo" id="T2:U102"><span class="mxinfo" id="T2:U103">4</span>+<span class="var type1" id="S173T2U1757">TrackFlag</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,520" id="srcline520">520</a></span><span class="line"><span class="comment">%     fprintf('3.1）3.2） 模=%0.3f，角度差=%0.3f，跟踪OK \n',normest(dPError_dS),angleErr_dS*180/pi);</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,521" id="srcline521">521</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,522" id="srcline522">522</a></span><span class="line">    <span class="mxinfo" id="T2:U105"><span class="var type1" id="S173T2U1761">TrackFlag</span> = <span class="mxinfo" id="T2:U107">-<span class="var type1" id="S173T2U1763">TrackFlag</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,523" id="srcline523">523</a></span><span class="line"><span class="comment">%     fprintf('3.1）3.2） 模=%0.3f，角度差=%0.3f，跟踪失败 \n',normest(dPError_dS),angleErr_dS*180/pi);</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,524" id="srcline524">524</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,525" id="srcline525">525</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,526" id="srcline526">526</a></span><span class="line"><span class="comment">%% 马克点判定 3) 短时间（dT=3）运动的过程，惯性和视觉位移差 dPError_dT 进行判定， dPError_dT(i) = normest(dP_Inertial-dP_Vision)</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,527" id="srcline527">527</a></span><span class="line"></span></span>
</pre>
