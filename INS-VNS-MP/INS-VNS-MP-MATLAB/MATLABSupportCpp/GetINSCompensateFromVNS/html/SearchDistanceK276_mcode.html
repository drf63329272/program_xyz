<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="56,742" id="srcline742">742</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,743" id="srcline743">743</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,744" id="srcline744">744</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,745" id="srcline745">745</a></span><span class="line"><span class="comment">%% 查找惯性k时刻前运动了大于 dS 距离的最近的点</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,746" id="srcline746">746</a></span><span class="line"><span class="comment">% 且该点trackedMakerPosition跟踪成功</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,747" id="srcline747">747</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S265T2U2760">dS_Inertial_last_k</span> = SearchDistanceK( <span class="var type1" id="S266T12U2763">InertialPosition</span>,<span class="var type1" id="S267T4U2764">kCurrent</span>,<span class="var type1" id="S268T2U2765">dS</span>,<span class="var type1" id="S269T47U2766">trackedMakerPosition</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="56,748" id="srcline748">748</a></span><span class="line"><span class="keyword">global</span> <span class="var type0" id="S270T0U2768">inertialFre</span> <span class="var type0" id="S271T0U2769">InertialData_visual_k</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,749" id="srcline749">749</a></span><span class="line"><span class="mxinfo" id="T2:U6"><span class="var type1" id="S272T2U2772">stepT</span> = <span class="mxinfo" id="T2:U8">1</span></span> ;  <span class="comment">% 搜索步长时间</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,750" id="srcline750">750</a></span><span class="line"><span class="mxinfo" id="T2:U9"><span class="var type1" id="S273T2U2776">MaxSearchT</span> = <span class="mxinfo" id="T2:U11">60</span></span> ; <span class="comment">% 最长搜索时间长度</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,751" id="srcline751">751</a></span><span class="line"><span class="mxinfo" id="T2:U12"><span class="var type1" id="S274T2U2780">stepK</span> = <span class="mxinfo" id="T2:U14">fix(<span class="mxinfo" id="T2:U15"><span class="var type1" id="S270T2U2784">inertialFre</span>*<span class="mxinfo" id="T2:U17"><span class="var type1" id="S272T2U2785">stepT</span></span></span>)</span></span> ; <span class="comment">% 搜索步长</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,752" id="srcline752">752</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,753" id="srcline753">753</a></span><span class="line"><span class="mxinfo" id="T4:U19"><span class="var type1" id="S276T4U2788">maxSearchK</span> = <span class="mxinfo" id="T4:U21">min( <span class="mxinfo" id="T4:U22"><span class="var type1" id="S267T4U2792">kCurrent</span>-<span class="mxinfo" id="T4:U24">1</span></span>,<span class="mxinfo" id="T2:U25">fix(<span class="mxinfo" id="T2:U26"><span class="var type1" id="S270T2U2797">inertialFre</span>*<span class="mxinfo" id="T2:U28"><span class="var type1" id="S273T2U2798">MaxSearchT</span></span></span>)</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,754" id="srcline754">754</a></span><span class="line"><span class="mxinfo" id="T6:U30"><span class="var type1" id="S278T6U2801">InertialPosition_kSea</span> = <span class="mxinfo" id="T6:U32"><span class="var type1" id="S266T12U2803">InertialPosition</span>(:,<span class="var type1" id="S267T4U2805">kCurrent</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,755" id="srcline755">755</a></span><span class="line"><span class="mxinfo" id="T2:U35"><span class="var type1" id="S265T2U2808">dS_Inertial_last_k</span> = <span class="mxinfo" id="T2:U37">NaN</span></span> ;     <span class="comment">% 默认设置：寻找失败</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,756" id="srcline756">756</a></span><span class="line"><span class="comment">%wh = waitbar(0,'SearchDistanceK');</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,757" id="srcline757">757</a></span><span class="line"><span class="mxinfo" id="T4:U38"><span class="keyword">for</span> <span class="var type1" id="S280T4U2813">i</span>=<span class="mxinfo" id="T4:U40">1</span>:<span class="var type1" id="S274T2U2817">stepK</span>:<span class="var type1" id="S276T4U2818">maxSearchK</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,758" id="srcline758">758</a></span><span class="line"><span class="mxinfo" id="T4:U38">    <span class="mxinfo" id="T6:U43"><span class="var type1" id="S281T6U2821">dP</span> = <span class="mxinfo" id="T6:U45"><span class="mxinfo" id="T6:U46"><span class="var type1" id="S266T12U2824">InertialPosition</span>(:,<span class="mxinfo" id="T4:U48"><span class="var type1" id="S267T4U2827">kCurrent</span>-<span class="var type1" id="S280T4U2828">i</span></span>)</span> - <span class="var type1" id="S278T6U2829">InertialPosition_kSea</span></span></span> ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,759" id="srcline759">759</a></span><span class="line"><span class="mxinfo" id="T4:U38">    <span class="mxinfo" id="T2:U52"><span class="var type1" id="S282T2U2832">distance</span> = <span class="mxinfo" id="T2:U54">normest( <span class="var type1" id="S281T6U2835">dP</span> )</span></span>;</span> </span></span>
<span class="srcline"><span class="lineno"><a href="56,760" id="srcline760">760</a></span><span class="line"><span class="mxinfo" id="T4:U38">    <span class="keyword">if</span> <span class="mxinfo" id="T14:U56"><span class="var type1" id="S282T2U2839">distance</span> &gt; <span class="mxinfo" id="T2:U58"><span class="var type1" id="S268T2U2840">dS</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,761" id="srcline761">761</a></span><span class="line"><span class="comment"><span class="mxinfo" id="T4:U38">%         kCurrent_Vision = InertialK_to_VisionK(kCurrent-i);</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,762" id="srcline762">762</a></span><span class="line"><span class="mxinfo" id="T4:U38">        <span class="mxinfo" id="T2:U60"><span class="var type1" id="S284T2U2843">kCurrent_Vision</span> = <span class="mxinfo" id="T2:U62"><span class="var type1" id="S271T9U2845">InertialData_visual_k</span>(<span class="mxinfo" id="T4:U64"><span class="var type1" id="S267T4U2847">kCurrent</span>-<span class="var type1" id="S280T4U2848">i</span></span>)</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,763" id="srcline763">763</a></span><span class="line"><span class="mxinfo" id="T4:U38">        <span class="keyword">if</span> <span class="mxinfo" id="T14:U67">~<span class="mxinfo" id="T14:U68">isnan(<span class="mxinfo" id="T2:U69"><span class="var type1" id="S269T47U2855">trackedMakerPosition</span>(<span class="mxinfo" id="T2:U71">1</span>,<span class="var type1" id="S284T2U2857">kCurrent_Vision</span>)</span>)</span></span></span>            </span></span>
<span class="srcline"><span class="lineno"><a href="56,764" id="srcline764">764</a></span><span class="line"><span class="mxinfo" id="T4:U38">            </span><span class="comment"><span class="mxinfo" id="T4:U38">% 距离满足，且 trackedMakerPosition 跟踪成功</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,765" id="srcline765">765</a></span><span class="line"><span class="mxinfo" id="T4:U38">            <span class="mxinfo" id="T2:U73"><span class="var type1" id="S265T2U2860">dS_Inertial_last_k</span> = <span class="mxinfo" id="T2:U75">double(<span class="mxinfo" id="T4:U76"><span class="var type1" id="S267T4U2864">kCurrent</span>-<span class="var type1" id="S280T4U2865">i</span></span>)</span></span> ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,766" id="srcline766">766</a></span><span class="line"><span class="mxinfo" id="T4:U38">            <span class="keyword">break</span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,767" id="srcline767">767</a></span><span class="line"><span class="mxinfo" id="T4:U38">        <span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,768" id="srcline768">768</a></span><span class="line"><span class="mxinfo" id="T4:U38">    <span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,769" id="srcline769">769</a></span><span class="line"><span class="mxinfo" id="T4:U38"> </span><span class="comment"><span class="mxinfo" id="T4:U38">%   waitbar(i/kCurrent);</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,770" id="srcline770">770</a></span><span class="line"><span class="mxinfo" id="T4:U38"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,771" id="srcline771">771</a></span><span class="line"><span class="comment">%close(wh)</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,772" id="srcline772">772</a></span><span class="line"><span class="mxinfo" id="T43:U79"><span class="autoExtrinsicFcn" id="F541N40:B2869">disp</span>(<span class="mxinfo" id="T60:U80"><span class="string">''</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,773" id="srcline773">773</a></span><span class="line"></span></span>
</pre>
