<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,319" id="srcline319">319</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,320" id="srcline320">320</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,321" id="srcline321">321</a></span><span class="line"><span class="comment">%% 根据 BodyDirection 求姿态</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,322" id="srcline322">322</a></span><span class="line"><span class="comment">% 符号有待验证！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,323" id="srcline323">323</a></span><span class="line"><span class="comment">%   BodyDirection  人朝北为 [1 0 0]</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,324" id="srcline324">324</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S96T28U1099">Cr_r1</span> = BodyDirection2Cr_r1( <span class="var type1" id="S97T6U1102">BodyDirection</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="1,325" id="srcline325">325</a></span><span class="line">coder.inline(<span class="string">'never'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,326" id="srcline326">326</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,327" id="srcline327">327</a></span><span class="line"><span class="mxinfo" id="T20:U3"><span class="var type1" id="S99T20U1111">V</span> = <span class="mxinfo" id="T20:U5">[1 0 0]</span></span>;   <span class="comment">% 正北</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,328" id="srcline328">328</a></span><span class="line"><span class="mxinfo" id="T2:U6"><span class="var type1" id="S100T2U1119">thita</span> = <span class="mxinfo" id="T2:U8">acos( <span class="mxinfo" id="T2:U9"><span class="mxinfo" id="T2:U10"><span class="mxinfo" id="T20:U11"><span class="var type1" id="S99T20U1124">V</span></span>*<span class="var type1" id="S97T6U1125">BodyDirection</span></span> / <span class="mxinfo" id="T2:U14">normest(<span class="var type1" id="S97T6U1128">BodyDirection</span>)</span></span>   )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,329" id="srcline329">329</a></span><span class="line"><span class="comment">% 通过叉乘可判断角度方向</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,330" id="srcline330">330</a></span><span class="line"><span class="mxinfo" id="T20:U16"><span class="var type1" id="S103T20U1131">temp</span> = <span class="mxinfo" id="T20:U18">cross(<span class="mxinfo" id="T20:U19"><span class="var type1" id="S99T20U1134">V</span></span>,<span class="var type1" id="S97T6U1135">BodyDirection</span>)</span></span> ;  <span class="comment">% 从 V 到 BodyDirection 逆时针180°以内时，temp朝上，temp(3)&lt;0</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,331" id="srcline331">331</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T19:U22"><span class="mxinfo" id="T2:U23"><span class="var type1" id="S103T20U1140">temp</span>(<span class="mxinfo" id="T2:U25">3</span>)</span>&gt;<span class="mxinfo" id="T2:U26">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,332" id="srcline332">332</a></span><span class="line">        <span class="comment">% 从 V 到 BodyDirection 逆时针转动超过180°</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,333" id="srcline333">333</a></span><span class="line">      <span class="mxinfo" id="T2:U27"><span class="var type1" id="S100T2U1145">thita</span> = <span class="mxinfo" id="T2:U29">-<span class="var type1" id="S100T2U1147">thita</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,334" id="srcline334">334</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,335" id="srcline335">335</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,336" id="srcline336">336</a></span><span class="line"><span class="mxinfo" id="T28:U31"><span class="var type1" id="S96T28U1150">Cr_r1</span> = <span class="mxinfo" id="T28:U33"><span class="fcn" id="F56N33:B1152">RotateZ</span>( <span class="var type1" id="S100T2U1153">thita</span> )</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,337" id="srcline337">337</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,338" id="srcline338">338</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,339" id="srcline339">339</a></span><span class="line"><span class="comment">%% InertialData  和 otherMakers 置 NaN</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,340" id="srcline340">340</a></span><span class="line"><span class="comment">%% 用于给 C++ 自动生成 初始化 函数</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,341" id="srcline341">341</a></span><span class="line"></span></span>
</pre>
