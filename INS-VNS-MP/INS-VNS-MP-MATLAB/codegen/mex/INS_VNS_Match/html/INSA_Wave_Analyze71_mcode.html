<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,649" id="srcline649">649</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,650" id="srcline650">650</a></span><span class="line"><span class="comment">%% 惯性加速度波形分析 （一个时刻）</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,651" id="srcline651">651</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,652" id="srcline652">652</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S251T6U2822">INSA_WaveFlag_All_Out</span>,<span class="var type1" id="S252T35U2823">INSA_TestOut</span>] = INSA_Wave_Analyze<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,653" id="srcline653">653</a></span><span class="line">    ( <span class="var type1" id="S253T6U2826">INSA_All</span>, <span class="mxinfo" id="T2:U4"><span class="var type2" id="S254T2V1U2827">INS_Joint_N</span></span>,<span class="var type1" id="S255T2U2828">ins_k</span>,<span class="mxinfo" id="T2:U7"><span class="var type2" id="S256T2V2U2829">IBN</span></span>,<span class="var type1" id="S257T1U2830">inertialFre</span>,<span class="var type1" id="S258T2U2831">removeN</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="1,654" id="srcline654">654</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type1" id="S259T40U2833">waveThreshold_INSAcc</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,655" id="srcline655">655</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T3:U12"><span class="mxinfo" id="T3:U13">isempty(<span class="var type0" id="S259T0U2838">waveThreshold_INSAcc</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,656" id="srcline656">656</a></span><span class="line">    <span class="mxinfo" id="T40:U14"><span class="var type1" id="S259T40U2841">waveThreshold_INSAcc</span> = <span class="mxinfo" id="T40:U16"><span class="fcn" id="F72N23:B2843">SetWaveThresholdParameters</span>( <span class="string">'INSAcc'</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,657" id="srcline657">657</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,658" id="srcline658">658</a></span><span class="line"><span class="comment">%% 所有惯性静态数据</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,659" id="srcline659">659</a></span><span class="line"><span class="keyword">persistent</span>  <span class="var type1" id="S262T6U2846">INSA_WaveFlag_All</span>  <span class="var type1" id="S263T41U2847">INSA_V_All</span>   <span class="var type1" id="S264T6U2848">INSA_waveFront_All</span>  <span class="var type1" id="S265T6U2849">INSA_waveBack_All</span>  <span class="var type1" id="S266T42U2850">INSA_k_waves_OKLast_All</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,660" id="srcline660">660</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T3:U22"><span class="mxinfo" id="T3:U23">isempty( <span class="var type0" id="S262T0U2855">INSA_WaveFlag_All</span> )</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,661" id="srcline661">661</a></span><span class="line">    <span class="mxinfo" id="T6:U24"><span class="var type1" id="S262T6U2858">INSA_WaveFlag_All</span> = <span class="mxinfo" id="T6:U26">NaN( <span class="mxinfo" id="T2:U27">3*<span class="var type1" id="S254T2U2863">INS_Joint_N</span></span>,<span class="mxinfo" id="T2:U29"><span class="var type1" id="S256T2U2864">IBN</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,662" id="srcline662">662</a></span><span class="line">    <span class="mxinfo" id="T41:U31"><span class="var type1" id="S263T41U2867">INSA_V_All</span> = <span class="mxinfo" id="T41:U33">NaN( <span class="mxinfo" id="T2:U34">5*<span class="var type1" id="S254T2U2872">INS_Joint_N</span></span>,<span class="mxinfo" id="T2:U36"><span class="var type1" id="S256T2U2873">IBN</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,663" id="srcline663">663</a></span><span class="line">    <span class="mxinfo" id="T6:U38"><span class="var type1" id="S264T6U2876">INSA_waveFront_All</span> = <span class="mxinfo" id="T6:U40">NaN( <span class="mxinfo" id="T2:U41">3*<span class="var type1" id="S254T2U2881">INS_Joint_N</span></span>,<span class="mxinfo" id="T2:U43"><span class="var type1" id="S256T2U2882">IBN</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,664" id="srcline664">664</a></span><span class="line">    <span class="mxinfo" id="T6:U45"><span class="var type1" id="S265T6U2885">INSA_waveBack_All</span> = <span class="mxinfo" id="T6:U47">NaN( <span class="mxinfo" id="T2:U48">3*<span class="var type1" id="S254T2U2890">INS_Joint_N</span></span>,<span class="mxinfo" id="T2:U50"><span class="var type1" id="S256T2U2891">IBN</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,665" id="srcline665">665</a></span><span class="line">    <span class="mxinfo" id="T42:U52"><span class="var type1" id="S266T42U2894">INSA_k_waves_OKLast_All</span> = <span class="mxinfo" id="T42:U54">zeros(<span class="mxinfo" id="T2:U55">3*<span class="var type1" id="S254T2U2899">INS_Joint_N</span></span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,666" id="srcline666">666</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,667" id="srcline667">667</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T3:U57"><span class="var type1" id="S258T2U2904">removeN</span>&gt;<span class="mxinfo" id="T2:U59">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,668" id="srcline668">668</a></span><span class="line">    <span class="mxinfo" id="T6:U60"><span class="var type1" id="S262T6U2908">INSA_WaveFlag_All</span> = <span class="mxinfo" id="T6:U62"><span class="fcn" id="F74N16:B2910">RemoveLastN</span>( <span class="var type1" id="S262T6U2911">INSA_WaveFlag_All</span>,<span class="var type1" id="S258T2U2912">removeN</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,669" id="srcline669">669</a></span><span class="line">    <span class="mxinfo" id="T41:U65"><span class="var type1" id="S263T41U2915">INSA_V_All</span> = <span class="mxinfo" id="T41:U67"><span class="fcn" id="F75N16:B2917">RemoveLastN</span>( <span class="var type1" id="S263T41U2918">INSA_V_All</span>,<span class="var type1" id="S258T2U2919">removeN</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,670" id="srcline670">670</a></span><span class="line">    <span class="mxinfo" id="T6:U70"><span class="var type1" id="S264T6U2922">INSA_waveFront_All</span> = <span class="mxinfo" id="T6:U72"><span class="fcn" id="F74N16:B2924">RemoveLastN</span>( <span class="var type1" id="S264T6U2925">INSA_waveFront_All</span>,<span class="var type1" id="S258T2U2926">removeN</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,671" id="srcline671">671</a></span><span class="line">    <span class="mxinfo" id="T6:U75"><span class="var type1" id="S265T6U2929">INSA_waveBack_All</span> = <span class="mxinfo" id="T6:U77"><span class="fcn" id="F74N16:B2931">RemoveLastN</span>( <span class="var type1" id="S265T6U2932">INSA_waveBack_All</span>,<span class="var type1" id="S258T2U2933">removeN</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,672" id="srcline672">672</a></span><span class="line">    <span class="mxinfo" id="T42:U80"><span class="var type1" id="S266T42U2936">INSA_k_waves_OKLast_All</span> = <span class="mxinfo" id="T42:U82"><span class="fcn" id="F76N16:B2938">RemoveLastN</span>( <span class="var type1" id="S266T42U2939">INSA_k_waves_OKLast_All</span>,<span class="var type1" id="S258T2U2940">removeN</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,673" id="srcline673">673</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,674" id="srcline674">674</a></span><span class="line"><span class="comment">%% 对 INS_Joint_N 个点进行波形分析</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,675" id="srcline675">675</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S270T2U2943">n</span> = <span class="mxinfo" id="T2:U86">1</span>:<span class="var type1" id="S254T2U2946">INS_Joint_N</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,676" id="srcline676">676</a></span><span class="line">    <span class="mxinfo" id="T44:U88"><span class="var type1" id="S271T44U2949">data_WaveFlag</span> = <span class="mxinfo" id="T44:U90"><span class="var type1" id="S262T6U2951">INSA_WaveFlag_All</span>( <span class="mxinfo" id="T45:U92"><span class="mxinfo" id="T2:U93"><span class="mxinfo" id="T2:U94"><span class="var type1" id="S270T2U2955">n</span>*<span class="mxinfo" id="T2:U96">3</span></span>-2</span>:<span class="var type1" id="S270T2U2959">n</span>*3</span>,: )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,677" id="srcline677">677</a></span><span class="line">    <span class="mxinfo" id="T43:U98"><span class="var type1" id="S272T43U2964">dataV</span>  = <span class="mxinfo" id="T43:U100"><span class="var type1" id="S263T41U2966">INSA_V_All</span>( <span class="mxinfo" id="T100:U102"><span class="mxinfo" id="T2:U103"><span class="mxinfo" id="T2:U104"><span class="var type1" id="S270T2U2970">n</span>*<span class="mxinfo" id="T2:U106">5</span></span>-4</span>:<span class="var type1" id="S270T2U2974">n</span>*5</span>,: )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,678" id="srcline678">678</a></span><span class="line">    <span class="mxinfo" id="T44:U108"><span class="var type1" id="S273T44U2979">dataA_waveFront</span> = <span class="mxinfo" id="T44:U110"><span class="var type1" id="S264T6U2981">INSA_waveFront_All</span>( <span class="mxinfo" id="T45:U112"><span class="mxinfo" id="T2:U113"><span class="mxinfo" id="T2:U114"><span class="var type1" id="S270T2U2985">n</span>*<span class="mxinfo" id="T2:U116">3</span></span>-2</span>:<span class="var type1" id="S270T2U2989">n</span>*3</span>,: )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,679" id="srcline679">679</a></span><span class="line">    <span class="mxinfo" id="T44:U118"><span class="var type1" id="S274T44U2994">dataA_waveBack</span> = <span class="mxinfo" id="T44:U120"><span class="var type1" id="S265T6U2996">INSA_waveBack_All</span>( <span class="mxinfo" id="T45:U122"><span class="mxinfo" id="T2:U123"><span class="mxinfo" id="T2:U124"><span class="var type1" id="S270T2U3000">n</span>*<span class="mxinfo" id="T2:U126">3</span></span>-2</span>:<span class="var type1" id="S270T2U3004">n</span>*3</span>,: )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,680" id="srcline680">680</a></span><span class="line">    <span class="mxinfo" id="T45:U128"><span class="var type1" id="S275T45U3009">k_waves_OKLast</span> = <span class="mxinfo" id="T45:U130"><span class="var type1" id="S266T42U3011">INSA_k_waves_OKLast_All</span>( <span class="mxinfo" id="T45:U132"><span class="mxinfo" id="T2:U133"><span class="mxinfo" id="T2:U134"><span class="var type1" id="S270T2U3015">n</span>*<span class="mxinfo" id="T2:U136">3</span></span>-2</span>:<span class="var type1" id="S270T2U3019">n</span>*3</span>,: )</span></span>;  <span class="comment">% 记录上一时刻判断成功的点（防止判断成功的点被覆盖）</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,681" id="srcline681">681</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,682" id="srcline682">682</a></span><span class="line">    <span class="mxinfo" id="T44:U138">[ <span class="var type1" id="S271T44U3025">data_WaveFlag</span>,<span class="var type1" id="S272T43U3026">dataV</span>,<span class="var type1" id="S273T44U3027">dataA_waveFront</span>,<span class="var type1" id="S274T44U3028">dataA_waveBack</span>,<span class="var type1" id="S275T45U3029">k_waves_OKLast</span> ] = <span class="fcn" id="F77N6:B3031">AnalyzeWave</span><span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,683" id="srcline683">683</a></span><span class="line"><span class="mxinfo" id="T44:U138">    ( <span class="mxinfo" id="T44:U144"><span class="var type1" id="S253T6U3033">INSA_All</span>( <span class="mxinfo" id="T45:U146"><span class="mxinfo" id="T2:U147"><span class="mxinfo" id="T2:U148"><span class="var type1" id="S270T2U3037">n</span>*<span class="mxinfo" id="T2:U150">3</span></span>-2</span>:<span class="var type1" id="S270T2U3041">n</span>*3</span>,: )</span>,<span class="var type1" id="S255T2U3044">ins_k</span>,<span class="var type1" id="S257T1U3045">inertialFre</span>,<span class="var type1" id="S272T43U3046">dataV</span>,<span class="var type1" id="S271T44U3047">data_WaveFlag</span>,<span class="var type1" id="S275T45U3048">k_waves_OKLast</span>,<span class="var type1" id="S273T44U3049">dataA_waveFront</span>,<span class="var type1" id="S274T44U3050">dataA_waveBack</span>,<span class="var type1" id="S259T40U3051">waveThreshold_INSAcc</span> )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,684" id="srcline684">684</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,685" id="srcline685">685</a></span><span class="line">    <span class="mxinfo" id="T44:U160"><span class="mxinfo" id="T44:U161"><span class="var type1" id="S262T6U3055">INSA_WaveFlag_All</span>( <span class="mxinfo" id="T45:U163"><span class="mxinfo" id="T2:U164"><span class="mxinfo" id="T2:U165"><span class="var type1" id="S270T2U3059">n</span>*<span class="mxinfo" id="T2:U167">3</span></span>-2</span>:<span class="var type1" id="S270T2U3063">n</span>*3</span>,: )</span> = <span class="var type1" id="S271T44U3066">data_WaveFlag</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,686" id="srcline686">686</a></span><span class="line">    <span class="mxinfo" id="T43:U170"><span class="mxinfo" id="T43:U171"><span class="var type1" id="S263T41U3070">INSA_V_All</span>( <span class="mxinfo" id="T100:U173"><span class="mxinfo" id="T2:U174"><span class="mxinfo" id="T2:U175"><span class="var type1" id="S270T2U3074">n</span>*<span class="mxinfo" id="T2:U177">5</span></span>-4</span>:<span class="var type1" id="S270T2U3078">n</span>*5</span>,: )</span> = <span class="var type1" id="S272T43U3081">dataV</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,687" id="srcline687">687</a></span><span class="line">    <span class="mxinfo" id="T44:U180"><span class="mxinfo" id="T44:U181"><span class="var type1" id="S264T6U3085">INSA_waveFront_All</span>( <span class="mxinfo" id="T45:U183"><span class="mxinfo" id="T2:U184"><span class="mxinfo" id="T2:U185"><span class="var type1" id="S270T2U3089">n</span>*<span class="mxinfo" id="T2:U187">3</span></span>-2</span>:<span class="var type1" id="S270T2U3093">n</span>*3</span>,: )</span> = <span class="var type1" id="S273T44U3096">dataA_waveFront</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,688" id="srcline688">688</a></span><span class="line">    <span class="mxinfo" id="T44:U190"><span class="mxinfo" id="T44:U191"><span class="var type1" id="S265T6U3100">INSA_waveBack_All</span>( <span class="mxinfo" id="T45:U193"><span class="mxinfo" id="T2:U194"><span class="mxinfo" id="T2:U195"><span class="var type1" id="S270T2U3104">n</span>*<span class="mxinfo" id="T2:U197">3</span></span>-2</span>:<span class="var type1" id="S270T2U3108">n</span>*3</span>,: )</span> = <span class="var type1" id="S274T44U3111">dataA_waveBack</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,689" id="srcline689">689</a></span><span class="line">    <span class="mxinfo" id="T45:U200"><span class="mxinfo" id="T45:U201"><span class="var type1" id="S266T42U3115">INSA_k_waves_OKLast_All</span>( <span class="mxinfo" id="T45:U203"><span class="mxinfo" id="T2:U204"><span class="mxinfo" id="T2:U205"><span class="var type1" id="S270T2U3119">n</span>*<span class="mxinfo" id="T2:U207">3</span></span>-2</span>:<span class="var type1" id="S270T2U3123">n</span>*3</span>,: )</span> = <span class="var type1" id="S275T45U3126">k_waves_OKLast</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,690" id="srcline690">690</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,691" id="srcline691">691</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,692" id="srcline692">692</a></span><span class="line"><span class="keyword">if</span> coder.target(<span class="string">'MATLAB'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,693" id="srcline693">693</a></span><span class="line">    <span class="var type0" id="S252T0U3137">INSA_TestOut</span>.INSA = <span class="var type0" id="S253T0U3139">INSA_All</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,694" id="srcline694">694</a></span><span class="line">    <span class="var type0" id="S252T0U3143">INSA_TestOut</span>.INSA_WaveFlag_All = <span class="var type0" id="S262T0U3145">INSA_WaveFlag_All</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,695" id="srcline695">695</a></span><span class="line">    <span class="var type0" id="S252T0U3149">INSA_TestOut</span>.INSA_V_All = <span class="var type0" id="S263T0U3151">INSA_V_All</span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,696" id="srcline696">696</a></span><span class="line">    <span class="var type0" id="S252T0U3155">INSA_TestOut</span>.INSA_waveFront_All = <span class="var type0" id="S264T0U3157">INSA_waveFront_All</span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,697" id="srcline697">697</a></span><span class="line">    <span class="var type0" id="S252T0U3161">INSA_TestOut</span>.INSA_waveBack_All = <span class="var type0" id="S265T0U3163">INSA_waveBack_All</span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,698" id="srcline698">698</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,699" id="srcline699">699</a></span><span class="line">    <span class="mxinfo" id="T35:U210"><span class="var type1" id="S252T35U3167">INSA_TestOut</span> = <span class="mxinfo" id="T35:U212">[]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,700" id="srcline700">700</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,701" id="srcline701">701</a></span><span class="line"><span class="mxinfo" id="T6:U213"><span class="var type1" id="S251T6U3172">INSA_WaveFlag_All_Out</span> = <span class="var type1" id="S262T6U3173">INSA_WaveFlag_All</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,702" id="srcline702">702</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,703" id="srcline703">703</a></span><span class="line"><span class="comment">%% 去除最前 removeN 个时刻，后续补NaN</span></span></span>
</pre>
