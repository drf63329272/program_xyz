<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,599" id="srcline599">599</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,600" id="srcline600">600</a></span><span class="line"><span class="comment">%% （一个时刻） 输入马克点位置， 输出加速度波形参数</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,601" id="srcline601">601</a></span><span class="line"><span class="comment">%% WaveResult</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,602" id="srcline602">602</a></span><span class="line"><span class="comment">%   WaveResult.WaveFlag</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,603" id="srcline603">603</a></span><span class="line"><span class="keyword">function</span>  [ <span class="var type1" id="S222T69U2595">otherMakers</span>,<span class="var type1" id="S223T109U2596">VNSA_WaveFlag_All</span>,<span class="var type1" id="S224T110U2597">VNSP_ValidN_All</span>,<span class="var type1" id="S225T111U2598">otherMakersContinuesTestOut</span> ] = VNSP_AWave_Analyze<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,604" id="srcline604">604</a></span><span class="line">    ( <span class="mxinfo" id="T69:U5"><span class="var type1" id="S222T69U2601">otherMakers</span></span>,<span class="var type1" id="S226T2U2602">k_vision</span>,<span class="var type1" id="S227T2U2603">VBN</span>,<span class="var type1" id="S228T2U2604">IsOnlyLost</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="1,605" id="srcline605">605</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,606" id="srcline606">606</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type1" id="S229T88U2606">parametersSet</span>  <span class="var type1" id="S230T78U2607">otherMakersContinues</span>  <span class="var type1" id="S231T81U2608">A_k_waves_OKLast_All</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,607" id="srcline607">607</a></span><span class="line"><span class="var type1" id="S232T1U2611">visionFre</span>  = <span class="var type1" id="S222T69U2614">otherMakers</span>(<span class="var type1" id="S226T2U2615">k_vision</span>).frequency;</span></span>
<span class="srcline"><span class="lineno"><a href="1,608" id="srcline608">608</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T3:U16">isempty(<span class="var type0" id="S229T0U2621">parametersSet</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,609" id="srcline609">609</a></span><span class="line">    [ <span class="mxinfo" id="T72:U17">~</span>,<span class="var type1" id="S234T73U2626">INSVNSCalibSet</span> ] = <span class="fcn" id="F292N22:B2628">SetConstParameters</span>( <span class="var type1" id="S232T1U2629">visionFre</span> );    </span></span>
<span class="srcline"><span class="lineno"><a href="1,610" id="srcline610">610</a></span><span class="line">    <span class="var type1" id="S236T40U2632">waveThreshold_VNSAcc</span> = <span class="fcn" id="F406N23:B2634">SetWaveThresholdParameters</span>( <span class="string">'VNSAcc'</span> );</span></span>
<span class="srcline"><span class="lineno"><a href="1,611" id="srcline611">611</a></span><span class="line">    <span class="var type1" id="S229T88U2639">parametersSet</span>.waveThreshold_VNSAcc = <span class="var type1" id="S236T40U2641">waveThreshold_VNSAcc</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,612" id="srcline612">612</a></span><span class="line">    <span class="var type1" id="S229T88U2645">parametersSet</span>.INSVNSCalibSet = <span class="var type1" id="S234T73U2647">INSVNSCalibSet</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,613" id="srcline613">613</a></span><span class="line">    <span class="var type1" id="S230T78U2650">otherMakersContinues</span> = <span class="fcn" id="F408N15:B2652">Initial_otherMakersContinues</span>( <span class="var type1" id="S227T2U2653">VBN</span> );</span></span>
<span class="srcline"><span class="lineno"><a href="1,614" id="srcline614">614</a></span><span class="line">    <span class="var type1" id="S231T81U2656">A_k_waves_OKLast_All</span> = zeros( 3*20 ); <span class="comment">%  所有马克点（最多20个 ）  % A_k_waves_OKLast_All(:,i_marker)记录上一时刻判断成功的点（防止判断成功的点被覆盖）</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,615" id="srcline615">615</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,616" id="srcline616">616</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,617" id="srcline617">617</a></span><span class="line">    <span class="comment">% 以上更新了 k_vision 时刻的马克点连续性信息，</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,618" id="srcline618">618</a></span><span class="line">    <span class="comment">%% 利用 otherMakers(k_vision) 更新 当前的连续曲线 </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,619" id="srcline619">619</a></span><span class="line">    <span class="comment">% 每个时刻将 otherMakersContinues 按照新的 otherMakers 序号进行排序，并更新顺序更新方法</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,620" id="srcline620">620</a></span><span class="line"><span class="var type1" id="S240T64U2664">ContinuesLasti_All</span> = <span class="var type1" id="S222T69U2667">otherMakers</span>(<span class="var type1" id="S226T2U2668">k_vision</span>).ContinuesLasti ;  <span class="comment">% 当前时刻 所有马克点 对应的 上时刻马克点序号</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,621" id="srcline621">621</a></span><span class="line"><span class="comment">%% 先将 otherMakersContinues 按照新的马克点序号 排序</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,622" id="srcline622">622</a></span><span class="line"><span class="comment">%% 以 otherMakers(k_vision).Position 中的马克点序号为准</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,623" id="srcline623">623</a></span><span class="line"><span class="message error" id="M3F405C">[ <span class="var type0" id="S230T0U2673"><span class="message error" id="M4F405C">otherMakersContinues</span></span>,<span class="var type0" id="S231T0U2674"><span class="message error" id="M5F405C">A_k_waves_OKLast_All</span></span> ] = <span class="fcn" id="F409N20:B2676">ReOrderContinues</span>( <span class="var type1" id="S240T64U2677">ContinuesLasti_All</span>,<span class="var type1" id="S230T78U2678">otherMakersContinues</span>,<span class="var type1" id="S231T81U2679">A_k_waves_OKLast_All</span> )</span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,624" id="srcline624">624</a></span><span class="line"><span class="var type1" id="S242T2U2682">otherMakersN</span> = <span class="var type1" id="S222T69U2685">otherMakers</span>(<span class="var type1" id="S226T2U2686">k_vision</span>).otherMakersN ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,625" id="srcline625">625</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,626" id="srcline626">626</a></span><span class="line"><span class="var type0" id="S223T0U2690">VNSA_WaveFlag_All</span> = NaN(3*<span class="var type1" id="S242T2U2695">otherMakersN</span>,<span class="var type1" id="S227T2U2696">VBN</span>) ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,627" id="srcline627">627</a></span><span class="line"><span class="var type0" id="S224T0U2699">VNSP_ValidN_All</span> = zeros(3*<span class="var type1" id="S242T2U2704">otherMakersN</span>,1) ;  </span></span>
<span class="srcline"><span class="lineno"><a href="1,628" id="srcline628">628</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,629" id="srcline629">629</a></span><span class="line"><span class="comment">% WaveResult [ MaxotherMakersN*3,1 ]</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,630" id="srcline630">630</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,631" id="srcline631">631</a></span><span class="line"><span class="var type0" id="S225T0U2708">otherMakersContinuesTestOut</span>=[];</span></span>
<span class="srcline"><span class="lineno"><a href="1,632" id="srcline632">632</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S244T2U2713">i_marker</span>=1:<span class="var type1" id="S242T2U2716">otherMakersN</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,633" id="srcline633">633</a></span><span class="line">    <span class="keyword">if</span> <span class="var type1" id="S228T2U2720">IsOnlyLost</span> &amp;&amp; ~isnan( <span class="var type1" id="S222T69U2727">otherMakers</span>(<span class="var type1" id="S226T2U2728">k_vision</span>).InitialJointK(<span class="var type1" id="S244T2U2730">i_marker</span>) ) </span></span>
<span class="srcline"><span class="lineno"><a href="1,634" id="srcline634">634</a></span><span class="line">       <span class="keyword">continue</span>;  <span class="comment">% 如果这个点没有丢就不分析 </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,635" id="srcline635">635</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,636" id="srcline636">636</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,637" id="srcline637">637</a></span><span class="line">    <span class="message fatal" id="M6F405C">[ <span class="var type0" id="S230T0U2735">otherMakersContinues</span>,<span class="var type0" id="S231T0U2737">A_k_waves_OKLast_All</span>( :,<span class="var type0" id="S244T0U2739">i_marker</span> ) ] = <span class="fcn" id="F463N4:B2741">AnalyzeVNSAWave</span>( <span class="var type1" id="S222T69U2742">otherMakers</span>,<span class="var type1" id="S226T2U2743">k_vision</span>,<span class="var type1" id="S244T2U2744">i_marker</span>,<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,638" id="srcline638">638</a></span><span class="line"><span class="message fatal" id="M6F405C">        <span class="var type1" id="S230T78U2745">otherMakersContinues</span>,<span class="var type1" id="S229T88U2746">parametersSet</span>,<span class="var type1" id="S232T1U2747">visionFre</span>,<span class="var type1" id="S231T81U2749">A_k_waves_OKLast_All</span>( :,<span class="var type1" id="S244T2U2751">i_marker</span> ) )</span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,639" id="srcline639">639</a></span><span class="line">    <span class="comment">% 根据 otherMakersContinues 更新 WaveResult</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,640" id="srcline640">640</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,641" id="srcline641">641</a></span><span class="line">    [~,~,~,~,<span class="var type0" id="S247T0U2759">AWave</span>] = Read_otherMakersContinues_i( <span class="var type0" id="S230T0U2762">otherMakersContinues</span>,<span class="var type0" id="S244T0U2763">i_marker</span> );</span></span>
<span class="srcline"><span class="lineno"><a href="1,642" id="srcline642">642</a></span><span class="line">    <span class="var type0" id="S223T0U2767">VNSA_WaveFlag_All</span>( <span class="var type0" id="S244T0U2771">i_marker</span>*3-2:<span class="var type0" id="S244T0U2775">i_marker</span>*3,: )  = <span class="var type0" id="S247T0U2779">AWave</span>( (14:16)-13,:);  </span></span>
<span class="srcline"><span class="lineno"><a href="1,643" id="srcline643">643</a></span><span class="line">    <span class="var type0" id="S224T0U2790">VNSP_ValidN_All</span>( <span class="var type0" id="S244T0U2794">i_marker</span>*3-2:<span class="var type0" id="S244T0U2798">i_marker</span>*3,1 ) = <span class="var type0" id="S230T0U2803">otherMakersContinues</span>.dataN( 1:3,<span class="var type0" id="S244T0U2808">i_marker</span> );  <span class="comment">% 位置的有效长度（与vns_k_g 插值才能得到绝对时间）</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,644" id="srcline644">644</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,645" id="srcline645">645</a></span><span class="line">    <span class="keyword">if</span> coder.target(<span class="string">'MATLAB'</span>) </span></span>
<span class="srcline"><span class="lineno"><a href="1,646" id="srcline646">646</a></span><span class="line">        <span class="var type0" id="S225T0U2818">otherMakersContinuesTestOut</span> = <span class="var type0" id="S230T0U2819">otherMakersContinues</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,647" id="srcline647">647</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,648" id="srcline648">648</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,649" id="srcline649">649</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,650" id="srcline650">650</a></span><span class="line"><span class="comment">%% 惯性加速度波形分析 （一个时刻）</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,651" id="srcline651">651</a></span><span class="line"></span></span>
</pre>
