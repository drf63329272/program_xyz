<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,114" id="srcline114">114</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,115" id="srcline115">115</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,116" id="srcline116">116</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,117" id="srcline117">117</a></span><span class="line"><span class="comment">%% 位移补偿</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line"><span class="comment">%%% Input</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,119" id="srcline119">119</a></span><span class="line"><span class="comment">% trackedMakerPosition_InertialTime ： 马克点光学位置，按惯性时序存储</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,120" id="srcline120">120</a></span><span class="line"><span class="comment">% HipDisplacement ： Hip在北东地下的位置 （由 BVH 得到）</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,121" id="srcline121">121</a></span><span class="line"><span class="comment">% InertialPosition： 惯性系与马克点安装位置对应关节的位置（安装在头上时，InertialPosition 为惯性头的位置）</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,122" id="srcline122">122</a></span><span class="line"><span class="comment">%%% Output</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,123" id="srcline123">123</a></span><span class="line"><span class="comment">% InertialPositionNew ： 补偿后惯性的位置</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,124" id="srcline124">124</a></span><span class="line"><span class="comment">% HipDisplacementNew： 补偿后Hip的位置</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,125" id="srcline125">125</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S33T19U215">InertialPositionCompensate_out</span>,<span class="var type1" id="S34T19U216">HipDisplacementNew_out</span> ] = VNSCompensateINS<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,126" id="srcline126">126</a></span><span class="line">( <span class="var type1" id="S35T2U219">compensateRate</span>,<span class="var type1" id="S36T19U220">trackedMakerPosition_InertialTime</span>,<span class="var type1" id="S37T19U221">HipDisplacement</span>,<span class="var type1" id="S38T19U222">InertialPosition</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="1,127" id="srcline127">127</a></span><span class="line">coder.inline(<span class="string">'never'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,128" id="srcline128">128</a></span><span class="line">coder.extrinsic(<span class="string">'fprintf'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,129" id="srcline129">129</a></span><span class="line">coder.extrinsic(<span class="string">'DrawCompensate'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,130" id="srcline130">130</a></span><span class="line"><span class="keyword">global</span> <span class="var type0" id="S40T0U242">CalStartIN</span>  <span class="var type0" id="S41T0U243">CalEndIN</span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,131" id="srcline131">131</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,132" id="srcline132">132</a></span><span class="line"><span class="comment">%% BVH 读取的个数 N_BVH 可能会比 N1 多几个</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,133" id="srcline133">133</a></span><span class="line"><span class="mxinfo" id="T2:U7"><span class="var type1" id="S42T2U246">N_BVH</span> = <span class="mxinfo" id="T2:U9">size(<span class="var type1" id="S37T19U249">HipDisplacement</span>,2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,134" id="srcline134">134</a></span><span class="line"><span class="mxinfo" id="T2:U11"><span class="var type1" id="S44T2U253">N1</span> = <span class="mxinfo" id="T2:U13">size(<span class="var type1" id="S36T19U256">trackedMakerPosition_InertialTime</span>,2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,135" id="srcline135">135</a></span><span class="line"><span class="keyword">for</span> <span class="mxinfo" id="T2:U15"><span class="var type1" id="S45T2U260">k</span></span>=<span class="var type1" id="S44T2U263">N1</span>+1:<span class="var type1" id="S42T2U265">N_BVH</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,136" id="srcline136">136</a></span><span class="line">    <span class="var type0" id="S36T0U269">trackedMakerPosition_InertialTime</span>(:,<span class="var type0" id="S45T0U271">k</span>) = <span class="var type0" id="S36T0U273">trackedMakerPosition_InertialTime</span>(:,<span class="var type0" id="S44T0U275">N1</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,137" id="srcline137">137</a></span><span class="line">    <span class="var type0" id="S38T0U279">InertialPosition</span>(:,<span class="var type0" id="S45T0U281">k</span>) = <span class="var type0" id="S38T0U283">InertialPosition</span>(:,<span class="var type0" id="S44T0U285">N1</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,138" id="srcline138">138</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,139" id="srcline139">139</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,140" id="srcline140">140</a></span><span class="line"><span class="comment">%% 先补偿 InertialPositionNew</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,141" id="srcline141">141</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type1" id="S46T19U287">InertialPositionCompensate</span>  <span class="var type1" id="S47T19U288">InertialPositionNew</span> <span class="var type1" id="S48T19U289">HipDisplacementNew</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,142" id="srcline142">142</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T14:U22"><span class="mxinfo" id="T14:U23">isempty(<span class="var type0" id="S46T0U294">InertialPositionCompensate</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,143" id="srcline143">143</a></span><span class="line">    <span class="mxinfo" id="T19:U24"><span class="var type1" id="S46T19U297">InertialPositionCompensate</span> = <span class="mxinfo" id="T19:U26">NaN(<span class="mxinfo" id="T2:U27">3</span>,<span class="mxinfo" id="T2:U28"><span class="var type1" id="S42T2U301">N_BVH</span></span>)</span></span>; <span class="comment">% 每一步的累积位移补偿量 记录</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,144" id="srcline144">144</a></span><span class="line">    <span class="mxinfo" id="T6:U30"><span class="mxinfo" id="T6:U31"><span class="var type1" id="S46T19U305">InertialPositionCompensate</span>(:,<span class="mxinfo" id="T2:U33">1</span>)</span>=<span class="mxinfo" id="T6:U34">zeros(<span class="mxinfo" id="T2:U35">3</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,145" id="srcline145">145</a></span><span class="line">    <span class="mxinfo" id="T19:U36"><span class="var type1" id="S47T19U314">InertialPositionNew</span> = <span class="mxinfo" id="T19:U38">NaN(<span class="mxinfo" id="T2:U39">3</span>,<span class="mxinfo" id="T2:U40"><span class="var type1" id="S42T2U318">N_BVH</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,146" id="srcline146">146</a></span><span class="line">    <span class="mxinfo" id="T16:U42"><span class="mxinfo" id="T16:U43"><span class="var type1" id="S47T19U322">InertialPositionNew</span>(<span class="mxinfo" id="T2:U45">3</span>,:)</span> = <span class="mxinfo" id="T16:U46"><span class="var type1" id="S38T19U326">InertialPosition</span>(<span class="mxinfo" id="T2:U48">3</span>,:)</span></span>; <span class="comment">% 高度不补偿</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,147" id="srcline147">147</a></span><span class="line">    <span class="mxinfo" id="T40:U49"><span class="mxinfo" id="T40:U50"><span class="var type1" id="S47T19U332">InertialPositionNew</span>(<span class="mxinfo" id="T35:U52"><span class="mxinfo" id="T2:U53">1</span>:<span class="mxinfo" id="T2:U54">2</span></span>,<span class="mxinfo" id="T2:U55">1</span>)</span> = <span class="mxinfo" id="T40:U56"><span class="var type1" id="S38T19U338">InertialPosition</span>(<span class="mxinfo" id="T35:U58"><span class="mxinfo" id="T2:U59">1</span>:<span class="mxinfo" id="T2:U60">2</span></span>,<span class="mxinfo" id="T2:U61">1</span>)</span></span> ;  <span class="comment">% 起始点选择惯性</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,148" id="srcline148">148</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,149" id="srcline149">149</a></span><span class="line">    <span class="mxinfo" id="T19:U62"><span class="var type1" id="S48T19U345">HipDisplacementNew</span> = <span class="mxinfo" id="T19:U64">NaN(<span class="mxinfo" id="T2:U65">3</span>,<span class="mxinfo" id="T2:U66"><span class="var type1" id="S42T2U349">N_BVH</span></span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,150" id="srcline150">150</a></span><span class="line">    <span class="mxinfo" id="T16:U68"><span class="mxinfo" id="T16:U69"><span class="var type1" id="S48T19U353">HipDisplacementNew</span>(<span class="mxinfo" id="T2:U71">3</span>,:)</span> = <span class="mxinfo" id="T16:U72"><span class="var type1" id="S37T19U357">HipDisplacement</span>(<span class="mxinfo" id="T2:U74">3</span>,:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,151" id="srcline151">151</a></span><span class="line">    <span class="mxinfo" id="T6:U75"><span class="mxinfo" id="T6:U76"><span class="var type1" id="S48T19U363">HipDisplacementNew</span>(:,<span class="mxinfo" id="T2:U78">1</span>)</span> = <span class="mxinfo" id="T6:U79"><span class="var type1" id="S37T19U367">HipDisplacement</span>(:,<span class="mxinfo" id="T2:U81">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,152" id="srcline152">152</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,153" id="srcline153">153</a></span><span class="line"><span class="keyword">persistent</span>  <span class="var type1" id="S52T63U371">InertialErr</span> <span class="var type1" id="S53T63U372">StepCompensate</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,154" id="srcline154">154</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T14:U84"><span class="mxinfo" id="T14:U85">isempty(<span class="var type0" id="S53T0U377">StepCompensate</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,155" id="srcline155">155</a></span><span class="line">    <span class="mxinfo" id="T63:U86"><span class="var type1" id="S52T63U380">InertialErr</span> = <span class="mxinfo" id="T63:U88">zeros(<span class="mxinfo" id="T2:U89">2</span>,<span class="mxinfo" id="T2:U90"><span class="var type1" id="S42T2U384">N_BVH</span></span>)</span></span>;       <span class="comment">% 实时记录补偿后的误差</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,156" id="srcline156">156</a></span><span class="line">    <span class="mxinfo" id="T63:U92"><span class="var type1" id="S53T63U387">StepCompensate</span> = <span class="mxinfo" id="T63:U94">zeros(<span class="mxinfo" id="T2:U95">2</span>,<span class="mxinfo" id="T2:U96"><span class="var type1" id="S42T2U391">N_BVH</span></span>)</span></span>;  <span class="comment">% 单步补偿量</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,157" id="srcline157">157</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,158" id="srcline158">158</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,159" id="srcline159">159</a></span><span class="line"><span class="mxinfo" id="T4:U98"><span class="keyword">for</span> <span class="var type1" id="S45T4U394">k</span> = <span class="mxinfo" id="T4:U100">max(<span class="mxinfo" id="T2:U101">2</span>,<span class="var type1" id="S40T4U399">CalStartIN</span>)</span> : <span class="var type1" id="S41T4U400">CalEndIN</span></span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,160" id="srcline160">160</a></span><span class="line"><span class="mxinfo" id="T4:U98">    </span><span class="comment"><span class="mxinfo" id="T4:U98">% 先用纯惯性递推</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,161" id="srcline161">161</a></span><span class="line"><span class="mxinfo" id="T4:U98">    <span class="mxinfo" id="T40:U104"><span class="mxinfo" id="T40:U105"><span class="var type1" id="S47T19U404">InertialPositionNew</span>(<span class="mxinfo" id="T35:U107"><span class="mxinfo" id="T2:U108">1</span>:<span class="mxinfo" id="T2:U109">2</span></span>,<span class="var type1" id="S45T4U408">k</span>)</span> = <span class="mxinfo" id="T40:U111"><span class="mxinfo" id="T40:U112"><span class="var type1" id="S47T19U411">InertialPositionNew</span>(<span class="mxinfo" id="T35:U114"><span class="mxinfo" id="T2:U115">1</span>:<span class="mxinfo" id="T2:U116">2</span></span>,<span class="mxinfo" id="T4:U117"><span class="var type1" id="S45T4U416">k</span>-<span class="mxinfo" id="T4:U119">1</span></span>)</span>+( <span class="mxinfo" id="T40:U120"><span class="mxinfo" id="T40:U121"><span class="var type1" id="S38T19U421">InertialPosition</span>(<span class="mxinfo" id="T35:U123"><span class="mxinfo" id="T2:U124">1</span>:<span class="mxinfo" id="T2:U125">2</span></span>,<span class="var type1" id="S45T4U425">k</span>)</span>-<span class="mxinfo" id="T40:U127"><span class="var type1" id="S38T19U427">InertialPosition</span>(<span class="mxinfo" id="T35:U129"><span class="mxinfo" id="T2:U130">1</span>:<span class="mxinfo" id="T2:U131">2</span></span>,<span class="mxinfo" id="T4:U132"><span class="var type1" id="S45T4U432">k</span>-<span class="mxinfo" id="T4:U134">1</span></span>)</span></span> )</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,162" id="srcline162">162</a></span><span class="line"><span class="mxinfo" id="T4:U98">    </span><span class="comment"><span class="mxinfo" id="T4:U98">% 先求纯惯性为误差</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,163" id="srcline163">163</a></span><span class="line"><span class="mxinfo" id="T4:U98">    <span class="keyword">if</span> <span class="mxinfo" id="T14:U135">~<span class="mxinfo" id="T14:U136">isnan(<span class="mxinfo" id="T2:U137"><span class="var type1" id="S36T19U440">trackedMakerPosition_InertialTime</span>(<span class="mxinfo" id="T2:U139">1</span>,<span class="var type1" id="S45T4U442">k</span>)</span>)</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,164" id="srcline164">164</a></span><span class="line"><span class="mxinfo" id="T4:U98">        <span class="mxinfo" id="T40:U141"><span class="mxinfo" id="T40:U142"><span class="var type1" id="S52T63U446">InertialErr</span>(:,<span class="var type1" id="S45T4U448">k</span>)</span> = <span class="mxinfo" id="T40:U145"><span class="mxinfo" id="T40:U146"><span class="var type1" id="S36T19U451">trackedMakerPosition_InertialTime</span>(<span class="mxinfo" id="T35:U148"><span class="mxinfo" id="T2:U149">1</span>:<span class="mxinfo" id="T2:U150">2</span></span>,<span class="var type1" id="S45T4U455">k</span>)</span> - <span class="mxinfo" id="T40:U152"><span class="var type1" id="S47T19U457">InertialPositionNew</span>(<span class="mxinfo" id="T35:U154"><span class="mxinfo" id="T2:U155">1</span>:<span class="mxinfo" id="T2:U156">2</span></span>,<span class="var type1" id="S45T4U461">k</span>)</span></span></span> ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,165" id="srcline165">165</a></span><span class="line"><span class="mxinfo" id="T4:U98">        </span><span class="comment"><span class="mxinfo" id="T4:U98">% 补偿误差</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,166" id="srcline166">166</a></span><span class="line"><span class="mxinfo" id="T4:U98">        <span class="mxinfo" id="T40:U158"><span class="mxinfo" id="T40:U159"><span class="var type1" id="S47T19U465">InertialPositionNew</span>(<span class="mxinfo" id="T35:U161"><span class="mxinfo" id="T2:U162">1</span>:<span class="mxinfo" id="T2:U163">2</span></span>,<span class="var type1" id="S45T4U469">k</span>)</span> = <span class="mxinfo" id="T40:U165"><span class="mxinfo" id="T40:U166"><span class="var type1" id="S47T19U472">InertialPositionNew</span>(<span class="mxinfo" id="T35:U168"><span class="mxinfo" id="T2:U169">1</span>:<span class="mxinfo" id="T2:U170">2</span></span>,<span class="var type1" id="S45T4U476">k</span>)</span> + <span class="mxinfo" id="T40:U172"><span class="mxinfo" id="T40:U173"><span class="var type1" id="S52T63U479">InertialErr</span>(:,<span class="var type1" id="S45T4U481">k</span>)</span>*<span class="var type1" id="S35T2U482">compensateRate</span></span></span></span> ;</span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,167" id="srcline167">167</a></span><span class="line"><span class="mxinfo" id="T4:U98">        <span class="mxinfo" id="T40:U177"><span class="mxinfo" id="T40:U178"><span class="var type1" id="S53T63U486">StepCompensate</span>(:,<span class="var type1" id="S45T4U488">k</span>)</span> = <span class="mxinfo" id="T40:U181"><span class="mxinfo" id="T40:U182"><span class="var type1" id="S52T63U491">InertialErr</span>(:,<span class="var type1" id="S45T4U493">k</span>)</span>*<span class="var type1" id="S35T2U494">compensateRate</span></span></span> ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,168" id="srcline168">168</a></span><span class="line"><span class="mxinfo" id="T4:U98">    <span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,169" id="srcline169">169</a></span><span class="line"><span class="mxinfo" id="T4:U98">    <span class="mxinfo" id="T40:U186"><span class="mxinfo" id="T40:U187"><span class="var type1" id="S46T19U498">InertialPositionCompensate</span>(<span class="mxinfo" id="T35:U189"><span class="mxinfo" id="T2:U190">1</span>:<span class="mxinfo" id="T2:U191">2</span></span>,<span class="var type1" id="S45T4U502">k</span>)</span> = <span class="mxinfo" id="T40:U193"><span class="mxinfo" id="T40:U194"><span class="var type1" id="S47T19U505">InertialPositionNew</span>(<span class="mxinfo" id="T35:U196"><span class="mxinfo" id="T2:U197">1</span>:<span class="mxinfo" id="T2:U198">2</span></span>,<span class="var type1" id="S45T4U509">k</span>)</span> - <span class="mxinfo" id="T40:U200"><span class="var type1" id="S38T19U511">InertialPosition</span>(<span class="mxinfo" id="T35:U202"><span class="mxinfo" id="T2:U203">1</span>:<span class="mxinfo" id="T2:U204">2</span></span>,<span class="var type1" id="S45T4U515">k</span>)</span></span></span> ;  </span><span class="comment"><span class="mxinfo" id="T4:U98">% 累积位移补偿量</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,170" id="srcline170">170</a></span><span class="line"><span class="mxinfo" id="T4:U98"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,171" id="srcline171">171</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,172" id="srcline172">172</a></span><span class="line"><span class="comment">%% 通过 InertialPositionNew 计算 HipDisplacementNew</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,173" id="srcline173">173</a></span><span class="line"><span class="comment">% 将Head位置传到Hip，：保持头和head的相对位移</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,174" id="srcline174">174</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,175" id="srcline175">175</a></span><span class="line"><span class="mxinfo" id="T4:U206"><span class="keyword">for</span> <span class="var type1" id="S45T4U518">k</span>=<span class="var type1" id="S40T4U520">CalStartIN</span>:<span class="var type1" id="S41T4U521">CalEndIN</span></span>    </span></span>
<span class="srcline"><span class="lineno"><a href="1,176" id="srcline176">176</a></span><span class="line"><span class="mxinfo" id="T4:U206">    <span class="mxinfo" id="T40:U210"><span class="mxinfo" id="T40:U211"><span class="var type1" id="S48T19U525">HipDisplacementNew</span>( <span class="mxinfo" id="T35:U213"><span class="mxinfo" id="T2:U214">1</span>:<span class="mxinfo" id="T2:U215">2</span></span>,<span class="var type1" id="S45T4U529">k</span> )</span> = <span class="mxinfo" id="T40:U217"><span class="mxinfo" id="T40:U218"><span class="var type1" id="S37T19U532">HipDisplacement</span>(<span class="mxinfo" id="T35:U220"><span class="mxinfo" id="T2:U221">1</span>:<span class="mxinfo" id="T2:U222">2</span></span>,<span class="var type1" id="S45T4U536">k</span>)</span> + <span class="mxinfo" id="T40:U224"><span class="var type1" id="S46T19U538">InertialPositionCompensate</span>(<span class="mxinfo" id="T35:U226"><span class="mxinfo" id="T2:U227">1</span>:<span class="mxinfo" id="T2:U228">2</span></span>,<span class="var type1" id="S45T4U542">k</span>)</span></span></span> ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,177" id="srcline177">177</a></span><span class="line"><span class="mxinfo" id="T4:U206">    <span class="mxinfo" id="T6:U230"><span class="mxinfo" id="T6:U231"><span class="var type1" id="S48T19U546">HipDisplacementNew</span>( <span class="mxinfo" id="T20:U233"><span class="mxinfo" id="T2:U234">1</span>:<span class="mxinfo" id="T2:U235">3</span></span>,<span class="var type1" id="S45T4U550">k</span> )</span> = <span class="mxinfo" id="T6:U237"><span class="var type1" id="S37T19U552">HipDisplacement</span>( <span class="mxinfo" id="T20:U239"><span class="mxinfo" id="T2:U240">1</span>:<span class="mxinfo" id="T2:U241">3</span></span>,<span class="var type1" id="S45T4U556">k</span> )</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,178" id="srcline178">178</a></span><span class="line"><span class="mxinfo" id="T4:U206"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,179" id="srcline179">179</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,180" id="srcline180">180</a></span><span class="line"><span class="mxinfo" id="T19:U243"><span class="var type1" id="S33T19U559">InertialPositionCompensate_out</span> = <span class="var type1" id="S46T19U560">InertialPositionCompensate</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,181" id="srcline181">181</a></span><span class="line"><span class="mxinfo" id="T19:U246"><span class="var type1" id="S34T19U563">HipDisplacementNew_out</span> = <span class="var type1" id="S48T19U564">HipDisplacementNew</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,182" id="srcline182">182</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T14:U249"><span class="var type1" id="S41T4U568">CalEndIN</span> &gt;= <span class="mxinfo" id="T2:U251"><span class="mxinfo" id="T2:U252">size(<span class="var type1" id="S36T19U572">trackedMakerPosition_InertialTime</span>,2)</span>-<span class="mxinfo" id="T2:U254">10</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,183" id="srcline183">183</a></span><span class="line">    <span class="mxinfo" id="T82:U255"><span class="extrinsicFcn" id="F550N3:B577">DrawCompensate</span>( <span class="var type1" id="S52T63U578">InertialErr</span>,<span class="var type1" id="S53T63U579">StepCompensate</span>,<span class="var type1" id="S36T19U580">trackedMakerPosition_InertialTime</span>,<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,184" id="srcline184">184</a></span><span class="line"><span class="mxinfo" id="T82:U255">        <span class="var type1" id="S38T19U581">InertialPosition</span>,<span class="var type1" id="S47T19U582">InertialPositionNew</span>,<span class="var type1" id="S46T19U583">InertialPositionCompensate</span>,<span class="var type1" id="S35T2U584">compensateRate</span>,<span class="mxinfo" id="T2:U263"><span class="var type1" id="S42T2U585">N_BVH</span></span> )</span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,185" id="srcline185">185</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,186" id="srcline186">186</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,187" id="srcline187">187</a></span><span class="line"><span class="comment">%% 视觉位置预处理</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,188" id="srcline188">188</a></span><span class="line"><span class="comment">% 1）将视觉数据  从视觉世界坐标系 转到 北东地坐标系</span></span></span>
</pre>
