<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="131,1" id="srcline1">  1</a></span><span class="line"><span class="comment">%% xyz  2015.4.9</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,2" id="srcline2">  2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="131,3" id="srcline3">  3</a></span><span class="line"><span class="comment">% direction cosine matrix  to Euler angle</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,4" id="srcline4">  4</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,5" id="srcline5">  5</a></span><span class="line"><span class="comment">% Input</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,6" id="srcline6">  6</a></span><span class="line"><span class="comment">% C: [ 3*3*N ]</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,7" id="srcline7">  7</a></span><span class="line"><span class="comment">% rotateOrder:  XYZ  XZY  <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="131,8" id="srcline8">  8</a></span><span class="line"><span class="comment">% rotateDirection: anticlockwise(1) or clockwise(-1)  [1,1,1]</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,9" id="srcline9">  9</a></span><span class="line"><span class="comment">% CosBeitaSign: 1 / -1 . </span></span></span>
<span class="srcline"><span class="lineno"><a href="131,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%       CosBeitaSign = 1 : cos(beita)&gt;0, beita [ -pi/2,pi/2 ]</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">%       CosBeitaSign = -1 : cos(beita)&lt;0, beita [ -pi,-pi/2 ] or [ pi/2,pi ]</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%%%  NOTE: There are two kinds of Euler Angles applied to the C. </span></span></span>
<span class="srcline"><span class="lineno"><a href="131,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">% Output</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">% euler:  [3*N];   euler(:,k) = [eu_1,eu_2,eu_3];   rad   </span></span></span>
<span class="srcline"><span class="lineno"><a href="131,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">%       store order of euler angle: the rotate order</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">%       eu_1,eu_3: [-pi,pi]</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">%       eu_2:   CosBeitaSign=1: [-pi/2,pi/2]      </span></span></span>
<span class="srcline"><span class="lineno"><a href="131,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">%               CosBeitaSign=-1:[ -pi,-pi/2 ] or [ pi/2,pi ]</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,20" id="srcline20"> 20</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="131,21" id="srcline21"> 21</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T6U3">euler</span> = C2Euler( <span class="var type1" id="S3T28U6">C</span>,<span class="mxinfo" id="T31:U3"><span class="var type2" id="S4T31V2U7">rotateOrder</span></span>,<span class="var type1" id="S5T20U8">rotateDirection</span>,<span class="var type1" id="S6T2U9">CosBeitaSign</span> )<span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,22" id="srcline22"> 22</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="131,23" id="srcline23"> 23</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="131,24" id="srcline24"> 24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="131,25" id="srcline25"> 25</a></span><span class="line"><span class="fcn" id="F511N5:B12">CheckError</span>( <span class="var type1" id="S3T28U13">C</span> ) ; </span></span>
<span class="srcline"><span class="lineno"><a href="131,26" id="srcline26"> 26</a></span><span class="line"><span class="mxinfo" id="T2:U8"><span class="var type1" id="S8T2U16">Nframes</span> = <span class="mxinfo" id="T2:U10">size(<span class="var type1" id="S3T28U19">C</span>,3)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="131,27" id="srcline27"> 27</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="131,28" id="srcline28"> 28</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="131,29" id="srcline29"> 29</a></span><span class="line"><span class="keyword">if</span> numel(<span class="var type1" id="S6T2U26">CosBeitaSign</span>)==1</span></span>
<span class="srcline"><span class="lineno"><a href="131,30" id="srcline30"> 30</a></span><span class="line">   <span class="mxinfo" id="T2:U13"><span class="var type1" id="S6T2U30">CosBeitaSign</span> = <span class="mxinfo" id="T2:U15">repmat( <span class="var type1" id="S6T2U33">CosBeitaSign</span>,<span class="var type1" id="S8T2U34">Nframes</span>,1 )</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="131,31" id="srcline31"> 31</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,32" id="srcline32"> 32</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="131,33" id="srcline33"> 33</a></span><span class="line"><span class="mxinfo" id="T6:U18"><span class="var type1" id="S2T6U38">euler</span> = <span class="mxinfo" id="T6:U20">zeros( <span class="mxinfo" id="T2:U21">3</span>,<span class="var type1" id="S8T2U42">Nframes</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="131,34" id="srcline34"> 34</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S13T2U45">k</span>=<span class="mxinfo" id="T2:U24">1:<span class="var type1" id="S8T2U48">Nframes</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="131,35" id="srcline35"> 35</a></span><span class="line">    <span class="mxinfo" id="T28:U26"><span class="var type1" id="S14T28U51">C_k</span> = <span class="mxinfo" id="T28:U28"><span class="var type1" id="S3T28U53">C</span>(:,:,<span class="var type1" id="S13T2U56">k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="131,36" id="srcline36"> 36</a></span><span class="line">    <span class="mxinfo" id="T6:U31"><span class="mxinfo" id="T6:U32"><span class="var type1" id="S2T6U60">euler</span>(:,<span class="mxinfo" id="T2:U34"><span class="var type1" id="S13T2U62">k</span></span>)</span> = <span class="mxinfo" id="T6:U36"><span class="fcn" id="F521N4:B64">C2Euler_One</span>( <span class="var type1" id="S14T28U65">C_k</span>,<span class="var type1" id="S4T31U66">rotateOrder</span>,<span class="var type1" id="S5T20U67">rotateDirection</span>,<span class="mxinfo" id="T2:U40"><span class="var type1" id="S6T2U69">CosBeitaSign</span></span>(<span class="var type1" id="S13T2U70">k</span>) )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="131,37" id="srcline37"> 37</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,38" id="srcline38"> 38</a></span><span class="line"><span class="mxinfo" id="T6:U43"><span class="var type1" id="S2T6U73">euler</span> = <span class="mxinfo" id="T6:U45"><span class="fcn" id="F526N26:B75">MakeEuler_In2Pi</span>( <span class="var type1" id="S2T6U76">euler</span> )</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="131,39" id="srcline39"> 39</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="131,40" id="srcline40"> 40</a></span><span class="line"><span class="comment">% C:[3*3]</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,41" id="srcline41"> 41</a></span><span class="line"><span class="comment">% 第二个欧拉角定义范围 CosBeitaSign = 1： [ -pi/2,pi/2 ]</span></span></span>
<span class="srcline"><span class="lineno"><a href="131,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">%                    CosBeitaSign = -1： [ -pi,-pi/2 ] [ pi/2,pi ]</span></span></span>
</pre>
