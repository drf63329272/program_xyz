<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="49,334" id="srcline334">334</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,335" id="srcline335">335</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,336" id="srcline336">336</a></span><span class="line"><span class="comment">%% Judge which is the right maker</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,337" id="srcline337">337</a></span><span class="line"><span class="comment">% 1) 固定运动时间位移判断：只判断位移差长度</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,338" id="srcline338">338</a></span><span class="line"><span class="comment">% 2）固定运动距离位移判断：同时判断位移差长度和方向</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,339" id="srcline339">339</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,340" id="srcline340">340</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S102T73U1425">trackedMakerPosition_k_OK</span>,<span class="var type1" id="S103T41U1426">otherMakers_k</span>,<span class="var type1" id="S104T2U1427">TrackFlag</span>,<span class="var type1" id="S105T51U1428">JudgeIndex</span> ] = JudgeMaker<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,341" id="srcline341">341</a></span><span class="line">( <span class="mxinfo" id="T41:U5"><span class="mxinfo" id="T41:U6"><span class="var type1" id="S103T41U1431">otherMakers_k</span></span></span>,<span class="var type1" id="S106T68U1432">otherMakers_k_last</span>,<span class="var type1" id="S107T4U1433">k_vision</span>,<span class="var type1" id="S108T4U1434">inertial_k</span>,<span class="var type1" id="S109T44U1435">trackedMakerPosition</span>,<span class="var type1" id="S110T13U1436">InertialPosition</span>,<span class="var type1" id="S111T4U1437">inertial_dT_k_last</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,342" id="srcline342">342</a></span><span class="line">            <span class="var type1" id="S112T34U1438">makerTrackThreshold</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="49,343" id="srcline343">343</a></span><span class="line">coder.extrinsic(<span class="string">'fprintf'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="49,344" id="srcline344">344</a></span><span class="line"><span class="keyword">global</span>  <span class="var type0" id="S114T0U1446">visionFre</span>   <span class="var type0" id="S115T0U1447">IsGetFirstMarker</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,345" id="srcline345">345</a></span><span class="line"><span class="keyword">global</span> <span class="var type0" id="S116T0U1449">InertialData_visual_k</span>  <span class="var type0" id="S117T0U1450">VisionData_inertial_k</span> <span class="var type0" id="S118T0U1451">CalStartIN</span>  <span class="var type0" id="S119T0U1452">CalEndIN</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,346" id="srcline346">346</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,347" id="srcline347">347</a></span><span class="line"><span class="mxinfo" id="T2:U15"><span class="var type1" id="S120T2U1455">vision_dT_k_last</span> = <span class="mxinfo" id="T2:U17"><span class="var type1" id="S116T10U1457">InertialData_visual_k</span>(<span class="var type1" id="S111T4U1458">inertial_dT_k_last</span>)</span></span>; <span class="comment">% 初始值</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,348" id="srcline348">348</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,349" id="srcline349">349</a></span><span class="line"><span class="mxinfo" id="T2:U20"><span class="var type1" id="S121T2U1461">moveDistance</span> = <span class="mxinfo" id="T2:U22"><span class="var type1" id="S112T34U1463">makerTrackThreshold</span>.moveDistance</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,350" id="srcline350">350</a></span><span class="line"><span class="mxinfo" id="T2:U24"><span class="mxinfo" id="T2:U25"><span class="var type1" id="S105T51U1468">JudgeIndex</span>.dPi_ConJudge</span> = <span class="mxinfo" id="T2:U27">NaN</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,351" id="srcline351">351</a></span><span class="line"><span class="mxinfo" id="T2:U28"><span class="mxinfo" id="T2:U29"><span class="var type1" id="S105T51U1475">JudgeIndex</span>.dPError_dT_xy</span> = <span class="mxinfo" id="T2:U31">NaN</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,352" id="srcline352">352</a></span><span class="line"><span class="mxinfo" id="T2:U32"><span class="mxinfo" id="T2:U33"><span class="var type1" id="S105T51U1482">JudgeIndex</span>.dPError_dT_z</span> = <span class="mxinfo" id="T2:U35">NaN</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,353" id="srcline353">353</a></span><span class="line"><span class="mxinfo" id="T2:U36"><span class="mxinfo" id="T2:U37"><span class="var type1" id="S105T51U1489">JudgeIndex</span>.dPError_dS_xyNorm</span> = <span class="mxinfo" id="T2:U39">NaN</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,354" id="srcline354">354</a></span><span class="line"><span class="mxinfo" id="T2:U40"><span class="mxinfo" id="T2:U41"><span class="var type1" id="S105T51U1496">JudgeIndex</span>.dP_Inertial_xyNorm</span> = <span class="mxinfo" id="T2:U43">NaN</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,355" id="srcline355">355</a></span><span class="line"><span class="mxinfo" id="T2:U44"><span class="mxinfo" id="T2:U45"><span class="var type1" id="S105T51U1503">JudgeIndex</span>.angleErr_dS</span> = <span class="mxinfo" id="T2:U47">NaN</span></span>  ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,356" id="srcline356">356</a></span><span class="line"><span class="mxinfo" id="T2:U48"><span class="mxinfo" id="T2:U49"><span class="var type1" id="S105T51U1510">JudgeIndex</span>.angleErr_dT_Min</span> = <span class="mxinfo" id="T2:U51">NaN</span></span>  ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,357" id="srcline357">357</a></span><span class="line"><span class="mxinfo" id="T2:U52"><span class="mxinfo" id="T2:U53"><span class="var type1" id="S105T51U1517">JudgeIndex</span>.INSVNSMarkHC_Min</span> = <span class="mxinfo" id="T2:U55">NaN</span></span>  ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,358" id="srcline358">358</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,359" id="srcline359">359</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,360" id="srcline360">360</a></span><span class="line"><span class="mxinfo" id="T73:U56"><span class="var type1" id="S102T73U1523">trackedMakerPosition_k_OK</span> = <span class="mxinfo" id="T2:U58">NaN</span></span>;  <span class="comment">% 跟踪马克点失败置 NaN</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,361" id="srcline361">361</a></span><span class="line"><span class="mxinfo" id="T2:U59"><span class="var type1" id="S104T2U1528">TrackFlag</span> = <span class="mxinfo" id="T2:U61">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,362" id="srcline362">362</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="49,363" id="srcline363">363</a></span><span class="line"><span class="comment">% M = otherMakers_k.otherMakersN ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,364" id="srcline364">364</a></span><span class="line"><span class="mxinfo" id="T3:U62"><span class="var type1" id="S123T3U1532">otherMakersPosition_k</span> = <span class="mxinfo" id="T3:U64"><span class="var type1" id="S103T41U1534">otherMakers_k</span>.Position</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,365" id="srcline365">365</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,366" id="srcline366">366</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,367" id="srcline367">367</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T19:U66">isnan(<span class="mxinfo" id="T2:U67"><span class="var type1" id="S123T3U1541">otherMakersPosition_k</span>(<span class="mxinfo" id="T2:U69">1</span>)</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,368" id="srcline368">368</a></span><span class="line">    <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,369" id="srcline369">369</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,370" id="srcline370">370</a></span><span class="line"><span class="comment">%% 高度判断</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,371" id="srcline371">371</a></span><span class="line"><span class="comment">%  将 otherMakers_k 中高度变化大的点直接剔除了</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,372" id="srcline372">372</a></span><span class="line"><span class="mxinfo" id="T41:U70">[ <span class="var type1" id="S103T41U1547">otherMakers_k</span>,<span class="mxinfo" id="T2:U72"><span class="var type1" id="S102T2U1548">trackedMakerPosition_k_OK</span></span>,<span class="var type1" id="S104T2U1549">TrackFlag</span>,<span class="var type1" id="S125T2U1550">INSVNSMarkHC_Min</span> ] = <span class="fcn" id="F204N22:B1552">Track_High_Judge</span><span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,373" id="srcline373">373</a></span><span class="line"><span class="mxinfo" id="T41:U70">    ( <span class="var type1" id="S103T41U1553">otherMakers_k</span>,<span class="var type1" id="S108T4U1554">inertial_k</span>,<span class="var type1" id="S110T13U1555">InertialPosition</span>,<span class="var type1" id="S112T34U1556">makerTrackThreshold</span> )</span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,374" id="srcline374">374</a></span><span class="line"><span class="mxinfo" id="T2:U80"><span class="mxinfo" id="T2:U81"><span class="var type1" id="S105T51U1560">JudgeIndex</span>.INSVNSMarkHC_Min</span> = <span class="var type1" id="S125T2U1562">INSVNSMarkHC_Min</span></span>  ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,375" id="srcline375">375</a></span><span class="line"><span class="mxinfo" id="T4:U84"><span class="var type1" id="S127T4U1565">M</span> = <span class="mxinfo" id="T4:U86"><span class="var type1" id="S103T41U1567">otherMakers_k</span>.otherMakersN</span></span> ;  <span class="comment">% 点的个数可能被减少了</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,376" id="srcline376">376</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T19:U88"><span class="var type1" id="S104T2U1572">TrackFlag</span> == <span class="mxinfo" id="T2:U90">-<span class="mxinfo" id="T2:U91">1</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,377" id="srcline377">377</a></span><span class="line">    <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,378" id="srcline378">378</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,379" id="srcline379">379</a></span><span class="line"><span class="comment">%% 马克点连续性判断</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,380" id="srcline380">380</a></span><span class="line"><span class="mxinfo" id="T41:U92">[ <span class="var type1" id="S103T41U1579">otherMakers_k</span>,<span class="var type1" id="S128T2U1580">dPi_ConJudge</span> ] = <span class="fcn" id="F246N16:B1582">ContinuesJudge</span>( <span class="var type1" id="S103T41U1583">otherMakers_k</span>,<span class="var type1" id="S106T68U1584">otherMakers_k_last</span>,<span class="var type1" id="S109T44U1585">trackedMakerPosition</span>,<span class="var type1" id="S107T4U1586">k_vision</span>,<span class="var type1" id="S112T34U1587">makerTrackThreshold</span> )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,381" id="srcline381">381</a></span><span class="line"><span class="mxinfo" id="T2:U100"><span class="mxinfo" id="T2:U101"><span class="var type1" id="S105T51U1591">JudgeIndex</span>.dPi_ConJudge</span> = <span class="var type1" id="S128T2U1593">dPi_ConJudge</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,382" id="srcline382">382</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,383" id="srcline383">383</a></span><span class="line"><span class="comment">%% dT 时间段的位移差：只考虑位移矢量大小</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,384" id="srcline384">384</a></span><span class="line"><span class="comment">% 如果 vision_dT_k_last 没跟踪成功，把时间往前推直到找到跟踪成功的点。但是不能往前推超过 Max_dT 时间。搜索了</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,385" id="srcline385">385</a></span><span class="line"><span class="comment">% Max_dT时间还没有找到的话，</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,386" id="srcline386">386</a></span><span class="line"><span class="keyword">while</span> <span class="mxinfo" id="T19:U104"><span class="var type1" id="S120T2U1597">vision_dT_k_last</span>&gt;<span class="mxinfo" id="T2:U106">1</span></span> &amp;&amp; <span class="mxinfo" id="T19:U107">isnan( <span class="mxinfo" id="T2:U108"><span class="var type1" id="S109T44U1602">trackedMakerPosition</span>(<span class="mxinfo" id="T2:U110">1</span>,<span class="var type1" id="S120T2U1604">vision_dT_k_last</span>)</span> )</span> <span class="comment">% trackedMakerPosition(1) 必须已知（不为nan）</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,387" id="srcline387">387</a></span><span class="line">    <span class="mxinfo" id="T2:U112"><span class="var type1" id="S120T2U1607">vision_dT_k_last</span> = <span class="mxinfo" id="T2:U114"><span class="var type1" id="S120T2U1609">vision_dT_k_last</span>-<span class="mxinfo" id="T2:U116">1</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,388" id="srcline388">388</a></span><span class="line">    <span class="mxinfo" id="T4:U117"><span class="var type1" id="S111T4U1613">inertial_dT_k_last</span> = <span class="mxinfo" id="T4:U119">int32(<span class="mxinfo" id="T2:U120"><span class="var type1" id="S117T15U1617">VisionData_inertial_k</span>(<span class="var type1" id="S120T2U1618">vision_dT_k_last</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,389" id="srcline389">389</a></span><span class="line">    <span class="mxinfo" id="T4:U123"><span class="var type1" id="S111T4U1621">inertial_dT_k_last</span> = <span class="mxinfo" id="T4:U125">max(<span class="var type1" id="S111T4U1624">inertial_dT_k_last</span>,<span class="mxinfo" id="T2:U127">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,390" id="srcline390">390</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T19:U128"><span class="mxinfo" id="T4:U129">(<span class="mxinfo" id="T2:U130"><span class="var type1" id="S107T4U1632">k_vision</span>-<span class="var type1" id="S120T2U1633">vision_dT_k_last</span></span>)/<span class="var type1" id="S114T2U1634">visionFre</span></span> &gt; <span class="mxinfo" id="T2:U134"><span class="var type1" id="S112T34U1636">makerTrackThreshold</span>.MaxMoveTime</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,391" id="srcline391">391</a></span><span class="line"><span class="comment">%         fprintf( '放弃搜索，作为新点重新搜索  k_vision = %d , vision_dT_k_last = %d \n',k_vision,vision_dT_k_last );</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,392" id="srcline392">392</a></span><span class="line">        <span class="keyword">break</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,393" id="srcline393">393</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,394" id="srcline394">394</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,395" id="srcline395">395</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T19:U136">isnan( <span class="mxinfo" id="T2:U137"><span class="var type1" id="S109T44U1644">trackedMakerPosition</span>(<span class="mxinfo" id="T2:U139">1</span>,<span class="var type1" id="S120T2U1646">vision_dT_k_last</span>)</span> )</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,396" id="srcline396">396</a></span><span class="line">    <span class="comment">%% 寻找第一个点（第一个点：怎么都找不到之前跟踪成功的点）</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,397" id="srcline397">397</a></span><span class="line">    <span class="comment">% 用其他连续点计算，分析当前马克点中每一个连续点，如果某个连续点的 dT 判断通过，则认为这是第一个点</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,398" id="srcline398">398</a></span><span class="line">    <span class="mxinfo" id="T2:U141"><span class="var type1" id="S132T2U1649">IsSearchingFirst</span> = <span class="mxinfo" id="T2:U143">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,399" id="srcline399">399</a></span><span class="line">    <span class="mxinfo" id="T4:U144"><span class="keyword">for</span> <span class="var type1" id="S133T4U1653">i</span>=<span class="mxinfo" id="T4:U146">1</span>:<span class="var type1" id="S127T4U1656">M</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,400" id="srcline400">400</a></span><span class="line"><span class="mxinfo" id="T4:U144">        <span class="keyword">if</span>  <span class="mxinfo" id="T19:U148"><span class="mxinfo" id="T2:U149"><span class="mxinfo" id="T7:U150"><span class="var type1" id="S103T41U1663">otherMakers_k</span>.ContinuesFlag</span>(<span class="var type1" id="S133T4U1665">i</span>)</span> == <span class="mxinfo" id="T2:U153">2</span></span> || <span class="mxinfo" id="T19:U154"><span class="mxinfo" id="T2:U155"><span class="mxinfo" id="T7:U156"><span class="var type1" id="S103T41U1670">otherMakers_k</span>.ContinuesFlag</span>(<span class="var type1" id="S133T4U1672">i</span>)</span> == <span class="mxinfo" id="T2:U159">1</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,401" id="srcline401">401</a></span><span class="line"><span class="mxinfo" id="T4:U144">            <span class="mxinfo" id="T2:U160"><span class="var type1" id="S132T2U1676">IsSearchingFirst</span> = <span class="mxinfo" id="T2:U162">1</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,402" id="srcline402">402</a></span><span class="line"><span class="mxinfo" id="T4:U144">            </span><span class="comment"><span class="mxinfo" id="T4:U144">% 第一个马克点搜索的关键：以当前马克点对应的连续点假设为跟踪成功点</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,403" id="srcline403">403</a></span><span class="line"><span class="mxinfo" id="T4:U144">            <span class="mxinfo" id="T6:U163"><span class="var type1" id="S134T6U1680">trackedMakerPosition_last_k_dT</span> = <span class="mxinfo" id="T6:U165"><span class="mxinfo" id="T3:U166"><span class="var type1" id="S103T41U1683">otherMakers_k</span>.ContinuesLastPosition</span>(:,<span class="var type1" id="S133T4U1686">i</span>)</span></span> ;</span> </span></span>
<span class="srcline"><span class="lineno"><a href="49,404" id="srcline404">404</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="49,405" id="srcline405">405</a></span><span class="line"><span class="mxinfo" id="T4:U144">            <span class="mxinfo" id="T39:U169">[ <span class="var type1" id="S102T73U1690">trackedMakerPosition_k_OK</span>,<span class="var type1" id="S104T2U1691">TrackFlag</span>,<span class="var type1" id="S135T2U1692">min_dT_k</span>,<span class="var type1" id="S136T2U1693">dPError_dT_xy</span>,<span class="var type1" id="S137T2U1694">dPError_dT_z</span>,<span class="var type1" id="S138T2U1695">dP_Inertial_xyNorm</span>,<span class="var type1" id="S139T2U1696">angleErr_dT_Min</span> ] = <span class="fcn" id="F273N24:B1698">Track_dT_Judge</span><span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,406" id="srcline406">406</a></span><span class="line"><span class="mxinfo" id="T4:U144"><span class="mxinfo" id="T39:U169">                ( <span class="var type1" id="S103T41U1699">otherMakers_k</span>,<span class="var type1" id="S110T13U1700">InertialPosition</span>,<span class="var type1" id="S108T4U1701">inertial_k</span>,<span class="var type1" id="S111T4U1702">inertial_dT_k_last</span>,<span class="var type1" id="S134T6U1703">trackedMakerPosition_last_k_dT</span>,<span class="var type1" id="S112T34U1704">makerTrackThreshold</span> )</span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,407" id="srcline407">407</a></span><span class="line"><span class="mxinfo" id="T4:U144">            <span class="mxinfo" id="T2:U183"><span class="mxinfo" id="T2:U184"><span class="var type1" id="S105T51U1708">JudgeIndex</span>.dPError_dT_xy</span> = <span class="var type1" id="S136T2U1710">dPError_dT_xy</span></span> ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,408" id="srcline408">408</a></span><span class="line"><span class="mxinfo" id="T4:U144">            <span class="mxinfo" id="T2:U187"><span class="mxinfo" id="T2:U188"><span class="var type1" id="S105T51U1714">JudgeIndex</span>.dPError_dT_z</span> = <span class="var type1" id="S137T2U1716">dPError_dT_z</span></span> ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,409" id="srcline409">409</a></span><span class="line"><span class="mxinfo" id="T4:U144">            <span class="mxinfo" id="T2:U191"><span class="mxinfo" id="T2:U192"><span class="var type1" id="S105T51U1720">JudgeIndex</span>.dP_Inertial_xyNorm</span> = <span class="var type1" id="S138T2U1722">dP_Inertial_xyNorm</span></span> ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,410" id="srcline410">410</a></span><span class="line"><span class="mxinfo" id="T4:U144">            <span class="mxinfo" id="T2:U195"><span class="mxinfo" id="T2:U196"><span class="var type1" id="S105T51U1726">JudgeIndex</span>.angleErr_dT_Min</span> = <span class="var type1" id="S139T2U1728">angleErr_dT_Min</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,411" id="srcline411">411</a></span><span class="line">     </span></span>
<span class="srcline"><span class="lineno"><a href="49,412" id="srcline412">412</a></span><span class="line"><span class="mxinfo" id="T4:U144">            <span class="keyword">if</span> <span class="mxinfo" id="T19:U199">~<span class="mxinfo" id="T19:U200">isnan(<span class="mxinfo" id="T2:U201"><span class="var type1" id="S102T73U1736">trackedMakerPosition_k_OK</span>(<span class="mxinfo" id="T2:U203">1</span>)</span>)</span></span> &amp;&amp; <span class="mxinfo" id="T19:U204"><span class="var type1" id="S115T2U1739">IsGetFirstMarker</span> == <span class="mxinfo" id="T2:U206">0</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,413" id="srcline413">413</a></span><span class="line"><span class="mxinfo" id="T4:U144">                <span class="mxinfo" id="T2:U207"><span class="var type1" id="S115T2U1743">IsGetFirstMarker</span> = <span class="mxinfo" id="T2:U209">1</span></span> ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,414" id="srcline414">414</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="49,415" id="srcline415">415</a></span><span class="line"><span class="mxinfo" id="T4:U144">                <span class="mxinfo" id="T90:U210"><span class="extrinsicFcn" id="F562N42:B1747">fprintf</span>( <span class="mxinfo" id="T94:U211"><span class="string">'第一个点搜素成功 time = %0.1f sec, TrackFlag(%d) = %0.1f \n'</span></span>,<span class="mxinfo" id="T4:U212"><span class="var type1" id="S107T4U1750">k_vision</span>/<span class="var type1" id="S114T2U1751">visionFre</span></span>,<span class="var type1" id="S107T4U1752">k_vision</span>,<span class="var type1" id="S104T2U1753">TrackFlag</span> )</span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,416" id="srcline416">416</a></span><span class="line"><span class="mxinfo" id="T4:U144">                <span class="mxinfo" id="T90:U217"><span class="extrinsicFcn" id="F563N42:B1756">fprintf</span>(<span class="mxinfo" id="T95:U218"><span class="string">' dPError_dT_xy = %0.3f,  dPError_dT_z = %0.3f \n '</span></span>,<span class="var type1" id="S136T2U1758">dPError_dT_xy</span>,<span class="var type1" id="S137T2U1759">dPError_dT_z</span>)</span>;</span> </span></span>
<span class="srcline"><span class="lineno"><a href="49,417" id="srcline417">417</a></span><span class="line"><span class="mxinfo" id="T4:U144">               <span class="keyword">return</span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,418" id="srcline418">418</a></span><span class="line"><span class="mxinfo" id="T4:U144">            <span class="keyword">end</span></span>       </span></span>
<span class="srcline"><span class="lineno"><a href="49,419" id="srcline419">419</a></span><span class="line"><span class="mxinfo" id="T4:U144">        <span class="keyword">end</span></span>        </span></span>
<span class="srcline"><span class="lineno"><a href="49,420" id="srcline420">420</a></span><span class="line"><span class="mxinfo" id="T4:U144">    <span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,421" id="srcline421">421</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T19:U221"><span class="var type1" id="S132T2U1764">IsSearchingFirst</span>==<span class="mxinfo" id="T2:U223">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,422" id="srcline422">422</a></span><span class="line">        <span class="comment">% 既找不到之前跟踪成功的点，又找不到连续的点，继续找</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,423" id="srcline423">423</a></span><span class="line"><span class="comment">%         fprintf('搜索第一个点：等待足够多连续性的点 k_vision = %d \n ',k_vision)</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,424" id="srcline424">424</a></span><span class="line">        <span class="keyword">return</span>; </span></span>
<span class="srcline"><span class="lineno"><a href="49,425" id="srcline425">425</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,426" id="srcline426">426</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,427" id="srcline427">427</a></span><span class="line">    <span class="comment">% 之前有跟踪成功的数据</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,428" id="srcline428">428</a></span><span class="line">    <span class="mxinfo" id="T6:U224"><span class="var type1" id="S134T6U1770">trackedMakerPosition_last_k_dT</span> = <span class="mxinfo" id="T6:U226"><span class="var type1" id="S109T44U1772">trackedMakerPosition</span>(:,<span class="var type1" id="S120T2U1774">vision_dT_k_last</span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,429" id="srcline429">429</a></span><span class="line">    <span class="mxinfo" id="T39:U229">[ <span class="var type1" id="S102T73U1778">trackedMakerPosition_k_OK</span>,<span class="var type1" id="S104T2U1779">TrackFlag</span>,<span class="var type1" id="S135T2U1780">min_dT_k</span>,<span class="var type1" id="S136T2U1781">dPError_dT_xy</span>,<span class="var type1" id="S137T2U1782">dPError_dT_z</span>,<span class="var type1" id="S138T2U1783">dP_Inertial_xyNorm</span>,<span class="var type1" id="S139T2U1784">angleErr_dT_Min</span> ] = <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,430" id="srcline430">430</a></span><span class="line"><span class="mxinfo" id="T39:U229">        <span class="fcn" id="F273N24:B1786">Track_dT_Judge</span>( <span class="var type1" id="S103T41U1787">otherMakers_k</span>,<span class="var type1" id="S110T13U1788">InertialPosition</span>,<span class="var type1" id="S108T4U1789">inertial_k</span>,<span class="var type1" id="S111T4U1790">inertial_dT_k_last</span>,<span class="var type1" id="S134T6U1791">trackedMakerPosition_last_k_dT</span>,<span class="var type1" id="S112T34U1792">makerTrackThreshold</span> )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,431" id="srcline431">431</a></span><span class="line">    <span class="mxinfo" id="T2:U243"><span class="mxinfo" id="T2:U244"><span class="var type1" id="S105T51U1796">JudgeIndex</span>.dPError_dT_xy</span> = <span class="var type1" id="S136T2U1798">dPError_dT_xy</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,432" id="srcline432">432</a></span><span class="line">    <span class="mxinfo" id="T2:U247"><span class="mxinfo" id="T2:U248"><span class="var type1" id="S105T51U1802">JudgeIndex</span>.dPError_dT_z</span> = <span class="var type1" id="S137T2U1804">dPError_dT_z</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,433" id="srcline433">433</a></span><span class="line">    <span class="mxinfo" id="T2:U251"><span class="mxinfo" id="T2:U252"><span class="var type1" id="S105T51U1808">JudgeIndex</span>.dP_Inertial_xyNorm</span> = <span class="var type1" id="S138T2U1810">dP_Inertial_xyNorm</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,434" id="srcline434">434</a></span><span class="line">    <span class="mxinfo" id="T2:U255"><span class="mxinfo" id="T2:U256"><span class="var type1" id="S105T51U1814">JudgeIndex</span>.angleErr_dT_Min</span> = <span class="var type1" id="S139T2U1816">angleErr_dT_Min</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,435" id="srcline435">435</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,436" id="srcline436">436</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T19:U259">~<span class="mxinfo" id="T19:U260">isnan(<span class="mxinfo" id="T2:U261"><span class="var type1" id="S102T73U1823">trackedMakerPosition_k_OK</span>(<span class="mxinfo" id="T2:U263">1</span>)</span>)</span></span>    </span></span>
<span class="srcline"><span class="lineno"><a href="49,437" id="srcline437">437</a></span><span class="line">   <span class="keyword">return</span>;  <span class="comment">% 跟踪OK </span></span></span>
<span class="srcline"><span class="lineno"><a href="49,438" id="srcline438">438</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,439" id="srcline439">439</a></span><span class="line"><span class="mxinfo" id="T6:U264"><span class="var type1" id="S142T6U1828">otherMakersPosition_k_min</span> = <span class="mxinfo" id="T6:U266"><span class="var type1" id="S123T3U1830">otherMakersPosition_k</span>(:,<span class="var type1" id="S135T2U1832">min_dT_k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="49,440" id="srcline440">440</a></span><span class="line">      </span></span>
<span class="srcline"><span class="lineno"><a href="49,441" id="srcline441">441</a></span><span class="line"><span class="comment">%% dS 位移长度段的位移差：同时考虑位移差大小和方向</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,442" id="srcline442">442</a></span><span class="line"><span class="mxinfo" id="T39:U269">[ <span class="var type1" id="S102T73U1836">trackedMakerPosition_k_OK</span>,<span class="var type1" id="S104T2U1837">TrackFlag</span>,<span class="var type1" id="S143T2U1838">dPError_dS_xyNorm</span>,<span class="var type1" id="S144T2U1839">angleErr_dS</span> ] = <span class="fcn" id="F284N23:B1841">Track_dS_Judge</span><span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="49,443" id="srcline443">443</a></span><span class="line"><span class="mxinfo" id="T39:U269">    ( <span class="var type1" id="S110T13U1842">InertialPosition</span>,<span class="var type1" id="S108T4U1843">inertial_k</span>,<span class="var type1" id="S109T44U1844">trackedMakerPosition</span>,<span class="var type1" id="S142T6U1845">otherMakersPosition_k_min</span>,<span class="var type1" id="S104T2U1846">TrackFlag</span>,<span class="var type1" id="S112T34U1847">makerTrackThreshold</span> )</span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,444" id="srcline444">444</a></span><span class="line"><span class="mxinfo" id="T2:U280"><span class="mxinfo" id="T2:U281"><span class="var type1" id="S105T51U1851">JudgeIndex</span>.dPError_dS_xyNorm</span> = <span class="var type1" id="S143T2U1853">dPError_dS_xyNorm</span></span>  ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,445" id="srcline445">445</a></span><span class="line"><span class="mxinfo" id="T2:U284"><span class="mxinfo" id="T2:U285"><span class="var type1" id="S105T51U1857">JudgeIndex</span>.angleErr_dS</span> = <span class="var type1" id="S144T2U1859">angleErr_dS</span></span>  ;</span></span>
<span class="srcline"><span class="lineno"><a href="49,446" id="srcline446">446</a></span><span class="line"><span class="comment">%% 高度判定</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,447" id="srcline447">447</a></span><span class="line"><span class="comment">% （1.1）惯性目标关节与视觉目标马克点高度差（INSVNSMarkHC） =  INSVNSMarkL *</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,448" id="srcline448">448</a></span><span class="line"><span class="comment">% cos(thita)。INSVNSMarkL 为常数，在初始时刻刻计算得到。</span></span></span>
<span class="srcline"><span class="lineno"><a href="49,449" id="srcline449">449</a></span><span class="line"><span class="comment">%  INSVNSMarkHC 计算方法：当前高度-直立时的高度</span></span></span>
</pre>
