<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="56,436" id="srcline436">436</a></span><span class="line"><span class="comment">%% 高度判定</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,437" id="srcline437">437</a></span><span class="line"><span class="comment">% （1.1）惯性目标关节与视觉目标马克点高度差（INSVNSMarkHC） =  INSVNSMarkL *</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,438" id="srcline438">438</a></span><span class="line"><span class="comment">% cos(thita)。INSVNSMarkL 为常数，在初始时刻刻计算得到。</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,439" id="srcline439">439</a></span><span class="line"><span class="comment">%  INSVNSMarkHC 计算方法：当前高度-直立时的高度</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,440" id="srcline440">440</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S143T47U1402">otherMakers_k</span>,<span class="var type1" id="S144T2U1403">trackedMakerPosition_k_OK</span>,<span class="var type1" id="S145T2U1404">TrackFlag</span>,<span class="var type1" id="S146T2U1405">INSVNSMarkHC_Min</span> ] = Track_High_Judge<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,441" id="srcline441">441</a></span><span class="line">    ( <span class="mxinfo" id="T47:U5"><span class="mxinfo" id="T47:U6"><span class="var type1" id="S143T47U1408">otherMakers_k</span></span></span>,<span class="var type1" id="S147T4U1409">inertial_k</span>,<span class="var type1" id="S148T12U1410">InertialPosition</span>,<span class="var type1" id="S149T41U1411">makerTrackThreshold</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="56,442" id="srcline442">442</a></span><span class="line"> <span class="mxinfo" id="T2:U11"><span class="var type1" id="S150T2U1414">INSMarkH0</span>  = <span class="mxinfo" id="T2:U13"><span class="var type1" id="S149T41U1416">makerTrackThreshold</span>.INSMarkH0</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,443" id="srcline443">443</a></span><span class="line"> <span class="mxinfo" id="T2:U15"><span class="var type1" id="S151T2U1420">VNSMarkH0</span> = <span class="mxinfo" id="T2:U17"><span class="var type1" id="S149T41U1422">makerTrackThreshold</span>.VNSMarkH0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,444" id="srcline444">444</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,445" id="srcline445">445</a></span><span class="line"><span class="mxinfo" id="T2:U19"><span class="var type1" id="S144T2U1426">trackedMakerPosition_k_OK</span> = <span class="mxinfo" id="T2:U21">NaN</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,446" id="srcline446">446</a></span><span class="line"><span class="mxinfo" id="T2:U22"><span class="var type1" id="S146T2U1431">INSVNSMarkHC_Min</span> = <span class="mxinfo" id="T2:U24">NaN</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,447" id="srcline447">447</a></span><span class="line"><span class="mxinfo" id="T2:U25"><span class="var type1" id="S145T2U1436">TrackFlag</span> = <span class="mxinfo" id="T2:U27">0</span></span> ;    </span></span>
<span class="srcline"><span class="lineno"><a href="56,448" id="srcline448">448</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T14:U28">isnan(<span class="var type1" id="S150T2U1442">INSMarkH0</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,449" id="srcline449">449</a></span><span class="line">       </span></span>
<span class="srcline"><span class="lineno"><a href="56,450" id="srcline450">450</a></span><span class="line">    <span class="keyword">return</span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,451" id="srcline451">451</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,452" id="srcline452">452</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,453" id="srcline453">453</a></span><span class="line"><span class="mxinfo" id="T4:U30"><span class="var type1" id="S154T4U1446">M</span> = <span class="mxinfo" id="T4:U32"><span class="var type1" id="S143T47U1448">otherMakers_k</span>.otherMakersN</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,454" id="srcline454">454</a></span><span class="line"><span class="mxinfo" id="T3:U34"><span class="var type1" id="S155T3U1452">otherMakersPosition_k</span> = <span class="mxinfo" id="T3:U36"><span class="var type1" id="S143T47U1454">otherMakers_k</span>.Position</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,455" id="srcline455">455</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,456" id="srcline456">456</a></span><span class="line"><span class="mxinfo" id="T51:U38"><span class="var type1" id="S156T51U1458">INSVNSMarkHC</span> = <span class="mxinfo" id="T51:U40">zeros(<span class="mxinfo" id="T2:U41">1</span>,<span class="var type1" id="S154T4U1462">M</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,457" id="srcline457">457</a></span><span class="line"><span class="mxinfo" id="T4:U43"><span class="keyword">for</span> <span class="var type1" id="S158T4U1465">i</span>=<span class="mxinfo" id="T4:U45">1</span>:<span class="var type1" id="S154T4U1468">M</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,458" id="srcline458">458</a></span><span class="line"><span class="mxinfo" id="T4:U43">    <span class="mxinfo" id="T2:U47"><span class="mxinfo" id="T2:U48"><span class="var type1" id="S156T51U1472">INSVNSMarkHC</span>(<span class="var type1" id="S158T4U1473">i</span>)</span> = <span class="mxinfo" id="T2:U51">( <span class="mxinfo" id="T2:U52"><span class="mxinfo" id="T2:U53">-<span class="mxinfo" id="T2:U54"><span class="var type1" id="S148T12U1479">InertialPosition</span>(<span class="mxinfo" id="T2:U56">3</span>,<span class="var type1" id="S147T4U1481">inertial_k</span>)</span></span> + <span class="mxinfo" id="T2:U58"><span class="var type1" id="S155T3U1483">otherMakersPosition_k</span>(<span class="mxinfo" id="T2:U60">3</span>,<span class="var type1" id="S158T4U1485">i</span>)</span></span> )-( <span class="mxinfo" id="T2:U62"><span class="var type1" id="S150T2U1488">INSMarkH0</span>-<span class="var type1" id="S151T2U1489">VNSMarkH0</span></span> )</span></span> ;</span>   </span></span>
<span class="srcline"><span class="lineno"><a href="56,459" id="srcline459">459</a></span><span class="line"><span class="mxinfo" id="T4:U43"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,460" id="srcline460">460</a></span><span class="line"><span class="comment">% 高度差最小的点</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,461" id="srcline461">461</a></span><span class="line"><span class="mxinfo" id="T2:U65">[ <span class="var type1" id="S146T2U1493">INSVNSMarkHC_Min</span>,<span class="var type1" id="S159T2U1494">min_i</span> ] = min( <span class="mxinfo" id="T51:U68">abs(<span class="var type1" id="S156T51U1499">INSVNSMarkHC</span>)</span> )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,462" id="srcline462">462</a></span><span class="line"><span class="comment">% 将高度差误差大的点剔除</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,463" id="srcline463">463</a></span><span class="line"><span class="mxinfo" id="T2:U70"><span class="var type1" id="S162T2U1502">invalid_i</span> = <span class="mxinfo" id="T2:U72">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,464" id="srcline464">464</a></span><span class="line"><span class="mxinfo" id="T4:U73"><span class="keyword">for</span> <span class="var type1" id="S158T4U1506">i</span>=<span class="mxinfo" id="T4:U75">1</span>:<span class="var type1" id="S154T4U1509">M</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,465" id="srcline465">465</a></span><span class="line"><span class="mxinfo" id="T4:U73">    <span class="keyword">if</span> <span class="mxinfo" id="T14:U77"><span class="mxinfo" id="T2:U78">abs(<span class="mxinfo" id="T2:U79"><span class="var type1" id="S156T51U1516">INSVNSMarkHC</span>(<span class="var type1" id="S158T4U1517">i</span>)</span>)</span> &gt; <span class="mxinfo" id="T2:U82"><span class="var type1" id="S149T41U1519">makerTrackThreshold</span>.MaxMarkHighChange</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,466" id="srcline466">466</a></span><span class="line"><span class="mxinfo" id="T4:U73">        </span><span class="comment"><span class="mxinfo" id="T4:U73">% 将高度差误差大的点剔除</span>       </span></span></span>
<span class="srcline"><span class="lineno"><a href="56,467" id="srcline467">467</a></span><span class="line"><span class="mxinfo" id="T4:U73">        <span class="mxinfo" id="T3:U84"><span class="var type1" id="S163T3U1523">Position_Old</span> = <span class="mxinfo" id="T3:U86"><span class="var type1" id="S143T47U1525">otherMakers_k</span>.Position</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,468" id="srcline468">468</a></span><span class="line"><span class="mxinfo" id="T4:U73">        <span class="mxinfo" id="T3:U88"><span class="mxinfo" id="T3:U89"><span class="var type1" id="S143T47U1530">otherMakers_k</span>.Position</span> = <span class="mxinfo" id="T3:U91"><span class="fcn" id="F234N20:B1533">RemoveOtherMarkers_Position</span>( <span class="var type1" id="S163T3U1534">Position_Old</span>,<span class="mxinfo" id="T2:U93"><span class="var type1" id="S158T4U1536">i</span>-<span class="var type1" id="S162T2U1537">invalid_i</span></span>,<span class="mxinfo" id="T4:U96"><span class="var type1" id="S143T47U1539">otherMakers_k</span>.otherMakersN</span> )</span></span>;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,469" id="srcline469">469</a></span><span class="line"><span class="mxinfo" id="T4:U73">        <span class="mxinfo" id="T4:U98"><span class="mxinfo" id="T4:U99"><span class="var type1" id="S143T47U1544">otherMakers_k</span>.otherMakersN</span> = <span class="mxinfo" id="T4:U101"><span class="mxinfo" id="T4:U102"><span class="var type1" id="S143T47U1548">otherMakers_k</span>.otherMakersN</span>-<span class="mxinfo" id="T4:U104">1</span></span></span> ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,470" id="srcline470">470</a></span><span class="line"><span class="mxinfo" id="T4:U73">        <span class="mxinfo" id="T2:U105"><span class="var type1" id="S162T2U1553">invalid_i</span> = <span class="mxinfo" id="T2:U107"><span class="var type1" id="S162T2U1555">invalid_i</span>+<span class="mxinfo" id="T2:U109">1</span></span></span> ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,471" id="srcline471">471</a></span><span class="line"><span class="mxinfo" id="T4:U73">    <span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,472" id="srcline472">472</a></span><span class="line"><span class="mxinfo" id="T4:U73"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,473" id="srcline473">473</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,474" id="srcline474">474</a></span><span class="line"><span class="comment">%% 通过高度剔除给踢完了</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,475" id="srcline475">475</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T14:U110"><span class="mxinfo" id="T4:U111"><span class="var type1" id="S143T47U1561">otherMakers_k</span>.otherMakersN</span> == <span class="mxinfo" id="T2:U113">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,476" id="srcline476">476</a></span><span class="line">   <span class="mxinfo" id="T2:U114"><span class="var type1" id="S145T2U1566">TrackFlag</span> = <span class="mxinfo" id="T2:U116">-<span class="mxinfo" id="T2:U117">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,477" id="srcline477">477</a></span><span class="line">   <span class="mxinfo" id="T2:U118"><span class="var type1" id="S144T2U1571">trackedMakerPosition_k_OK</span> = <span class="mxinfo" id="T2:U120">NaN</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,478" id="srcline478">478</a></span><span class="line">   <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,479" id="srcline479">479</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,480" id="srcline480">480</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,481" id="srcline481">481</a></span><span class="line"><span class="comment">%% 剔除 otherMakers_k.Position 中的第 i 个点</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,482" id="srcline482">482</a></span><span class="line"></span></span>
</pre>
