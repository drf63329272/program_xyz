<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,177" id="srcline177">177</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,178" id="srcline178">178</a></span><span class="line"><span class="comment">%% 视觉位置预处理</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,179" id="srcline179">179</a></span><span class="line"><span class="comment">% 1）将视觉数据转到惯性</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,180" id="srcline180">180</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,181" id="srcline181">181</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S60T1U545">otherMakers</span> = PreProcess( <span class="mxinfo" id="T1:U2"><span class="mxinfo" id="T1:U3"><span class="var type1" id="S60T1U548">otherMakers</span></span></span>,<span class="var type1" id="S61T6U549">BodyDirection</span>  )</span></span>
<span class="srcline"><span class="lineno"><a href="1,182" id="srcline182">182</a></span><span class="line">coder.inline(<span class="string">'never'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,183" id="srcline183">183</a></span><span class="line"><span class="keyword">global</span> <span class="var type0" id="S63T0U557">CalStartVN</span> <span class="var type0" id="S64T0U558">CalEndVN</span>   <span class="var type0" id="S65T0U559">IsOnLine</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,184" id="srcline184">184</a></span><span class="line"><span class="comment">%% 先转到北东地的同名坐标系</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,185" id="srcline185">185</a></span><span class="line"><span class="mxinfo" id="T29:U6"><span class="var type1" id="S66T29U562">Cv_r1</span> = <span class="mxinfo" id="T29:U8">[ 0 0 1; -1 0 0; 0 -1 0 ]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,186" id="srcline186">186</a></span><span class="line"><span class="comment">% dbstop in BodyDirection2Cr_r1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,187" id="srcline187">187</a></span><span class="line"><span class="mxinfo" id="T29:U9"><span class="var type1" id="S67T29U580">Cr_r1</span> = <span class="mxinfo" id="T29:U11"><span class="fcn" id="F4N12:B582">BodyDirection2Cr_r1</span>( <span class="var type1" id="S61T6U583">BodyDirection</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,188" id="srcline188">188</a></span><span class="line"><span class="mxinfo" id="T29:U13"><span class="var type1" id="S69T29U586">Cvr</span> = <span class="mxinfo" id="T29:U15"><span class="mxinfo" id="T29:U16"><span class="var type1" id="S67T29U589">Cr_r1</span>'</span> * <span class="mxinfo" id="T29:U18"><span class="var type1" id="S66T29U590">Cv_r1</span></span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,189" id="srcline189">189</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,190" id="srcline190">190</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,191" id="srcline191">191</a></span><span class="line"><span class="comment">%% 先转到 惯性系 的北东地，并以视觉的初始点为原点（不处理高度）</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,192" id="srcline192">192</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,193" id="srcline193">193</a></span><span class="line"><span class="mxinfo" id="T6:U20"><span class="var type1" id="S70T6U593">Position_1</span> = <span class="mxinfo" id="T6:U22"><span class="mxinfo" id="T3:U23"><span class="mxinfo" id="T47:U24"><span class="var type1" id="S60T1U597">otherMakers</span>(<span class="mxinfo" id="T2:U26">1</span>)</span>.Position</span>(:,<span class="mxinfo" id="T2:U27">1</span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,194" id="srcline194">194</a></span><span class="line"><span class="mxinfo" id="T2:U28"><span class="mxinfo" id="T2:U29"><span class="var type1" id="S70T6U605">Position_1</span>(<span class="mxinfo" id="T2:U31">2</span>)</span> = <span class="mxinfo" id="T2:U32">0</span></span> ;      <span class="comment">% 不处理高度方向</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,195" id="srcline195">195</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,196" id="srcline196">196</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S71T2U610">k</span>=<span class="var type1" id="S63T2U612">CalStartVN</span>:<span class="var type1" id="S64T2U613">CalEndVN</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,197" id="srcline197">197</a></span><span class="line">    <span class="mxinfo" id="T3:U36"><span class="var type1" id="S72T3U616">Position_k</span> = <span class="mxinfo" id="T3:U38"><span class="mxinfo" id="T47:U39"><span class="var type1" id="S60T1U619">otherMakers</span>(<span class="var type1" id="S71T2U620">k</span>)</span>.Position</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,198" id="srcline198">198</a></span><span class="line">    <span class="keyword">if</span> ~isempty(<span class="var type1" id="S72T3U627">Position_k</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,199" id="srcline199">199</a></span><span class="line">        <span class="mxinfo" id="T2:U43"><span class="var type1" id="S74T2U630">m</span> = <span class="mxinfo" id="T2:U45">size(<span class="var type1" id="S72T3U633">Position_k</span>,2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,200" id="srcline200">200</a></span><span class="line">        <span class="mxinfo" id="T3:U47"><span class="var type1" id="S76T3U637">Position_1_m</span> = <span class="mxinfo" id="T3:U49">repmat(<span class="var type1" id="S70T6U640">Position_1</span>,1,<span class="var type1" id="S74T2U642">m</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,201" id="srcline201">201</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,202" id="srcline202">202</a></span><span class="line">        <span class="mxinfo" id="T3:U52"><span class="var type1" id="S78T3U645">Position_k_new</span> = <span class="mxinfo" id="T3:U54"><span class="var type1" id="S69T29U647">Cvr</span>*(<span class="mxinfo" id="T3:U56"><span class="var type1" id="S72T3U650">Position_k</span>-<span class="var type1" id="S76T3U651">Position_1_m</span></span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="1,203" id="srcline203">203</a></span><span class="line">        <span class="mxinfo" id="T3:U59"><span class="mxinfo" id="T3:U60"><span class="mxinfo" id="T47:U61"><span class="var type1" id="S60T1U656">otherMakers</span>(<span class="var type1" id="S71T2U657">k</span>)</span>.Position</span> = <span class="var type1" id="S78T3U659">Position_k_new</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,204" id="srcline204">204</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,205" id="srcline205">205</a></span><span class="line">        <span class="var type0" id="S60T0U665">otherMakers</span>(<span class="var type0" id="S71T0U666">k</span>).Position = NaN(3,1); </span></span>
<span class="srcline"><span class="lineno"><a href="1,206" id="srcline206">206</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,207" id="srcline207">207</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,208" id="srcline208">208</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,209" id="srcline209">209</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,210" id="srcline210">210</a></span><span class="line"><span class="comment">%% 根据 BodyDirection 求姿态</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,211" id="srcline211">211</a></span><span class="line"><span class="comment">% 符号有待验证！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,212" id="srcline212">212</a></span><span class="line"><span class="comment">%   BodyDirection  人朝北为 [1 0 0]</span></span></span>
</pre>
