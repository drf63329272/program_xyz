<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="143,39" id="srcline39"> 39</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="143,40" id="srcline40"> 40</a></span><span class="line"><span class="comment">% C:[3*3]</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,41" id="srcline41"> 41</a></span><span class="line"><span class="comment">% 第二个欧拉角定义范围 CosBeitaSign = 1： [ -pi/2,pi/2 ]</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">%                    CosBeitaSign = -1： [ -pi,-pi/2 ] [ pi/2,pi ]</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,43" id="srcline43"> 43</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S18T6U79">eulerOut</span> = C2Euler_One( <span class="var type1" id="S19T29U82">C</span>,<span class="mxinfo" id="T36:U3"><span class="var type2" id="S20T36V2U83">rotateOrder</span></span>,<span class="var type1" id="S21T13U84">rotateDirection</span>,<span class="var type1" id="S22T2U85">CosBeitaSign</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="143,44" id="srcline44"> 44</a></span><span class="line">coder.extrinsic(<span class="string">'format'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="143,45" id="srcline45"> 45</a></span><span class="line">format <span class="string">long</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,46" id="srcline46"> 46</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="143,47" id="srcline47"> 47</a></span><span class="line"><span class="keyword">if</span> isempty(<span class="var type1" id="S20T36U99">rotateOrder</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="143,48" id="srcline48"> 48</a></span><span class="line">    <span class="var type0" id="S20T0U102">rotateOrder</span> = <span class="string">'ZYX'</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,49" id="srcline49"> 49</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,50" id="srcline50"> 50</a></span><span class="line"><span class="keyword">if</span>  isempty(<span class="var type1" id="S21T13U108">rotateDirection</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="143,51" id="srcline51"> 51</a></span><span class="line">    <span class="var type0" id="S21T0U111">rotateDirection</span> = [1,1,1];</span></span>
<span class="srcline"><span class="lineno"><a href="143,52" id="srcline52"> 52</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,53" id="srcline53"> 53</a></span><span class="line"><span class="keyword">if</span> numel(<span class="var type1" id="S21T13U122">rotateDirection</span>)==1</span></span>
<span class="srcline"><span class="lineno"><a href="143,54" id="srcline54"> 54</a></span><span class="line">   <span class="var type0" id="S21T0U126">rotateDirection</span> = repmat(<span class="var type0" id="S21T0U129">rotateDirection</span>,1,3); </span></span>
<span class="srcline"><span class="lineno"><a href="143,55" id="srcline55"> 55</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,56" id="srcline56"> 56</a></span><span class="line"><span class="keyword">if</span>  isempty(<span class="var type1" id="S22T2U136">CosBeitaSign</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="143,57" id="srcline57"> 57</a></span><span class="line">    <span class="var type0" id="S22T0U139">CosBeitaSign</span> = 1 ;</span></span>
<span class="srcline"><span class="lineno"><a href="143,58" id="srcline58"> 58</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,59" id="srcline59"> 59</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="143,60" id="srcline60"> 60</a></span><span class="line"><span class="comment">%% calculate euler angles of " CosBeitaSign=1 "</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,61" id="srcline61"> 61</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="143,62" id="srcline62"> 62</a></span><span class="line"><span class="keyword">switch</span> <span class="var type1" id="S20T36U142">rotateOrder</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,63" id="srcline63"> 63</a></span><span class="line">    <span class="keyword">case</span> <span class="string">'ZYX'</span> </span></span>
<span class="srcline"><span class="lineno"><a href="143,64" id="srcline64"> 64</a></span><span class="line">        <span class="mxinfo" id="T2:U12"><span class="var type1" id="S28T2U147">euler1</span> = <span class="mxinfo" id="T2:U14">atan2( <span class="mxinfo" id="T2:U15"><span class="var type1" id="S19T29U151">C</span>(<span class="mxinfo" id="T2:U17">1</span>,<span class="mxinfo" id="T2:U18">2</span>)</span>,<span class="mxinfo" id="T2:U19"><span class="var type1" id="S19T29U155">C</span>(<span class="mxinfo" id="T2:U21">1</span>,<span class="mxinfo" id="T2:U22">1</span>)</span> )</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="143,65" id="srcline65"> 65</a></span><span class="line">        <span class="mxinfo" id="T2:U23"><span class="var type1" id="S30T2U160">euler2</span> = <span class="mxinfo" id="T2:U25">asin( <span class="mxinfo" id="T2:U26">-<span class="mxinfo" id="T2:U27"><span class="var type1" id="S19T29U165">C</span>(<span class="mxinfo" id="T2:U29">1</span>,<span class="mxinfo" id="T2:U30">3</span>)</span></span> )</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="143,66" id="srcline66"> 66</a></span><span class="line">        <span class="comment">% euler2 = atan2( -C(1,3),sqrt( C(3,2)^2+C(3,3)^2 ) ) ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,67" id="srcline67"> 67</a></span><span class="line">        <span class="mxinfo" id="T2:U31"><span class="var type1" id="S32T2U170">euler3</span> = <span class="mxinfo" id="T2:U33">atan2( <span class="mxinfo" id="T2:U34"><span class="var type1" id="S19T29U174">C</span>(<span class="mxinfo" id="T2:U36">2</span>,<span class="mxinfo" id="T2:U37">3</span>)</span>,<span class="mxinfo" id="T2:U38"><span class="var type1" id="S19T29U178">C</span>(<span class="mxinfo" id="T2:U40">3</span>,<span class="mxinfo" id="T2:U41">3</span>)</span> )</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="143,68" id="srcline68"> 68</a></span><span class="line">    <span class="keyword">case</span> <span class="string">'ZXY'</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,69" id="srcline69"> 69</a></span><span class="line">        <span class="var type0" id="S28T0U185">euler1</span> = atan2( -<span class="var type0" id="S19T0U190">C</span>(2,1),<span class="var type0" id="S19T0U194">C</span>(2,2) ) ;</span></span>
<span class="srcline"><span class="lineno"><a href="143,70" id="srcline70"> 70</a></span><span class="line">        <span class="var type0" id="S30T0U199">euler2</span> = asin( <span class="var type0" id="S19T0U203">C</span>(2,3) ) ;</span></span>
<span class="srcline"><span class="lineno"><a href="143,71" id="srcline71"> 71</a></span><span class="line">        <span class="comment">% euler2 = atan2( C(2,3),sqrt( C(2,1)^2+C(2,2)^2 ) ) ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,72" id="srcline72"> 72</a></span><span class="line">        <span class="var type0" id="S32T0U208">euler3</span> = atan2( -<span class="var type0" id="S19T0U213">C</span>(1,3),<span class="var type0" id="S19T0U217">C</span>(3,3) ) ;</span></span>
<span class="srcline"><span class="lineno"><a href="143,73" id="srcline73"> 73</a></span><span class="line">    <span class="keyword">case</span> <span class="string">'XYZ'</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,74" id="srcline74"> 74</a></span><span class="line">        <span class="var type0" id="S28T0U224">euler1</span> = atan2( -<span class="var type0" id="S19T0U229">C</span>(3,2),<span class="var type0" id="S19T0U233">C</span>(3,3) ) ;</span></span>
<span class="srcline"><span class="lineno"><a href="143,75" id="srcline75"> 75</a></span><span class="line">        <span class="var type0" id="S30T0U238">euler2</span> = asin(<span class="var type0" id="S19T0U242">C</span>(3,1)) ;</span></span>
<span class="srcline"><span class="lineno"><a href="143,76" id="srcline76"> 76</a></span><span class="line">        <span class="var type0" id="S32T0U247">euler3</span> = atan2( -<span class="var type0" id="S19T0U252">C</span>(2,1),<span class="var type0" id="S19T0U256">C</span>(1,1) ) ;</span></span>
<span class="srcline"><span class="lineno"><a href="143,77" id="srcline77"> 77</a></span><span class="line">    <span class="keyword">case</span> <span class="string">'XZY'</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,78" id="srcline78"> 78</a></span><span class="line">        <span class="var type0" id="S28T0U263">euler1</span> =  atan2(<span class="var type0" id="S19T0U267">C</span>(2,3),<span class="var type0" id="S19T0U271">C</span>(2,2)) ;</span></span>
<span class="srcline"><span class="lineno"><a href="143,79" id="srcline79"> 79</a></span><span class="line">        <span class="var type0" id="S30T0U276">euler2</span> =  asin(-<span class="var type0" id="S19T0U281">C</span>(2,1)) ;</span></span>
<span class="srcline"><span class="lineno"><a href="143,80" id="srcline80"> 80</a></span><span class="line">        <span class="var type0" id="S32T0U286">euler3</span> =  atan2(<span class="var type0" id="S19T0U290">C</span>(3,1),<span class="var type0" id="S19T0U294">C</span>(1,1)) ;</span></span>
<span class="srcline"><span class="lineno"><a href="143,81" id="srcline81"> 81</a></span><span class="line">    <span class="keyword">case</span> <span class="string">'YXZ'</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,82" id="srcline82"> 82</a></span><span class="line">        <span class="var type0" id="S28T0U301">euler1</span> = atan2( <span class="var type0" id="S19T0U305">C</span>(3,1),<span class="var type0" id="S19T0U309">C</span>(3,3) ) ;</span></span>
<span class="srcline"><span class="lineno"><a href="143,83" id="srcline83"> 83</a></span><span class="line">        <span class="var type0" id="S30T0U314">euler2</span> = asin( -<span class="var type0" id="S19T0U319">C</span>(3,2) ) ;</span></span>
<span class="srcline"><span class="lineno"><a href="143,84" id="srcline84"> 84</a></span><span class="line">        <span class="comment">% euler2 = atan2( -C(3,2),sqrt( C(1,2)^2+C(2,2)^2 ) ) ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,85" id="srcline85"> 85</a></span><span class="line">        <span class="var type0" id="S32T0U324">euler3</span> = atan2( <span class="var type0" id="S19T0U328">C</span>(1,2),<span class="var type0" id="S19T0U332">C</span>(2,2) ) ;        </span></span>
<span class="srcline"><span class="lineno"><a href="143,86" id="srcline86"> 86</a></span><span class="line">    <span class="keyword">case</span> <span class="string">'YZX'</span>  </span></span>
<span class="srcline"><span class="lineno"><a href="143,87" id="srcline87"> 87</a></span><span class="line">        <span class="var type0" id="S28T0U339">euler1</span> = atan2(-<span class="var type0" id="S19T0U344">C</span>(1,3),<span class="var type0" id="S19T0U348">C</span>(1,1))  ;</span></span>
<span class="srcline"><span class="lineno"><a href="143,88" id="srcline88"> 88</a></span><span class="line">        <span class="var type0" id="S30T0U353">euler2</span> = asin(<span class="var type0" id="S19T0U357">C</span>(1,2)) ;</span></span>
<span class="srcline"><span class="lineno"><a href="143,89" id="srcline89"> 89</a></span><span class="line">        <span class="var type0" id="S32T0U362">euler3</span> = atan2(-<span class="var type0" id="S19T0U367">C</span>(3,2),<span class="var type0" id="S19T0U371">C</span>(2,2)) ;</span></span>
<span class="srcline"><span class="lineno"><a href="143,90" id="srcline90"> 90</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,91" id="srcline91"> 91</a></span><span class="line"><span class="mxinfo" id="T6:U42"><span class="var type1" id="S33T6U376">euler</span> = <span class="mxinfo" id="T6:U44">[ <span class="var type1" id="S28T2U379">euler1</span>; <span class="var type1" id="S30T2U381">euler2</span>; <span class="var type1" id="S32T2U383">euler3</span> ]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,92" id="srcline92"> 92</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="143,93" id="srcline93"> 93</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S34T2U386">i</span>=<span class="mxinfo" id="T2:U49">1</span>:3</span></span>
<span class="srcline"><span class="lineno"><a href="143,94" id="srcline94"> 94</a></span><span class="line">    <span class="mxinfo" id="T2:U50"><span class="mxinfo" id="T2:U51"><span class="var type1" id="S33T6U393">euler</span>(<span class="var type1" id="S34T2U394">i</span>)</span> = <span class="mxinfo" id="T2:U54"><span class="mxinfo" id="T2:U55"><span class="var type1" id="S33T6U397">euler</span>(<span class="var type1" id="S34T2U398">i</span>)</span>*<span class="mxinfo" id="T2:U58"><span class="var type1" id="S21T13U400">rotateDirection</span>(<span class="var type1" id="S34T2U401">i</span>)</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="143,95" id="srcline95"> 95</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,96" id="srcline96"> 96</a></span><span class="line"><span class="mxinfo" id="T6:U61"><span class="var type1" id="S18T6U404">eulerOut</span> = <span class="var type1" id="S33T6U405">euler</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="143,97" id="srcline97"> 97</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="143,98" id="srcline98"> 98</a></span><span class="line"><span class="comment">% 第二个欧拉角定义范围 CosBeitaSign = 1： [ -pi/2,pi/2 ]</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,99" id="srcline99"> 99</a></span><span class="line"><span class="comment">%                    CosBeitaSign = -1： [ -pi,-pi/2 ] [ pi/2,pi ]</span></span></span>
<span class="srcline"><span class="lineno"><a href="143,100" id="srcline100">100</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T14:U64"><span class="var type1" id="S22T2U409">CosBeitaSign</span> == <span class="mxinfo" id="T2:U66">-<span class="mxinfo" id="T2:U67">1</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,101" id="srcline101">101</a></span><span class="line">    <span class="mxinfo" id="T2:U68"><span class="mxinfo" id="T2:U69"><span class="var type1" id="S18T6U415">eulerOut</span>(<span class="mxinfo" id="T2:U71">1</span>)</span> = <span class="mxinfo" id="T2:U72"><span class="mxinfo" id="T2:U73">pi</span>+<span class="mxinfo" id="T2:U74"><span class="var type1" id="S33T6U421">euler</span>(<span class="mxinfo" id="T2:U76">1</span>)</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="143,102" id="srcline102">102</a></span><span class="line">    <span class="mxinfo" id="T2:U77"><span class="mxinfo" id="T2:U78"><span class="var type1" id="S18T6U426">eulerOut</span>(<span class="mxinfo" id="T2:U80">2</span>)</span> = <span class="mxinfo" id="T2:U81"><span class="mxinfo" id="T2:U82">pi</span>-<span class="mxinfo" id="T2:U83"><span class="var type1" id="S33T6U432">euler</span>(<span class="mxinfo" id="T2:U85">2</span>)</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="143,103" id="srcline103">103</a></span><span class="line">    <span class="mxinfo" id="T2:U86"><span class="mxinfo" id="T2:U87"><span class="var type1" id="S18T6U437">eulerOut</span>(<span class="mxinfo" id="T2:U89">3</span>)</span> = <span class="mxinfo" id="T2:U90"><span class="mxinfo" id="T2:U91">pi</span>+<span class="mxinfo" id="T2:U92"><span class="var type1" id="S33T6U443">euler</span>(<span class="mxinfo" id="T2:U94">3</span>)</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="143,104" id="srcline104">104</a></span><span class="line">    <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="143,105" id="srcline105">105</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="143,106" id="srcline106">106</a></span><span class="line"></span></span>
</pre>
