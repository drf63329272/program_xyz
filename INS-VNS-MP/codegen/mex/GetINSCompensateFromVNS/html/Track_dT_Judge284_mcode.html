<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="56,525" id="srcline525">525</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,526" id="srcline526">526</a></span><span class="line"><span class="comment">%% 马克点判定 3) 短时间（dT=3）运动的过程，惯性和视觉位移差 dPError_dT 进行判定， dPError_dT(i) = normest(dP_Inertial-dP_Vision)</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,527" id="srcline527">527</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,528" id="srcline528">528</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S196T44U1766">trackedMakerPosition_k_OK</span>,<span class="var type1" id="S197T2U1767">TrackFlag</span>,<span class="var type1" id="S198T2U1768">min_dT_k</span>,<span class="var type1" id="S199T2U1769">dPErrorNorm_dT_Min</span>,<span class="var type1" id="S200T2U1770">dPError_dT_z_Min</span>,<span class="var type1" id="S201T2U1771">dP_Inertial_xyNorm_Min</span>,<span class="var type1" id="S202T2U1772">angleErr_dT_Min</span> ]<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,529" id="srcline529">529</a></span><span class="line">    = Track_dT_Judge( <span class="var type1" id="S203T47U1775">otherMakers_k</span>,<span class="var type1" id="S204T12U1776">InertialPosition</span>,<span class="var type1" id="S205T4U1777">inertial_k</span>,<span class="var type1" id="S206T4U1778">inertial_dT_k_last</span>,<span class="var type1" id="S207T6U1779">trackedMakerPosition_last_k_dT</span>,<span class="var type1" id="S208T41U1780">makerTrackThreshold</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="56,530" id="srcline530">530</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,531" id="srcline531">531</a></span><span class="line"><span class="comment">% global InertialData</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,532" id="srcline532">532</a></span><span class="line"><span class="mxinfo" id="T44:U14"><span class="var type1" id="S196T44U1783">trackedMakerPosition_k_OK</span> = <span class="mxinfo" id="T2:U16">NaN</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,533" id="srcline533">533</a></span><span class="line"><span class="mxinfo" id="T3:U17"><span class="var type1" id="S210T3U1788">otherMakersPosition_k</span> = <span class="mxinfo" id="T3:U19"><span class="var type1" id="S203T47U1790">otherMakers_k</span>.Position</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,534" id="srcline534">534</a></span><span class="line"><span class="mxinfo" id="T2:U21"><span class="var type1" id="S197T2U1794">TrackFlag</span> = <span class="mxinfo" id="T2:U23">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,535" id="srcline535">535</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,536" id="srcline536">536</a></span><span class="line"><span class="mxinfo" id="T2:U24"><span class="var type1" id="S211T2U1798">M</span> = <span class="mxinfo" id="T2:U26">size(<span class="var type1" id="S210T3U1801">otherMakersPosition_k</span>,2)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,537" id="srcline537">537</a></span><span class="line"><span class="mxinfo" id="T6:U28"><span class="var type1" id="S213T6U1805">dP_Inertial</span> = <span class="mxinfo" id="T6:U30"><span class="mxinfo" id="T6:U31"><span class="var type1" id="S204T12U1808">InertialPosition</span>(:,<span class="var type1" id="S205T4U1810">inertial_k</span>)</span> - <span class="mxinfo" id="T6:U34"><span class="var type1" id="S204T12U1812">InertialPosition</span>(:,<span class="var type1" id="S206T4U1814">inertial_dT_k_last</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,538" id="srcline538">538</a></span><span class="line"><span class="mxinfo" id="T45:U37"><span class="var type1" id="S214T45U1817">dP_Inertial_xy</span> = <span class="mxinfo" id="T45:U39"><span class="var type1" id="S213T6U1819">dP_Inertial</span>(<span class="mxinfo" id="T42:U41"><span class="mxinfo" id="T2:U42">1</span>:<span class="mxinfo" id="T2:U43">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,539" id="srcline539">539</a></span><span class="line"><span class="mxinfo" id="T2:U44"><span class="var type1" id="S215T2U1825">dP_Inertial_z</span> = <span class="mxinfo" id="T2:U46"><span class="var type1" id="S213T6U1827">dP_Inertial</span>(<span class="mxinfo" id="T2:U48">3</span>)</span></span>;  <span class="comment">% 向下为正</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,540" id="srcline540">540</a></span><span class="line"><span class="mxinfo" id="T7:U49"><span class="var type1" id="S216T7U1831">dPErrorNorm_dT</span>  = <span class="mxinfo" id="T7:U51">zeros(<span class="mxinfo" id="T2:U52">1</span>,<span class="mxinfo" id="T2:U53"><span class="var type1" id="S211T2U1835">M</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,541" id="srcline541">541</a></span><span class="line"><span class="mxinfo" id="T7:U55"><span class="var type1" id="S218T7U1838">dPError_dT_xy</span>  = <span class="mxinfo" id="T7:U57">zeros(<span class="mxinfo" id="T2:U58">1</span>,<span class="mxinfo" id="T2:U59"><span class="var type1" id="S211T2U1842">M</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,542" id="srcline542">542</a></span><span class="line"><span class="mxinfo" id="T7:U61"><span class="var type1" id="S219T7U1845">dPError_dT_z</span>  = <span class="mxinfo" id="T7:U63">zeros(<span class="mxinfo" id="T2:U64">1</span>,<span class="mxinfo" id="T2:U65"><span class="var type1" id="S211T2U1849">M</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,543" id="srcline543">543</a></span><span class="line"><span class="mxinfo" id="T3:U67"><span class="var type1" id="S220T3U1852">dP_Vision</span> = <span class="mxinfo" id="T3:U69">zeros(<span class="mxinfo" id="T2:U70">3</span>,<span class="mxinfo" id="T2:U71"><span class="var type1" id="S211T2U1856">M</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,544" id="srcline544">544</a></span><span class="line"><span class="mxinfo" id="T7:U73"><span class="var type1" id="S221T7U1859">angleErr_dT</span>  = <span class="mxinfo" id="T7:U75">NaN(<span class="mxinfo" id="T2:U76">1</span>,<span class="mxinfo" id="T2:U77"><span class="var type1" id="S211T2U1863">M</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,545" id="srcline545">545</a></span><span class="line"><span class="mxinfo" id="T2:U79"><span class="var type1" id="S202T2U1866">angleErr_dT_Min</span> = <span class="mxinfo" id="T2:U81">NaN</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,546" id="srcline546">546</a></span><span class="line"><span class="comment">%% 位移差 模， 角度差</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,547" id="srcline547">547</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S222T2U1871">i</span>=<span class="mxinfo" id="T2:U83">1</span>:<span class="var type1" id="S211T2U1874">M</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,548" id="srcline548">548</a></span><span class="line">    <span class="mxinfo" id="T6:U85"><span class="var type1" id="S223T6U1877">otherMakersPosition_k_i</span> = <span class="mxinfo" id="T6:U87"><span class="var type1" id="S210T3U1879">otherMakersPosition_k</span>(:,<span class="var type1" id="S222T2U1881">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,549" id="srcline549">549</a></span><span class="line">    <span class="mxinfo" id="T6:U90"><span class="mxinfo" id="T6:U91"><span class="var type1" id="S220T3U1885">dP_Vision</span>(:,<span class="var type1" id="S222T2U1887">i</span>)</span> = <span class="mxinfo" id="T6:U94"><span class="var type1" id="S223T6U1889">otherMakersPosition_k_i</span> - <span class="var type1" id="S207T6U1890">trackedMakerPosition_last_k_dT</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,550" id="srcline550">550</a></span><span class="line">    <span class="comment">% 位移差</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,551" id="srcline551">551</a></span><span class="line">    <span class="mxinfo" id="T2:U97"><span class="mxinfo" id="T2:U98"><span class="var type1" id="S216T7U1894">dPErrorNorm_dT</span>(<span class="var type1" id="S222T2U1895">i</span>)</span> = <span class="mxinfo" id="T2:U101">normest(<span class="mxinfo" id="T6:U102"><span class="var type1" id="S213T6U1899">dP_Inertial</span>-<span class="mxinfo" id="T6:U104"><span class="var type1" id="S220T3U1901">dP_Vision</span>(:,<span class="var type1" id="S222T2U1903">i</span>)</span></span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,552" id="srcline552">552</a></span><span class="line">    <span class="mxinfo" id="T2:U107"><span class="mxinfo" id="T2:U108"><span class="var type1" id="S218T7U1907">dPError_dT_xy</span>(<span class="var type1" id="S222T2U1908">i</span>)</span> = <span class="mxinfo" id="T2:U111">normest(<span class="mxinfo" id="T45:U112"><span class="var type1" id="S214T45U1912">dP_Inertial_xy</span>-<span class="mxinfo" id="T45:U114"><span class="var type1" id="S220T3U1914">dP_Vision</span>(<span class="mxinfo" id="T42:U116"><span class="mxinfo" id="T2:U117">1</span>:<span class="mxinfo" id="T2:U118">2</span></span>,<span class="var type1" id="S222T2U1918">i</span>)</span></span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,553" id="srcline553">553</a></span><span class="line">    <span class="mxinfo" id="T2:U120"><span class="mxinfo" id="T2:U121"><span class="var type1" id="S219T7U1922">dPError_dT_z</span>(<span class="var type1" id="S222T2U1923">i</span>)</span> = <span class="mxinfo" id="T2:U124"><span class="var type1" id="S215T2U1925">dP_Inertial_z</span>-<span class="mxinfo" id="T2:U126"><span class="var type1" id="S220T3U1927">dP_Vision</span>(<span class="mxinfo" id="T2:U128">3</span>,<span class="var type1" id="S222T2U1929">i</span>)</span></span></span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="56,554" id="srcline554">554</a></span><span class="line">    <span class="comment">% 低头时，dP_Inertial_z和dP_Vision(3,i)都为正，dP_Vision(3,i)的模更大，dPError_dT_z(i)为负</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,555" id="srcline555">555</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="56,556" id="srcline556">556</a></span><span class="line">    <span class="comment">% 角度差</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,557" id="srcline557">557</a></span><span class="line">    <span class="mxinfo" id="T2:U130"><span class="var type1" id="S225T2U1932">temp</span> = <span class="mxinfo" id="T2:U132"><span class="mxinfo" id="T2:U133"><span class="mxinfo" id="T2:U134"><span class="mxinfo" id="T13:U135"><span class="var type1" id="S213T6U1937">dP_Inertial</span>'</span>*<span class="mxinfo" id="T6:U137"><span class="var type1" id="S220T3U1939">dP_Vision</span>(:,<span class="var type1" id="S222T2U1941">i</span>)</span></span> / <span class="mxinfo" id="T2:U140">normest(<span class="var type1" id="S213T6U1944">dP_Inertial</span>)</span></span> / <span class="mxinfo" id="T2:U142">normest(<span class="mxinfo" id="T6:U143"><span class="var type1" id="S220T3U1948">dP_Vision</span>(:,<span class="var type1" id="S222T2U1950">i</span>)</span>)</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,558" id="srcline558">558</a></span><span class="line">    <span class="mxinfo" id="T2:U146"><span class="mxinfo" id="T2:U147"><span class="var type1" id="S221T7U1954">angleErr_dT</span>(<span class="var type1" id="S222T2U1955">i</span>)</span> = <span class="mxinfo" id="T2:U150">acos(<span class="var type1" id="S225T2U1958">temp</span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,559" id="srcline559">559</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,560" id="srcline560">560</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,561" id="srcline561">561</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,562" id="srcline562">562</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,563" id="srcline563">563</a></span><span class="line"><span class="mxinfo" id="T2:U152">[<span class="var type1" id="S199T2U1962">dPErrorNorm_dT_Min</span>,<span class="var type1" id="S198T2U1963">min_dT_k</span>] = min(<span class="var type1" id="S216T7U1966">dPErrorNorm_dT</span>,[],2)</span>;  <span class="comment">% 取位移差最小的点判断</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,564" id="srcline564">564</a></span><span class="line"><span class="mxinfo" id="T2:U156"><span class="var type1" id="S200T2U1972">dPError_dT_z_Min</span> = <span class="mxinfo" id="T2:U158"><span class="var type1" id="S219T7U1974">dPError_dT_z</span>(<span class="var type1" id="S198T2U1975">min_dT_k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,565" id="srcline565">565</a></span><span class="line"><span class="comment">% 惯性位移大小 ： 评价静止还是运动</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,566" id="srcline566">566</a></span><span class="line"><span class="mxinfo" id="T6:U161"><span class="var type1" id="S228T6U1978">otherMakersPosition_k_min</span> = <span class="mxinfo" id="T6:U163"><span class="var type1" id="S210T3U1980">otherMakersPosition_k</span>(:,<span class="var type1" id="S198T2U1982">min_dT_k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,567" id="srcline567">567</a></span><span class="line"><span class="mxinfo" id="T2:U166"><span class="var type1" id="S229T2U1985">dP_Inertial_Norm</span> = <span class="mxinfo" id="T2:U168">normest(<span class="var type1" id="S213T6U1988">dP_Inertial</span>)</span></span> ;  </span></span>
<span class="srcline"><span class="lineno"><a href="56,568" id="srcline568">568</a></span><span class="line"><span class="mxinfo" id="T2:U170"><span class="var type1" id="S201T2U1991">dP_Inertial_xyNorm_Min</span> = <span class="mxinfo" id="T2:U172">normest(<span class="mxinfo" id="T45:U173"><span class="var type1" id="S213T6U1995">dP_Inertial</span>(<span class="mxinfo" id="T42:U175"><span class="mxinfo" id="T2:U176">1</span>:<span class="mxinfo" id="T2:U177">2</span></span>)</span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,569" id="srcline569">569</a></span><span class="line"><span class="mxinfo" id="T2:U178"><span class="var type1" id="S230T2U2001">dP_Inertial_z_Min</span> = <span class="mxinfo" id="T2:U180"><span class="var type1" id="S213T6U2003">dP_Inertial</span>(<span class="mxinfo" id="T2:U182">3</span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,570" id="srcline570">570</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T14:U183"><span class="var type1" id="S229T2U2008">dP_Inertial_Norm</span> &lt; <span class="mxinfo" id="T2:U185"><span class="var type1" id="S208T41U2010">makerTrackThreshold</span>.MaxStaticDisp_dT</span></span>  </span></span>
<span class="srcline"><span class="lineno"><a href="56,571" id="srcline571">571</a></span><span class="line">    <span class="comment">%% 准静止状态，用dS位移判断</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,572" id="srcline572">572</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T14:U187"><span class="var type1" id="S199T2U2015">dPErrorNorm_dT_Min</span> &gt; <span class="mxinfo" id="T2:U189"><span class="var type1" id="S208T41U2017">makerTrackThreshold</span>.PositionErrorBear_dT</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,573" id="srcline573">573</a></span><span class="line">        <span class="comment">% 马克点明显运动，剔除</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,574" id="srcline574">574</a></span><span class="line">        <span class="mxinfo" id="T2:U191"><span class="var type1" id="S197T2U2021">TrackFlag</span> = <span class="mxinfo" id="T2:U193">-<span class="mxinfo" id="T2:U194">3.1</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,575" id="srcline575">575</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,576" id="srcline576">576</a></span><span class="line">        <span class="comment">% 惯性视觉运动位移差小，且连续于跟踪OK的马克点，则跟踪OK。</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,577" id="srcline577">577</a></span><span class="line">        <span class="comment">%% 连续判断出错时会误判</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,578" id="srcline578">578</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo" id="T14:U195"><span class="mxinfo" id="T2:U196"><span class="mxinfo" id="T7:U197"><span class="var type1" id="S203T47U2030">otherMakers_k</span>.ContinuesFlag</span>(<span class="var type1" id="S198T2U2032">min_dT_k</span>)</span>==<span class="mxinfo" id="T2:U200">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,579" id="srcline579">579</a></span><span class="line">            <span class="mxinfo" id="T44:U201"><span class="var type1" id="S196T44U2036">trackedMakerPosition_k_OK</span> = <span class="mxinfo" id="T6:U203"><span class="var type1" id="S210T3U2038">otherMakersPosition_k</span>(:,<span class="var type1" id="S198T2U2040">min_dT_k</span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,580" id="srcline580">580</a></span><span class="line">            <span class="mxinfo" id="T2:U206"><span class="var type1" id="S197T2U2043">TrackFlag</span> = <span class="mxinfo" id="T2:U208">3.1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,581" id="srcline581">581</a></span><span class="line">            <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,582" id="srcline582">582</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,583" id="srcline583">583</a></span><span class="line">            <span class="comment">% 惯性视觉运动位移差小，但不连续，进入4）判断</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,584" id="srcline584">584</a></span><span class="line">            <span class="mxinfo" id="T2:U209"><span class="var type1" id="S197T2U2049">TrackFlag</span> = <span class="mxinfo" id="T2:U211">1.31</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,585" id="srcline585">585</a></span><span class="line">            <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,586" id="srcline586">586</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,587" id="srcline587">587</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,588" id="srcline588">588</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="56,589" id="srcline589">589</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,590" id="srcline590">590</a></span><span class="line">    <span class="comment">%% 运动状态：</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,591" id="srcline591">591</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T14:U212"><span class="mxinfo" id="T2:U213"><span class="mxinfo" id="T7:U214"><span class="var type1" id="S203T47U2058">otherMakers_k</span>.ContinuesFlag</span>(<span class="var type1" id="S198T2U2060">min_dT_k</span>)</span>==<span class="mxinfo" id="T2:U217">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,592" id="srcline592">592</a></span><span class="line">       <span class="comment">%% 与前一时刻跟踪成功的点连续则放宽要求</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,593" id="srcline593">593</a></span><span class="line">       <span class="mxinfo" id="T2:U218"><span class="var type1" id="S231T2U2064">PositionErrorBear_dT</span> = <span class="mxinfo" id="T2:U220"><span class="mxinfo" id="T2:U221"><span class="var type1" id="S208T41U2067">makerTrackThreshold</span>.PositionErrorBear_dT</span>*<span class="mxinfo" id="T2:U223"><span class="var type1" id="S208T41U2070">makerTrackThreshold</span>.ContinuesTrackedMagnifyRate</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,594" id="srcline594">594</a></span><span class="line">       <span class="mxinfo" id="T2:U225"><span class="var type1" id="S232T2U2074">Max_dPAngle_dS</span>=  <span class="mxinfo" id="T2:U227"><span class="mxinfo" id="T2:U228"><span class="var type1" id="S208T41U2077">makerTrackThreshold</span>.Max_dPAngle_dS</span>*<span class="mxinfo" id="T2:U230"><span class="var type1" id="S208T41U2080">makerTrackThreshold</span>.ContinuesTrackedMagnifyRate</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,595" id="srcline595">595</a></span><span class="line">       <span class="mxinfo" id="T42:U232"><span class="var type1" id="S233T42U2084">MaxHighMoveErrRate</span> = <span class="mxinfo" id="T42:U234"><span class="mxinfo" id="T42:U235"><span class="var type1" id="S208T41U2087">makerTrackThreshold</span>.MaxHighMoveErrRate</span>*<span class="mxinfo" id="T2:U237"><span class="var type1" id="S208T41U2090">makerTrackThreshold</span>.ContinuesTrackedMagnifyRate</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,596" id="srcline596">596</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,597" id="srcline597">597</a></span><span class="line">        <span class="mxinfo" id="T2:U239"><span class="var type1" id="S231T2U2095">PositionErrorBear_dT</span> = <span class="mxinfo" id="T2:U241"><span class="var type1" id="S208T41U2097">makerTrackThreshold</span>.PositionErrorBear_dT</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,598" id="srcline598">598</a></span><span class="line">       <span class="mxinfo" id="T2:U243"><span class="var type1" id="S232T2U2101">Max_dPAngle_dS</span>=  <span class="mxinfo" id="T2:U245"><span class="var type1" id="S208T41U2103">makerTrackThreshold</span>.Max_dPAngle_dS</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,599" id="srcline599">599</a></span><span class="line">       <span class="mxinfo" id="T42:U247"><span class="var type1" id="S233T42U2107">MaxHighMoveErrRate</span> = <span class="mxinfo" id="T42:U249"><span class="var type1" id="S208T41U2109">makerTrackThreshold</span>.MaxHighMoveErrRate</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,600" id="srcline600">600</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,601" id="srcline601">601</a></span><span class="line">    <span class="comment">% 静止点直接剔除</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,602" id="srcline602">602</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T14:U251"><span class="mxinfo" id="T2:U252">normest( <span class="mxinfo" id="T6:U253"><span class="var type1" id="S220T3U2117">dP_Vision</span>(:,<span class="var type1" id="S198T2U2119">min_dT_k</span>)</span> )</span>&lt;<span class="mxinfo" id="T2:U256"><span class="var type1" id="S208T41U2121">makerTrackThreshold</span>.MaxStaticDisp_dT</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,603" id="srcline603">603</a></span><span class="line">        <span class="mxinfo" id="T2:U258"><span class="var type1" id="S197T2U2125">TrackFlag</span>=<span class="mxinfo" id="T2:U260">1.35</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,604" id="srcline604">604</a></span><span class="line">        <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,605" id="srcline605">605</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,606" id="srcline606">606</a></span><span class="line">    <span class="comment">%% 高度变化大，水平方向不可信，直接通过高度判定</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,607" id="srcline607">607</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T14:U261"><span class="mxinfo" id="T2:U262">normest(<span class="var type1" id="S230T2U2133">dP_Inertial_z_Min</span>)</span> &gt; <span class="mxinfo" id="T2:U264"><span class="var type1" id="S208T41U2135">makerTrackThreshold</span>.BigHighMove</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,608" id="srcline608">608</a></span><span class="line">       <span class="mxinfo" id="T2:U266"><span class="var type1" id="S234T2U2139">HighMoveErr</span> = <span class="mxinfo" id="T2:U268"><span class="mxinfo" id="T2:U269"><span class="var type1" id="S219T7U2142">dPError_dT_z</span>(<span class="var type1" id="S198T2U2143">min_dT_k</span>)</span> / <span class="var type1" id="S230T2U2144">dP_Inertial_z_Min</span></span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,609" id="srcline609">609</a></span><span class="line">       <span class="keyword">if</span> <span class="mxinfo" id="T14:U273"><span class="var type1" id="S234T2U2149">HighMoveErr</span>&gt;<span class="mxinfo" id="T2:U275"><span class="var type1" id="S233T42U2151">MaxHighMoveErrRate</span>(<span class="mxinfo" id="T2:U277">1</span>)</span></span> &amp;&amp; <span class="mxinfo" id="T14:U278"><span class="var type1" id="S234T2U2154">HighMoveErr</span> &lt; <span class="mxinfo" id="T2:U280"><span class="var type1" id="S233T42U2156">MaxHighMoveErrRate</span>(<span class="mxinfo" id="T2:U282">2</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,610" id="srcline610">610</a></span><span class="line">           <span class="comment">%% 高度方向位移误差比例小，跟踪OK</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,611" id="srcline611">611</a></span><span class="line">           <span class="mxinfo" id="T2:U283"><span class="var type1" id="S197T2U2160">TrackFlag</span> = <span class="mxinfo" id="T2:U285">3.9</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,612" id="srcline612">612</a></span><span class="line">           <span class="mxinfo" id="T44:U286"><span class="var type1" id="S196T44U2164">trackedMakerPosition_k_OK</span> = <span class="mxinfo" id="T6:U288"><span class="var type1" id="S210T3U2166">otherMakersPosition_k</span>(:,<span class="var type1" id="S198T2U2168">min_dT_k</span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,613" id="srcline613">613</a></span><span class="line">           <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,614" id="srcline614">614</a></span><span class="line">       <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,615" id="srcline615">615</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,616" id="srcline616">616</a></span><span class="line">    <span class="comment">%% （角度差判断为主）当运动距离超过 moveDistance 时，判断角度差，并放宽位移差条件</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,617" id="srcline617">617</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T14:U291"><span class="var type1" id="S229T2U2173">dP_Inertial_Norm</span> &gt; <span class="mxinfo" id="T2:U293"><span class="var type1" id="S208T41U2175">makerTrackThreshold</span>.moveDistance</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,618" id="srcline618">618</a></span><span class="line">       <span class="keyword">if</span> <span class="mxinfo" id="T14:U295"><span class="mxinfo" id="T2:U296"><span class="var type1" id="S221T7U2182">angleErr_dT</span>(<span class="var type1" id="S198T2U2183">min_dT_k</span>)</span> &lt;  <span class="mxinfo" id="T2:U299"><span class="var type1" id="S208T41U2185">makerTrackThreshold</span>.Max_dPAngle_dS</span></span> &amp;&amp; <span class="mxinfo" id="T14:U301"><span class="var type1" id="S199T2U2188">dPErrorNorm_dT_Min</span> &lt; <span class="mxinfo" id="T2:U303"><span class="var type1" id="S208T41U2190">makerTrackThreshold</span>.MaxPositionError_dS</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,619" id="srcline619">619</a></span><span class="line">            <span class="mxinfo" id="T44:U305"><span class="var type1" id="S196T44U2194">trackedMakerPosition_k_OK</span> = <span class="var type1" id="S228T6U2195">otherMakersPosition_k_min</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,620" id="srcline620">620</a></span><span class="line">            <span class="mxinfo" id="T2:U308"><span class="var type1" id="S197T2U2198">TrackFlag</span> = <span class="mxinfo" id="T2:U310">3.7</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,621" id="srcline621">621</a></span><span class="line">            <span class="mxinfo" id="T2:U311"><span class="var type1" id="S202T2U2202">angleErr_dT_Min</span> = <span class="mxinfo" id="T2:U313"><span class="var type1" id="S221T7U2204">angleErr_dT</span>(<span class="var type1" id="S198T2U2205">min_dT_k</span>)</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,622" id="srcline622">622</a></span><span class="line">            <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,623" id="srcline623">623</a></span><span class="line">       <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,624" id="srcline624">624</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,625" id="srcline625">625</a></span><span class="line">    <span class="comment">%% 位移差判断为主</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,626" id="srcline626">626</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T14:U316"><span class="var type1" id="S199T2U2211">dPErrorNorm_dT_Min</span> &lt; <span class="var type1" id="S231T2U2212">PositionErrorBear_dT</span></span>  &amp;&amp; <span class="mxinfo" id="T14:U319"><span class="mxinfo" id="T2:U320"><span class="var type1" id="S221T7U2215">angleErr_dT</span>(<span class="var type1" id="S198T2U2216">min_dT_k</span>)</span> &lt;  <span class="mxinfo" id="T2:U323"><span class="var type1" id="S232T2U2218">Max_dPAngle_dS</span>*<span class="mxinfo" id="T2:U325">2</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,627" id="srcline627">627</a></span><span class="line">        <span class="mxinfo" id="T44:U326"><span class="var type1" id="S196T44U2222">trackedMakerPosition_k_OK</span> = <span class="var type1" id="S228T6U2223">otherMakersPosition_k_min</span></span> ;</span></span>
<span class="srcline"><span class="lineno"><a href="56,628" id="srcline628">628</a></span><span class="line">        <span class="mxinfo" id="T2:U329"><span class="var type1" id="S197T2U2226">TrackFlag</span> = <span class="mxinfo" id="T2:U331">3.5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,629" id="srcline629">629</a></span><span class="line">    <span class="comment">%     fprintf( '3.5）惯性视觉位移差长度=%0.4f ，跟踪OK\n',normest(dPError_dT) );</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,630" id="srcline630">630</a></span><span class="line">        <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,631" id="srcline631">631</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,632" id="srcline632">632</a></span><span class="line">    <span class="mxinfo" id="T2:U332"><span class="var type1" id="S197T2U2231">TrackFlag</span>=<span class="mxinfo" id="T2:U334">1.37</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="56,633" id="srcline633">633</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,634" id="srcline634">634</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,635" id="srcline635">635</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T14:U335"><span class="var type1" id="S197T2U2236">TrackFlag</span>==<span class="mxinfo" id="T2:U337">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,636" id="srcline636">636</a></span><span class="line">   <span class="autoExtrinsicFcn" id="F302N40:B2240">disp</span>(<span class="string">'error'</span>)  </span></span>
<span class="srcline"><span class="lineno"><a href="56,637" id="srcline637">637</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="56,638" id="srcline638">638</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="56,639" id="srcline639">639</a></span><span class="line"><span class="comment">%% 马克点连续性判断</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,640" id="srcline640">640</a></span><span class="line"><span class="comment">% dPi_ConJudge ： 连续性判断指标的大小：前后两帧的位移模</span></span></span>
<span class="srcline"><span class="lineno"><a href="56,641" id="srcline641">641</a></span><span class="line"><span class="comment">% </span></span></span>
</pre>
