<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="78,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">% data_Acc_k_wave [3*2] 第一类记录 k_waves 前面的 dataV 平均斜率， 第二列记录后面的</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,23" id="srcline23"> 23</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="78,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">%% 通过 WaveFlag_k 是否为 NaN 判断是否波峰/波谷</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,25" id="srcline25"> 25</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="78,26" id="srcline26"> 26</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="78,27" id="srcline27"> 27</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S2T45U3">WaveFlag_k</span>,<span class="var type1" id="S3T57U4">k_waves</span>,<span class="var type1" id="S4T59U5">data_Acc_k_wave</span> ] = FindCrestThrough<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,28" id="srcline28"> 28</a></span><span class="line">    ( <span class="var type1" id="S5T44U8">data</span>,<span class="var type1" id="S6T1U9">fre</span>,<span class="var type1" id="S7T43U10">data_V</span>,<span class="var type1" id="S8T1U11">k_calV</span>,<span class="var type1" id="S9T1U12">adjacentN</span>,<span class="var type1" id="S10T2U13">waveThreshold_Min_dataA</span>,<span class="var type1" id="S11T2U14">MinWaveData</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="78,29" id="srcline29"> 29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="78,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">% data_V = NaN(5,N);  </span></span></span>
<span class="srcline"><span class="lineno"><a href="78,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="78,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">% for j=1:N</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,33" id="srcline33"> 33</a></span><span class="line"><span class="comment">%     %% 计算速度</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">%    [ Velocity_k,k_calV ] = CalVelocity( data,j,fre,dT_CalV,MinXYVNorm_CalAngle,2 ) ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">%    if k_calV&gt;0  &amp;&amp; ~isnan(Velocity_k(1))</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">%         data_V(:,k_calV) = Velocity_k ;</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">%    end</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,38" id="srcline38"> 38</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,39" id="srcline39"> 39</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="78,40" id="srcline40"> 40</a></span><span class="line"><span class="mxinfo" id="T45:U11"><span class="var type1" id="S2T45U17">WaveFlag_k</span> = <span class="mxinfo" id="T45:U13">NaN(<span class="mxinfo" id="T2:U14">3</span>,1)</span></span>;    <span class="comment">% 所以波峰和波谷的加速度值</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,41" id="srcline41"> 41</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="78,42" id="srcline42"> 42</a></span><span class="line"><span class="mxinfo" id="T1:U15"><span class="var type1" id="S13T1U24">k_wave</span> = <span class="mxinfo" id="T1:U17"><span class="var type1" id="S8T1U26">k_calV</span> - <span class="var type1" id="S9T1U27">adjacentN</span></span></span>;  <span class="comment">% 待判断的点</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,43" id="srcline43"> 43</a></span><span class="line"><span class="mxinfo" id="T57:U20"><span class="var type1" id="S3T57U30">k_waves</span> = <span class="mxinfo" id="T57:U22"><span class="mxinfo" id="T45:U23">ones(3,1)</span>*<span class="var type1" id="S13T1U36">k_wave</span></span></span>;  <span class="comment">% 每一维度进过细调后波的位置可能不一样</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,44" id="srcline44"> 44</a></span><span class="line"><span class="mxinfo" id="T59:U25"><span class="var type1" id="S4T59U39">data_Acc_k_wave</span> = <span class="mxinfo" id="T59:U27">NaN(<span class="mxinfo" id="T2:U28">3</span>,<span class="mxinfo" id="T2:U29">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="78,45" id="srcline45"> 45</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="78,46" id="srcline46"> 46</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T3:U30"><span class="var type1" id="S13T1U50">k_wave</span>&lt;<span class="mxinfo" id="T2:U32">2</span></span> || <span class="mxinfo" id="T3:U33">isnan(<span class="mxinfo" id="T2:U34"><span class="var type1" id="S5T44U55">data</span>(<span class="mxinfo" id="T2:U36">1</span>,<span class="var type1" id="S13T1U57">k_wave</span>)</span>)</span> || <span class="mxinfo" id="T3:U38">isnan(<span class="mxinfo" id="T2:U39"><span class="var type1" id="S7T43U61">data_V</span>(<span class="mxinfo" id="T2:U41">1</span>,<span class="var type1" id="S13T1U63">k_wave</span>)</span>)</span> || <span class="mxinfo" id="T3:U43">isnan(<span class="mxinfo" id="T2:U44"><span class="var type1" id="S7T43U67">data_V</span>(<span class="mxinfo" id="T2:U46">1</span>,<span class="mxinfo" id="T1:U47"><span class="var type1" id="S13T1U70">k_wave</span>-<span class="mxinfo" id="T2:U49">1</span></span>)</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,47" id="srcline47"> 47</a></span><span class="line">   <span class="keyword">return</span>; </span></span>
<span class="srcline"><span class="lineno"><a href="78,48" id="srcline48"> 48</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,49" id="srcline49"> 49</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="78,50" id="srcline50"> 50</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S16T2U75">i</span>=<span class="mxinfo" id="T2:U51">1</span>:3</span></span>
<span class="srcline"><span class="lineno"><a href="78,51" id="srcline51"> 51</a></span><span class="line">    <span class="mxinfo" id="T1:U52"><span class="var type1" id="S17T1U81">k_wave_i</span> = <span class="var type1" id="S13T1U82">k_wave</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="78,52" id="srcline52"> 52</a></span><span class="line">    <span class="comment">% 1.1)  data 绝对值大于 MinWaveData  </span></span></span>
<span class="srcline"><span class="lineno"><a href="78,53" id="srcline53"> 53</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T3:U55"><span class="mxinfo" id="T2:U56">abs(<span class="mxinfo" id="T2:U57"><span class="var type1" id="S5T44U89">data</span>(<span class="var type1" id="S16T2U90">i</span>,<span class="var type1" id="S17T1U91">k_wave_i</span>)</span>)</span> &lt; <span class="var type1" id="S11T2U92">MinWaveData</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="78,54" id="srcline54"> 54</a></span><span class="line">        <span class="keyword">continue</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="78,55" id="srcline55"> 55</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,56" id="srcline56"> 56</a></span><span class="line">    <span class="comment">% 1.2) 判断 data_V(:,k_calV) 是不是刚刚越过 0 线，是则下一步</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,57" id="srcline57"> 57</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T3:U62"><span class="mxinfo" id="T2:U63"><span class="mxinfo" id="T2:U64">sign( <span class="mxinfo" id="T2:U65"><span class="var type1" id="S7T43U101">data_V</span>(<span class="var type1" id="S16T2U102">i</span>,<span class="var type1" id="S17T1U103">k_wave_i</span>)</span> )</span>*<span class="mxinfo" id="T2:U69">sign( <span class="mxinfo" id="T2:U70"><span class="var type1" id="S7T43U107">data_V</span>(<span class="var type1" id="S16T2U108">i</span>,<span class="mxinfo" id="T1:U73"><span class="var type1" id="S17T1U110">k_wave_i</span>-<span class="mxinfo" id="T2:U75">1</span></span>)</span> )</span></span> &lt; <span class="mxinfo" id="T2:U76">1</span></span>  </span></span>
<span class="srcline"><span class="lineno"><a href="78,58" id="srcline58"> 58</a></span><span class="line">        <span class="keyword">if</span>( <span class="mxinfo" id="T3:U77"><span class="mxinfo" id="T2:U78">abs(<span class="mxinfo" id="T2:U79"><span class="var type1" id="S7T43U120">data_V</span>(<span class="var type1" id="S16T2U121">i</span>,<span class="var type1" id="S17T1U122">k_wave_i</span>)</span>)</span> &gt; <span class="mxinfo" id="T2:U83">abs(<span class="mxinfo" id="T2:U84"><span class="var type1" id="S7T43U126">data_V</span>(<span class="var type1" id="S16T2U127">i</span>,<span class="mxinfo" id="T1:U87"><span class="var type1" id="S17T1U129">k_wave_i</span>-<span class="mxinfo" id="T2:U89">1</span></span>)</span>)</span></span> )  <span class="comment">% 找2个值中的小者</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,59" id="srcline59"> 59</a></span><span class="line">            <span class="mxinfo" id="T1:U90"><span class="var type1" id="S17T1U133">k_wave_i</span> = <span class="mxinfo" id="T1:U92"><span class="var type1" id="S17T1U135">k_wave_i</span>-<span class="mxinfo" id="T2:U94">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="78,60" id="srcline60"> 60</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,61" id="srcline61"> 61</a></span><span class="line">        <span class="comment">% 计算 k_wave_i 点 前后 adjacentN 个点区间 的平均斜率</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,62" id="srcline62"> 62</a></span><span class="line">        <span class="mxinfo" id="T2:U95"><span class="var type1" id="S20T2U139">data_V_k_wave</span> = <span class="mxinfo" id="T2:U97"><span class="var type1" id="S7T43U141">data_V</span>(<span class="var type1" id="S16T2U142">i</span>,<span class="var type1" id="S17T1U143">k_wave_i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="78,63" id="srcline63"> 63</a></span><span class="line">        <span class="mxinfo" id="T2:U101"><span class="var type1" id="S21T2U146">data_V_Back</span> = <span class="mxinfo" id="T2:U103"><span class="var type1" id="S7T43U148">data_V</span>(<span class="var type1" id="S16T2U149">i</span>,<span class="var type1" id="S8T1U150">k_calV</span>)</span></span>;     <span class="comment">% 斜率计算区间 最后一个点</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,64" id="srcline64"> 64</a></span><span class="line">        <span class="mxinfo" id="T2:U107"><span class="var type1" id="S22T2U153">data_V_Front</span> = <span class="mxinfo" id="T2:U109"><span class="var type1" id="S7T43U155">data_V</span>(<span class="var type1" id="S16T2U156">i</span>,<span class="mxinfo" id="T1:U112"><span class="var type1" id="S8T1U158">k_calV</span>-<span class="mxinfo" id="T1:U114"><span class="var type1" id="S9T1U160">adjacentN</span>*2</span></span>)</span></span>;  <span class="comment">% 斜率计算区间 最前一个点</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,65" id="srcline65"> 65</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo" id="T3:U116">isnan(<span class="var type1" id="S21T2U168">data_V_Back</span>)</span> || <span class="mxinfo" id="T3:U118">isnan(<span class="var type1" id="S22T2U171">data_V_Front</span>)</span> || <span class="mxinfo" id="T3:U120">isnan(<span class="var type1" id="S20T2U174">data_V_k_wave</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,66" id="srcline66"> 66</a></span><span class="line">            <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="78,67" id="srcline67"> 67</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,68" id="srcline68"> 68</a></span><span class="line">        <span class="mxinfo" id="T1:U122"><span class="var type1" id="S23T1U178">data_Acc_Back</span> = <span class="mxinfo" id="T1:U124"><span class="mxinfo" id="T1:U125">(<span class="mxinfo" id="T2:U126"><span class="var type1" id="S21T2U183">data_V_Back</span>-<span class="var type1" id="S20T2U184">data_V_k_wave</span></span>)/(<span class="mxinfo" id="T1:U129"><span class="var type1" id="S8T1U187">k_calV</span>-<span class="var type1" id="S17T1U188">k_wave_i</span></span>)</span>*<span class="var type1" id="S6T1U189">fre</span></span></span> ;  <span class="comment">% 后面一段的斜率</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,69" id="srcline69"> 69</a></span><span class="line">        <span class="mxinfo" id="T1:U133"><span class="var type1" id="S24T1U192">data_Acc_Front</span> = <span class="mxinfo" id="T1:U135"><span class="mxinfo" id="T1:U136">(<span class="mxinfo" id="T2:U137"><span class="var type1" id="S20T2U197">data_V_k_wave</span>-<span class="var type1" id="S22T2U198">data_V_Front</span></span>)/(<span class="mxinfo" id="T1:U140"><span class="mxinfo" id="T1:U141"><span class="var type1" id="S17T1U202">k_wave_i</span>-<span class="var type1" id="S8T1U203">k_calV</span></span>+<span class="mxinfo" id="T1:U144"><span class="var type1" id="S9T1U205">adjacentN</span>*2</span></span>)</span>*<span class="var type1" id="S6T1U207">fre</span></span></span> ;  <span class="comment">% 前面一段的斜率</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,70" id="srcline70"> 70</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="78,71" id="srcline71"> 71</a></span><span class="line">        <span class="mxinfo" id="T45:U147"><span class="mxinfo" id="T45:U148"><span class="var type1" id="S4T59U211">data_Acc_k_wave</span>(:,1)</span> = <span class="var type1" id="S24T1U214">data_Acc_Front</span></span>;   <span class="comment">% 记录下前后的 data_V 斜率</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,72" id="srcline72"> 72</a></span><span class="line">        <span class="mxinfo" id="T45:U151"><span class="mxinfo" id="T45:U152"><span class="var type1" id="S4T59U218">data_Acc_k_wave</span>(:,2)</span> = <span class="var type1" id="S23T1U221">data_Acc_Back</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="78,73" id="srcline73"> 73</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="78,74" id="srcline74"> 74</a></span><span class="line">        <span class="comment">% 要求 前面和后面一段data_V的斜率 同号 且都比较大</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,75" id="srcline75"> 75</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo" id="T3:U155"><span class="mxinfo" id="T1:U156"><span class="mxinfo" id="T1:U157">sign(<span class="var type1" id="S24T1U228">data_Acc_Front</span>)</span>*<span class="mxinfo" id="T1:U159">sign(<span class="var type1" id="S23T1U231">data_Acc_Back</span>)</span></span> &gt; <span class="mxinfo" id="T2:U161">0</span></span>  <span class="comment">% 首先要求同号</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,76" id="srcline76"> 76</a></span><span class="line">            <span class="comment">% 斜率足够大的思路有好几种，这里选择只要左或右有一个足够大就OK。</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,77" id="srcline77"> 77</a></span><span class="line">            <span class="mxinfo" id="T1:U162"><span class="var type1" id="S25T1U235">data_Acc_k_absMax</span> = <span class="mxinfo" id="T1:U164">max( <span class="mxinfo" id="T1:U165">abs(<span class="var type1" id="S23T1U240">data_Acc_Back</span>)</span>,<span class="mxinfo" id="T1:U167">abs(<span class="var type1" id="S24T1U243">data_Acc_Front</span>)</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="78,78" id="srcline78"> 78</a></span><span class="line">            <span class="mxinfo" id="T1:U169"><span class="var type1" id="S27T1U246">data_Acc_k_Mean</span> = <span class="mxinfo" id="T1:U171">(<span class="mxinfo" id="T1:U172"><span class="var type1" id="S23T1U250">data_Acc_Back</span>+<span class="var type1" id="S24T1U251">data_Acc_Front</span></span>)/<span class="mxinfo" id="T2:U175">2</span></span></span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="78,79" id="srcline79"> 79</a></span><span class="line">           <span class="keyword">if</span> <span class="mxinfo" id="T3:U176"><span class="var type1" id="S25T1U257">data_Acc_k_absMax</span> &gt; <span class="var type1" id="S10T2U258">waveThreshold_Min_dataA</span></span> &amp;&amp;  <span class="mxinfo" id="T3:U179"><span class="mxinfo" id="T1:U180">abs(<span class="var type1" id="S27T1U262">data_Acc_k_Mean</span>)</span> &gt; <span class="mxinfo" id="T2:U182"><span class="var type1" id="S10T2U264">waveThreshold_Min_dataA</span>/<span class="mxinfo" id="T2:U184">4</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="78,80" id="srcline80"> 80</a></span><span class="line">               <span class="comment">% 2) 波峰/谷 存在 判断 OK， 进行 3) 在 k_wave_i 附近3个点内 细调位置</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,81" id="srcline81"> 81</a></span><span class="line">               <span class="comment">% 3）在这个点附近 5 个点 找到最大或最小的data，则为波峰/谷。（因为速度的计算会有延迟或滞后）</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,82" id="srcline82"> 82</a></span><span class="line">              <span class="mxinfo" id="T58:U185"><span class="var type1" id="S28T58U268">data_temp</span> = <span class="mxinfo" id="T58:U187"><span class="var type1" id="S5T44U270">data</span>(<span class="var type1" id="S16T2U271">i</span>,<span class="mxinfo" id="T1:U190"><span class="mxinfo" id="T1:U191"><span class="var type1" id="S17T1U274">k_wave_i</span>-<span class="mxinfo" id="T2:U193">2</span></span>:<span class="mxinfo" id="T1:U194"><span class="var type1" id="S17T1U277">k_wave_i</span>+<span class="mxinfo" id="T2:U196">2</span></span></span>)</span></span> ;   </span></span>
<span class="srcline"><span class="lineno"><a href="78,83" id="srcline83"> 83</a></span><span class="line">              <span class="keyword">if</span> <span class="mxinfo" id="T3:U197">isnan( <span class="mxinfo" id="T2:U198">sum(<span class="var type1" id="S28T58U285">data_temp</span>)</span> )</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,84" id="srcline84"> 84</a></span><span class="line">                  <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="78,85" id="srcline85"> 85</a></span><span class="line">              <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,86" id="srcline86"> 86</a></span><span class="line">              <span class="keyword">if</span> <span class="mxinfo" id="T3:U200"><span class="mxinfo" id="T2:U201"><span class="var type1" id="S5T44U291">data</span>(<span class="var type1" id="S16T2U292">i</span>,<span class="var type1" id="S17T1U293">k_wave_i</span>)</span>&gt;<span class="mxinfo" id="T2:U205">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="78,87" id="srcline87"> 87</a></span><span class="line">                  <span class="comment">% 波峰 细调</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,88" id="srcline88"> 88</a></span><span class="line">                  <span class="mxinfo" id="T2:U206">[ <span class="var type1" id="S30T2U298">data_max</span>,<span class="var type1" id="S31T2U299">k_max</span> ] = max(<span class="var type1" id="S28T58U302">data_temp</span>,[],2)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="78,89" id="srcline89"> 89</a></span><span class="line">                  <span class="mxinfo" id="T2:U210"><span class="var type1" id="S32T2U308">data_m</span> = <span class="var type1" id="S30T2U309">data_max</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="78,90" id="srcline90"> 90</a></span><span class="line">                  <span class="mxinfo" id="T1:U213"><span class="var type1" id="S17T1U312">k_wave_i</span> = <span class="mxinfo" id="T1:U215"><span class="var type1" id="S17T1U314">k_wave_i</span>+(<span class="mxinfo" id="T2:U217"><span class="var type1" id="S31T2U317">k_max</span>-<span class="mxinfo" id="T2:U219">3</span></span>)</span></span>;                  </span></span>
<span class="srcline"><span class="lineno"><a href="78,91" id="srcline91"> 91</a></span><span class="line">              <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,92" id="srcline92"> 92</a></span><span class="line">                  <span class="comment">% 波谷 细调</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,93" id="srcline93"> 93</a></span><span class="line">                  <span class="mxinfo" id="T2:U220">[ <span class="var type1" id="S33T2U323">data_min</span>,<span class="var type1" id="S34T2U324">k_min</span> ] = min(<span class="var type1" id="S28T58U327">data_temp</span>,[],2)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="78,94" id="srcline94"> 94</a></span><span class="line">                  <span class="mxinfo" id="T2:U224"><span class="var type1" id="S32T2U333">data_m</span> = <span class="var type1" id="S33T2U334">data_min</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="78,95" id="srcline95"> 95</a></span><span class="line">                  <span class="mxinfo" id="T1:U227"><span class="var type1" id="S17T1U337">k_wave_i</span> = <span class="mxinfo" id="T1:U229"><span class="var type1" id="S17T1U339">k_wave_i</span>+(<span class="mxinfo" id="T2:U231"><span class="var type1" id="S34T2U342">k_min</span>-<span class="mxinfo" id="T2:U233">3</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="78,96" id="srcline96"> 96</a></span><span class="line">              <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,97" id="srcline97"> 97</a></span><span class="line">              <span class="comment">%% 1) 2) 3) 判断OK</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,98" id="srcline98"> 98</a></span><span class="line">                  <span class="comment">%% 搜索OK 记录波峰/波谷的 data</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,99" id="srcline99"> 99</a></span><span class="line">                    <span class="mxinfo" id="T1:U234"><span class="mxinfo" id="T1:U235"><span class="var type1" id="S3T57U347">k_waves</span>(<span class="var type1" id="S16T2U348">i</span>)</span> = <span class="var type1" id="S17T1U349">k_wave_i</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="78,100" id="srcline100">100</a></span><span class="line">                    <span class="mxinfo" id="T2:U239"><span class="mxinfo" id="T2:U240"><span class="var type1" id="S2T45U353">WaveFlag_k</span>(<span class="var type1" id="S16T2U354">i</span>,<span class="mxinfo" id="T2:U243">1</span>)</span> = <span class="mxinfo" id="T2:U244"><span class="var type1" id="S5T44U357">data</span>(<span class="var type1" id="S16T2U358">i</span>,<span class="var type1" id="S17T1U359">k_wave_i</span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="78,101" id="srcline101">101</a></span><span class="line">              </span></span>
<span class="srcline"><span class="lineno"><a href="78,102" id="srcline102">102</a></span><span class="line">           <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,103" id="srcline103">103</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,104" id="srcline104">104</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="78,105" id="srcline105">105</a></span><span class="line">    <span class="keyword">end</span>    </span></span>
<span class="srcline"><span class="lineno"><a href="78,106" id="srcline106">106</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="78,107" id="srcline107">107</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="78,108" id="srcline108">108</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="78,109" id="srcline109">109</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="78,110" id="srcline110">110</a></span><span class="line"></span></span>
</pre>
